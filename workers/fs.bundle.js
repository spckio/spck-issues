!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).buffer=e()}((function(){return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,(function(e){return i(t[s][1][e]||e)}),l,l.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){(function(t){"use strict";var n=e("base64-js"),i=e("ieee754"),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=t,r.SlowBuffer=function(e){return+e!=e&&(e=0),t.alloc(+e)},r.INSPECT_MAX_BYTES=50;var s=2147483647;function a(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');var r=new Uint8Array(e);return Object.setPrototypeOf(r,t.prototype),r}function t(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return l(e)}return u(e,t,r)}function u(e,r,n){if("string"==typeof e)return function(e,r){if("string"==typeof r&&""!==r||(r="utf8"),!t.isEncoding(r))throw new TypeError("Unknown encoding: "+r);var n=0|p(e,r),i=a(n),o=i.write(e,r);return o!==n&&(i=i.slice(0,o)),i}(e,r);if(ArrayBuffer.isView(e))return h(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(N(e,ArrayBuffer)||e&&N(e.buffer,ArrayBuffer))return function(e,r,n){if(r<0||e.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<r+(n||0))throw new RangeError('"length" is outside of buffer bounds');var i;return i=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n),Object.setPrototypeOf(i,t.prototype),i}(e,r,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return t.from(i,r,n);var o=function(e){if(t.isBuffer(e)){var r=0|f(e.length),n=a(r);return 0===n.length?n:(e.copy(n,0,0,r),n)}return void 0!==e.length?"number"!=typeof e.length||K(e.length)?a(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return t.from(e[Symbol.toPrimitive]("string"),r,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return c(e),a(e<0?0:0|f(e))}function h(e){for(var t=e.length<0?0:0|f(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function f(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function p(e,r){if(t.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||N(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var o=!1;;)switch(r){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return R(e).length;default:if(o)return i?-1:j(e).length;r=(""+r).toLowerCase(),o=!0}}function d(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,r,n,i,o){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),K(n=+n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof r&&(r=t.from(r,i)),t.isBuffer(r))return 0===r.length?-1:m(e,r,n,i,o);if("number"==typeof r)return r&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,r,n):Uint8Array.prototype.lastIndexOf.call(e,r,n):m(e,[r],n,i,o);throw new TypeError("val must be string, number or Buffer")}function m(e,t,r,n,i){var o,s=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,r/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var l=-1;for(o=r;o<a;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(r+u>a&&(r=a-u),o=r;o>=0;o--){for(var h=!0,f=0;f<u;f++)if(c(e,o+f)!==c(t,f)){h=!1;break}if(h)return o}return-1}function g(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(K(a))return s;e[r+s]=a}return s}function v(e,t,r,n){return U(j(t,e.length-r),e,r,n)}function w(e,t,r,n){return U(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function b(e,t,r,n){return w(e,t,r,n)}function _(e,t,r,n){return U(R(t),e,r,n)}function E(e,t,r,n){return U(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function S(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function x(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,u,c=e[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=h}return function(e){var t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=k));return r}(n)}r.kMaxLength=s,t.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),t.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(t.prototype,"parent",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.buffer}}),Object.defineProperty(t.prototype,"offset",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&t[Symbol.species]===t&&Object.defineProperty(t,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),t.poolSize=8192,t.from=function(e,t,r){return u(e,t,r)},Object.setPrototypeOf(t.prototype,Uint8Array.prototype),Object.setPrototypeOf(t,Uint8Array),t.alloc=function(e,t,r){return function(e,t,r){return c(e),e<=0?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)}(e,t,r)},t.allocUnsafe=function(e){return l(e)},t.allocUnsafeSlow=function(e){return l(e)},t.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==t.prototype},t.compare=function(e,r){if(N(e,Uint8Array)&&(e=t.from(e,e.offset,e.byteLength)),N(r,Uint8Array)&&(r=t.from(r,r.offset,r.byteLength)),!t.isBuffer(e)||!t.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===r)return 0;for(var n=e.length,i=r.length,o=0,s=Math.min(n,i);o<s;++o)if(e[o]!==r[o]){n=e[o],i=r[o];break}return n<i?-1:i<n?1:0},t.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},t.concat=function(e,r){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return t.alloc(0);var n;if(void 0===r)for(r=0,n=0;n<e.length;++n)r+=e[n].length;var i=t.allocUnsafe(r),o=0;for(n=0;n<e.length;++n){var s=e[n];if(N(s,Uint8Array)&&(s=t.from(s)),!t.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,o),o+=s.length}return i},t.byteLength=p,t.prototype._isBuffer=!0,t.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)d(this,t,t+1);return this},t.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)d(this,t,t+3),d(this,t+1,t+2);return this},t.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)d(this,t,t+7),d(this,t+1,t+6),d(this,t+2,t+5),d(this,t+3,t+4);return this},t.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?x(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,r);case"utf8":case"utf-8":return x(this,t,r);case"ascii":return A(this,t,r);case"latin1":case"binary":return B(this,t,r);case"base64":return S(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},t.prototype.toLocaleString=t.prototype.toString,t.prototype.equals=function(e){if(!t.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===t.compare(this,e)},t.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},o&&(t.prototype[o]=t.prototype.inspect),t.prototype.compare=function(e,r,n,i,o){if(N(e,Uint8Array)&&(e=t.from(e,e.offset,e.byteLength)),!t.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===r&&(r=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===o&&(o=this.length),r<0||n>e.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&r>=n)return 0;if(i>=o)return-1;if(r>=n)return 1;if(this===e)return 0;for(var s=(o>>>=0)-(i>>>=0),a=(n>>>=0)-(r>>>=0),u=Math.min(s,a),c=this.slice(i,o),l=e.slice(r,n),h=0;h<u;++h)if(c[h]!==l[h]){s=c[h],a=l[h];break}return s<a?-1:a<s?1:0},t.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},t.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},t.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},t.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return g(this,e,t,r);case"utf8":case"utf-8":return v(this,e,t,r);case"ascii":return w(this,e,t,r);case"latin1":case"binary":return b(this,e,t,r);case"base64":return _(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function B(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function I(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=L[e[o]];return i}function C(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function D(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function T(e,r,n,i,o,s){if(!t.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>o||r<s)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function O(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function F(e,t,r,n,o){return t=+t,r>>>=0,o||O(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function P(e,t,r,n,o){return t=+t,r>>>=0,o||O(e,0,r,8),i.write(e,t,r,n,52,8),r+8}t.prototype.slice=function(e,r){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<e&&(r=e);var i=this.subarray(e,r);return Object.setPrototypeOf(i,t.prototype),i},t.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||D(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},t.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||D(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},t.prototype.readUInt8=function(e,t){return e>>>=0,t||D(e,1,this.length),this[e]},t.prototype.readUInt16LE=function(e,t){return e>>>=0,t||D(e,2,this.length),this[e]|this[e+1]<<8},t.prototype.readUInt16BE=function(e,t){return e>>>=0,t||D(e,2,this.length),this[e]<<8|this[e+1]},t.prototype.readUInt32LE=function(e,t){return e>>>=0,t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},t.prototype.readUInt32BE=function(e,t){return e>>>=0,t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},t.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||D(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},t.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||D(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},t.prototype.readInt8=function(e,t){return e>>>=0,t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},t.prototype.readInt16LE=function(e,t){e>>>=0,t||D(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},t.prototype.readInt16BE=function(e,t){e>>>=0,t||D(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},t.prototype.readInt32LE=function(e,t){return e>>>=0,t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},t.prototype.readInt32BE=function(e,t){return e>>>=0,t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},t.prototype.readFloatLE=function(e,t){return e>>>=0,t||D(e,4,this.length),i.read(this,e,!0,23,4)},t.prototype.readFloatBE=function(e,t){return e>>>=0,t||D(e,4,this.length),i.read(this,e,!1,23,4)},t.prototype.readDoubleLE=function(e,t){return e>>>=0,t||D(e,8,this.length),i.read(this,e,!0,52,8)},t.prototype.readDoubleBE=function(e,t){return e>>>=0,t||D(e,8,this.length),i.read(this,e,!1,52,8)},t.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||T(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},t.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||T(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},t.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,1,255,0),this[t]=255&e,t+1},t.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},t.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},t.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},t.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},t.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);T(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},t.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);T(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},t.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},t.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},t.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},t.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},t.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},t.prototype.writeFloatLE=function(e,t,r){return F(this,e,t,!0,r)},t.prototype.writeFloatBE=function(e,t,r){return F(this,e,t,!1,r)},t.prototype.writeDoubleLE=function(e,t,r){return P(this,e,t,!0,r)},t.prototype.writeDoubleBE=function(e,t,r){return P(this,e,t,!1,r)},t.prototype.copy=function(e,r,n,i){if(!t.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),r>=e.length&&(r=e.length),r||(r=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-r<i-n&&(i=e.length-r+n);var o=i-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,n,i);else if(this===e&&n<r&&r<i)for(var s=o-1;s>=0;--s)e[s+r]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,i),r);return o},t.prototype.fill=function(e,r,n,i){if("string"==typeof e){if("string"==typeof r?(i=r,r=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!t.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){var o=e.charCodeAt(0);("utf8"===i&&o<128||"latin1"===i)&&(e=o)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;var s;if(r>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=r;s<n;++s)this[s]=e;else{var a=t.isBuffer(e)?e:t.from(e,i),u=a.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-r;++s)this[s+r]=a[s%u]}return this};var M=/[^+\/0-9A-Za-z-_]/g;function j(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function R(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function U(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function N(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function K(e){return e!=e}var L=function(){for(var e=new Array(256),t=0;t<16;++t)for(var r=16*t,n=0;n<16;++n)e[r+n]="0123456789abcdef"[t]+"0123456789abcdef"[n];return e}()}).call(this,e("buffer").Buffer)},{"base64-js":2,buffer:5,ieee754:3}],2:[function(e,t,r){"use strict";r.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},r.toByteArray=function(e){var t,r,n=c(e),s=n[0],a=n[1],u=new o(function(e,t,r){return 3*(t+r)/4-r}(0,s,a)),l=0,h=a>0?s-4:s;for(r=0;r<h;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;return 2===a&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,u[l++]=255&t),1===a&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t),u},r.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(l(e,s,s+16383>a?a:s+16383));return 1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=s.length;a<u;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,r){for(var i,o,s=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],3:[function(e,t,r){r.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,h=r?i-1:0,f=r?-1:1,p=e[t+h];for(h+=f,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+e[t+h],h+=f,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+e[t+h],h+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,h=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(s++,u/=2),s+h>=l?(a=0,s=l):s+h>=1?(a=(t*u-1)*Math.pow(2,i),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[r+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[r+p]=255&s,p+=d,s/=256,c-=8);e[r+p-d]|=128*y}},{}],4:[function(e,t,r){arguments[4][2][0].apply(r,arguments)},{dup:2}],5:[function(e,t,r){(function(t){"use strict";var n=e("base64-js"),i=e("ieee754");r.Buffer=t,r.SlowBuffer=function(e){return+e!=e&&(e=0),t.alloc(+e)},r.INSPECT_MAX_BYTES=50;var o=2147483647;function s(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');var r=new Uint8Array(e);return r.__proto__=t.prototype,r}function t(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return c(e)}return a(e,t,r)}function a(e,r,n){if("string"==typeof e)return function(e,r){if("string"==typeof r&&""!==r||(r="utf8"),!t.isEncoding(r))throw new TypeError("Unknown encoding: "+r);var n=0|f(e,r),i=s(n),o=i.write(e,r);return o!==n&&(i=i.slice(0,o)),i}(e,r);if(ArrayBuffer.isView(e))return l(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(N(e,ArrayBuffer)||e&&N(e.buffer,ArrayBuffer))return function(e,r,n){if(r<0||e.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<r+(n||0))throw new RangeError('"length" is outside of buffer bounds');var i;return(i=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n)).__proto__=t.prototype,i}(e,r,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return t.from(i,r,n);var o=function(e){if(t.isBuffer(e)){var r=0|h(e.length),n=s(r);return 0===n.length?n:(e.copy(n,0,0,r),n)}return void 0!==e.length?"number"!=typeof e.length||K(e.length)?s(0):l(e):"Buffer"===e.type&&Array.isArray(e.data)?l(e.data):void 0}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return t.from(e[Symbol.toPrimitive]("string"),r,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return u(e),s(e<0?0:0|h(e))}function l(e){for(var t=e.length<0?0:0|h(e.length),r=s(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function h(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function f(e,r){if(t.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||N(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var o=!1;;)switch(r){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return R(e).length;default:if(o)return i?-1:j(e).length;r=(""+r).toLowerCase(),o=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function d(e,r,n,i,o){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),K(n=+n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof r&&(r=t.from(r,i)),t.isBuffer(r))return 0===r.length?-1:y(e,r,n,i,o);if("number"==typeof r)return r&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,r,n):Uint8Array.prototype.lastIndexOf.call(e,r,n):y(e,[r],n,i,o);throw new TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var o,s=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,r/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var l=-1;for(o=r;o<a;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(r+u>a&&(r=a-u),o=r;o>=0;o--){for(var h=!0,f=0;f<u;f++)if(c(e,o+f)!==c(t,f)){h=!1;break}if(h)return o}return-1}function m(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(K(a))return s;e[r+s]=a}return s}function g(e,t,r,n){return U(j(t,e.length-r),e,r,n)}function v(e,t,r,n){return U(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function w(e,t,r,n){return v(e,t,r,n)}function b(e,t,r,n){return U(R(t),e,r,n)}function _(e,t,r,n){return U(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function E(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function S(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,u,c=e[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=h}return function(e){var t=e.length;if(t<=x)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=x));return r}(n)}r.kMaxLength=o,t.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),t.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(t.prototype,"parent",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.buffer}}),Object.defineProperty(t.prototype,"offset",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&t[Symbol.species]===t&&Object.defineProperty(t,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),t.poolSize=8192,t.from=function(e,t,r){return a(e,t,r)},t.prototype.__proto__=Uint8Array.prototype,t.__proto__=Uint8Array,t.alloc=function(e,t,r){return function(e,t,r){return u(e),e<=0?s(e):void 0!==t?"string"==typeof r?s(e).fill(t,r):s(e).fill(t):s(e)}(e,t,r)},t.allocUnsafe=function(e){return c(e)},t.allocUnsafeSlow=function(e){return c(e)},t.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==t.prototype},t.compare=function(e,r){if(N(e,Uint8Array)&&(e=t.from(e,e.offset,e.byteLength)),N(r,Uint8Array)&&(r=t.from(r,r.offset,r.byteLength)),!t.isBuffer(e)||!t.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===r)return 0;for(var n=e.length,i=r.length,o=0,s=Math.min(n,i);o<s;++o)if(e[o]!==r[o]){n=e[o],i=r[o];break}return n<i?-1:i<n?1:0},t.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},t.concat=function(e,r){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return t.alloc(0);var n;if(void 0===r)for(r=0,n=0;n<e.length;++n)r+=e[n].length;var i=t.allocUnsafe(r),o=0;for(n=0;n<e.length;++n){var s=e[n];if(N(s,Uint8Array)&&(s=t.from(s)),!t.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,o),o+=s.length}return i},t.byteLength=f,t.prototype._isBuffer=!0,t.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},t.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},t.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},t.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?S(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return B(this,t,r);case"utf8":case"utf-8":return S(this,t,r);case"ascii":return k(this,t,r);case"latin1":case"binary":return A(this,t,r);case"base64":return E(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},t.prototype.toLocaleString=t.prototype.toString,t.prototype.equals=function(e){if(!t.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===t.compare(this,e)},t.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},t.prototype.compare=function(e,r,n,i,o){if(N(e,Uint8Array)&&(e=t.from(e,e.offset,e.byteLength)),!t.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===r&&(r=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===o&&(o=this.length),r<0||n>e.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&r>=n)return 0;if(i>=o)return-1;if(r>=n)return 1;if(this===e)return 0;for(var s=(o>>>=0)-(i>>>=0),a=(n>>>=0)-(r>>>=0),u=Math.min(s,a),c=this.slice(i,o),l=e.slice(r,n),h=0;h<u;++h)if(c[h]!==l[h]){s=c[h],a=l[h];break}return s<a?-1:a<s?1:0},t.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},t.prototype.indexOf=function(e,t,r){return d(this,e,t,r,!0)},t.prototype.lastIndexOf=function(e,t,r){return d(this,e,t,r,!1)},t.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return m(this,e,t,r);case"utf8":case"utf-8":return g(this,e,t,r);case"ascii":return v(this,e,t,r);case"latin1":case"binary":return w(this,e,t,r);case"base64":return b(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var x=4096;function k(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function B(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=M(e[o]);return i}function I(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function C(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function D(e,r,n,i,o,s){if(!t.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>o||r<s)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function T(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function O(e,t,r,n,o){return t=+t,r>>>=0,o||T(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function F(e,t,r,n,o){return t=+t,r>>>=0,o||T(e,0,r,8),i.write(e,t,r,n,52,8),r+8}t.prototype.slice=function(e,r){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<e&&(r=e);var i=this.subarray(e,r);return i.__proto__=t.prototype,i},t.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||C(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},t.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||C(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},t.prototype.readUInt8=function(e,t){return e>>>=0,t||C(e,1,this.length),this[e]},t.prototype.readUInt16LE=function(e,t){return e>>>=0,t||C(e,2,this.length),this[e]|this[e+1]<<8},t.prototype.readUInt16BE=function(e,t){return e>>>=0,t||C(e,2,this.length),this[e]<<8|this[e+1]},t.prototype.readUInt32LE=function(e,t){return e>>>=0,t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},t.prototype.readUInt32BE=function(e,t){return e>>>=0,t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},t.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||C(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},t.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||C(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},t.prototype.readInt8=function(e,t){return e>>>=0,t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},t.prototype.readInt16LE=function(e,t){e>>>=0,t||C(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},t.prototype.readInt16BE=function(e,t){e>>>=0,t||C(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},t.prototype.readInt32LE=function(e,t){return e>>>=0,t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},t.prototype.readInt32BE=function(e,t){return e>>>=0,t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},t.prototype.readFloatLE=function(e,t){return e>>>=0,t||C(e,4,this.length),i.read(this,e,!0,23,4)},t.prototype.readFloatBE=function(e,t){return e>>>=0,t||C(e,4,this.length),i.read(this,e,!1,23,4)},t.prototype.readDoubleLE=function(e,t){return e>>>=0,t||C(e,8,this.length),i.read(this,e,!0,52,8)},t.prototype.readDoubleBE=function(e,t){return e>>>=0,t||C(e,8,this.length),i.read(this,e,!1,52,8)},t.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||D(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},t.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||D(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},t.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,1,255,0),this[t]=255&e,t+1},t.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},t.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},t.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},t.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},t.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);D(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},t.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);D(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},t.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},t.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},t.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},t.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},t.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},t.prototype.writeFloatLE=function(e,t,r){return O(this,e,t,!0,r)},t.prototype.writeFloatBE=function(e,t,r){return O(this,e,t,!1,r)},t.prototype.writeDoubleLE=function(e,t,r){return F(this,e,t,!0,r)},t.prototype.writeDoubleBE=function(e,t,r){return F(this,e,t,!1,r)},t.prototype.copy=function(e,r,n,i){if(!t.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),r>=e.length&&(r=e.length),r||(r=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-r<i-n&&(i=e.length-r+n);var o=i-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,n,i);else if(this===e&&n<r&&r<i)for(var s=o-1;s>=0;--s)e[s+r]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,i),r);return o},t.prototype.fill=function(e,r,n,i){if("string"==typeof e){if("string"==typeof r?(i=r,r=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!t.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){var o=e.charCodeAt(0);("utf8"===i&&o<128||"latin1"===i)&&(e=o)}}else"number"==typeof e&&(e&=255);if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;var s;if(r>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=r;s<n;++s)this[s]=e;else{var a=t.isBuffer(e)?e:t.from(e,i),u=a.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-r;++s)this[s+r]=a[s%u]}return this};var P=/[^+\/0-9A-Za-z-_]/g;function M(e){return e<16?"0"+e.toString(16):e.toString(16)}function j(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function R(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function U(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function N(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function K(e){return e!=e}}).call(this,e("buffer").Buffer)},{"base64-js":4,buffer:5,ieee754:6}],6:[function(e,t,r){arguments[4][3][0].apply(r,arguments)},{dup:3}]},{},[1])(1)}));var Buffer=buffer.Buffer;!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Dexie=t()}(this,(function(){"use strict";var e=function(){return(e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function t(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n}var r=Object.keys,n=Array.isArray,i="undefined"!=typeof self?self:"undefined"!=typeof window?window:global;function o(e,t){return"object"!=typeof t||r(t).forEach((function(r){e[r]=t[r]})),e}"undefined"==typeof Promise||i.Promise||(i.Promise=Promise);var s=Object.getPrototypeOf,a={}.hasOwnProperty;function u(e,t){return a.call(e,t)}function c(e,t){"function"==typeof t&&(t=t(s(e))),r(t).forEach((function(r){h(e,r,t[r])}))}var l=Object.defineProperty;function h(e,t,r,n){l(e,t,o(r&&u(r,"get")&&"function"==typeof r.get?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function f(e){return{from:function(t){return e.prototype=Object.create(t.prototype),h(e.prototype,"constructor",e),{extend:c.bind(null,e.prototype)}}}}var p=Object.getOwnPropertyDescriptor,d=[].slice;function y(e,t,r){return d.call(e,t,r)}function m(e,t){return t(e)}function g(e){if(!e)throw new Error("Assertion Failed")}function v(e){i.setImmediate?setImmediate(e):setTimeout(e,0)}function w(e,t){return e.reduce((function(e,r,n){var i=t(r,n);return i&&(e[i[0]]=i[1]),e}),{})}function b(e,t){if(u(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var r=[],n=0,i=t.length;n<i;++n){var o=b(e,t[n]);r.push(o)}return r}var s=t.indexOf(".");if(-1!==s){var a=e[t.substr(0,s)];return void 0===a?void 0:b(a,t.substr(s+1))}}function _(e,t,r){if(e&&void 0!==t&&!("isFrozen"in Object&&Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){g("string"!=typeof r&&"length"in r);for(var i=0,o=t.length;i<o;++i)_(e,t[i],r[i])}else{var s,a,u=t.indexOf(".");-1!==u?(s=t.substr(0,u),""===(a=t.substr(u+1))?void 0===r?n(e)&&!isNaN(parseInt(s))?e.splice(s,1):delete e[s]:e[s]=r:_(e[s]||(e[s]={}),a,r)):void 0===r?n(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function E(e){var t={};for(var r in e)u(e,r)&&(t[r]=e[r]);return t}var S=[].concat;function x(e){return S.apply([],e)}var k="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(x([8,16,32,64].map((function(e){return["Int","Uint","Float"].map((function(t){return t+e+"Array"}))})))).filter((function(e){return i[e]})),A=k.map((function(e){return i[e]})),B=w(k,(function(e){return[e,!0]}));function I(e){if(!e||"object"!=typeof e)return e;var t;if(n(e)){t=[];for(var r=0,i=e.length;r<i;++r)t.push(I(e[r]))}else if(0<=A.indexOf(e.constructor))t=e;else for(var o in t=e.constructor?Object.create(e.constructor.prototype):{},e)u(e,o)&&(t[o]=I(e[o]));return t}var C={}.toString;function D(e){return C.call(e).slice(8,-1)}var T=function(e,t){return"Array"===t?""+e.map((function(e){return T(e,D(e))})):"ArrayBuffer"===t?""+new Uint8Array(e):"Date"===t?e.getTime():ArrayBuffer.isView(e)?""+new Uint8Array(e.buffer):e};function O(e,t,n,i){return n=n||{},i=i||"",r(e).forEach((function(r){var o,s,a,c;u(t,r)?(o=e[r],s=t[r],"object"==typeof o&&"object"==typeof s&&o&&s?(a=D(o))===(c=D(s))?B[a]?T(o,a)!==T(s,c)&&(n[i+r]=t[r]):O(o,s,n,i+r+"."):n[i+r]=t[r]:o!==s&&(n[i+r]=t[r])):n[i+r]=void 0})),r(t).forEach((function(r){u(e,r)||(n[i+r]=t[r])})),n}var F="undefined"!=typeof Symbol&&Symbol.iterator,P=F?function(e){var t;return null!=e&&(t=e[F])&&t.apply(e)}:function(){return null},M={};function j(e){var t,r,i,o;if(1===arguments.length){if(n(e))return e.slice();if(this===M&&"string"==typeof e)return[e];if(o=P(e)){for(r=[];!(i=o.next()).done;)r.push(i.value);return r}if(null==e)return[e];if("number"!=typeof(t=e.length))return[e];for(r=new Array(t);t--;)r[t]=e[t];return r}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}var R="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},U="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function N(e,t){U=e,K=t}var K=function(){return!0},L=!new Error("").stack;function z(){if(L)try{throw new Error}catch(e){return e}return new Error}function q(e,t){var r=e.stack;return r?(t=t||0,0===r.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),r.split("\n").slice(t).filter(K).map((function(e){return"\n"+e})).join("")):""}var $=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],V=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat($),W={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function G(e,t){this._e=z(),this.name=e,this.message=t}function Y(e,t){return e+". Errors: "+Object.keys(t).map((function(e){return t[e].toString()})).filter((function(e,t,r){return r.indexOf(e)===t})).join("\n")}function H(e,t,r,n){this._e=z(),this.failures=t,this.failedKeys=n,this.successCount=r,this.message=Y(e,t)}function X(e,t){this._e=z(),this.name="BulkError",this.failures=t,this.message=Y(e,t)}f(G).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+q(this._e,2))}},toString:function(){return this.name+": "+this.message}}),f(H).from(G),f(X).from(G);var J=V.reduce((function(e,t){return e[t]=t+"Error",e}),{}),Q=G,Z=V.reduce((function(e,t){var r=t+"Error";function n(e,n){this._e=z(),this.name=r,e?"string"==typeof e?(this.message=e+(n?"\n "+n:""),this.inner=n||null):"object"==typeof e&&(this.message=e.name+" "+e.message,this.inner=e):(this.message=W[t]||r,this.inner=null)}return f(n).from(Q),e[t]=n,e}),{});Z.Syntax=SyntaxError,Z.Type=TypeError,Z.Range=RangeError;var ee=$.reduce((function(e,t){return e[t+"Error"]=Z[t],e}),{}),te=V.reduce((function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=Z[t]),e}),{});function re(){}function ne(e){return e}function ie(e,t){return null==e||e===ne?t:function(r){return t(e(r))}}function oe(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function se(e,t){return e===re?t:function(){var r=e.apply(this,arguments);void 0!==r&&(arguments[0]=r);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?oe(n,this.onsuccess):n),i&&(this.onerror=this.onerror?oe(i,this.onerror):i),void 0!==o?o:r}}function ae(e,t){return e===re?t:function(){e.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?oe(r,this.onsuccess):r),n&&(this.onerror=this.onerror?oe(n,this.onerror):n)}}function ue(e,t){return e===re?t:function(r){var n=e.apply(this,arguments);o(r,n);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?oe(i,this.onsuccess):i),s&&(this.onerror=this.onerror?oe(s,this.onerror):s),void 0===n?void 0===a?void 0:a:o(n,a)}}function ce(e,t){return e===re?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function le(e,t){return e===re?t:function(){var r=e.apply(this,arguments);if(r&&"function"==typeof r.then){for(var n=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return r.then((function(){return t.apply(n,o)}))}return t.apply(this,arguments)}}te.ModifyError=H,te.DexieError=G,te.BulkError=X;var he={},fe="undefined"==typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,e.__proto__,e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,t.__proto__,e]}(),pe=fe[0],de=fe[1],ye=fe[2],me=de&&de.then,ge=pe&&pe.constructor,ve=!!ye,we=!1,be=ye?function(){ye.then(Le)}:i.setImmediate?setImmediate.bind(null,Le):i.MutationObserver?function(){var e=document.createElement("div");new MutationObserver((function(){Le(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(Le,0)},_e=function(e,t){De.push([e,t]),Se&&(be(),Se=!1)},Ee=!0,Se=!0,xe=[],ke=[],Ae=null,Be=ne,Ie={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:lt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((function(e){try{lt(e[0],e[1])}catch(e){}}))}},Ce=Ie,De=[],Te=0,Oe=[];function Fe(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=re,this._lib=!1;var t=this._PSD=Ce;if(U&&(this._stackHolder=z(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==he)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&je(this,this._value))}this._state=null,this._value=null,++t.ref,function e(t,r){try{r((function(r){if(null===t._state){if(r===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&ze();r&&"function"==typeof r.then?e(t,(function(e,t){r instanceof Fe?r._then(e,t):r.then(e,t)})):(t._state=!0,t._value=r,Re(t)),n&&qe()}}),je.bind(null,t))}catch(r){je(t,r)}}(this,e)}var Pe={get:function(){var e=Ce,t=Je;function r(r,n){var i=this,o=!e.global&&(e!==Ce||t!==Je);o&&tt();var s=new Fe((function(t,s){Ue(i,new Me(at(r,e,o),at(n,e,o),t,s,e))}));return U&&Ke(s,this),s}return r.prototype=he,r},set:function(e){h(this,"then",e&&e.prototype===he?Pe:{get:function(){return e},set:Pe.set})}};function Me(e,t,r,n,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=r,this.reject=n,this.psd=i}function je(e,t){var r,n;ke.push(t),null===e._state&&(r=e._lib&&ze(),t=Be(t),e._state=!1,e._value=t,U&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,r){try{e.apply(null,void 0)}catch(e){}}((function(){var r=function e(t,r){var n;return p(t,r)||(n=s(t))&&e(n,r)}(t,"stack");t._promise=e,h(t,"stack",{get:function(){return we?r&&(r.get?r.get.apply(t):r.value):e.stack}})})),n=e,xe.some((function(e){return e._value===n._value}))||xe.push(n),Re(e),r&&qe())}function Re(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)Ue(e,t[r]);var i=e._PSD;--i.ref||i.finalize(),0===Te&&(++Te,_e((function(){0==--Te&&$e()}),[]))}function Ue(e,t){if(null!==e._state){var r=e._state?t.onFulfilled:t.onRejected;if(null===r)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Te,_e(Ne,[r,e,t])}else e._listeners.push(t)}function Ne(e,t,r){try{var n,i=(Ae=t)._value;t._state?n=e(i):(ke.length&&(ke=[]),n=e(i),-1===ke.indexOf(i)&&function(e){for(var t=xe.length;t;)if(xe[--t]._value===e._value)return xe.splice(t,1)}(t)),r.resolve(n)}catch(e){r.reject(e)}finally{Ae=null,0==--Te&&$e(),--r.psd.ref||r.psd.finalize()}}function Ke(e,t){var r=t?t._numPrev+1:0;r<100&&(e._prev=t,e._numPrev=r)}function Le(){ze()&&qe()}function ze(){var e=Ee;return Se=Ee=!1,e}function qe(){var e,t,r;do{for(;0<De.length;)for(e=De,De=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}}while(0<De.length);Se=Ee=!0}function $e(){var e=xe;xe=[],e.forEach((function(e){e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Oe.slice(0),r=t.length;r;)t[--r]()}function Ve(e){return new Fe(he,!1,e)}function We(e,t){var r=Ce;return function(){var n=ze(),i=Ce;try{return it(r,!0),e.apply(this,arguments)}catch(n){t&&t(n)}finally{it(i,!1),n&&qe()}}}c(Fe.prototype,{then:Pe,_then:function(e,t){Ue(this,new Me(null,null,e,t,Ce))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=e,r=arguments[1];return"function"==typeof t?this.then(null,(function(e){return(e instanceof t?r:Ve)(e)})):this.then(null,(function(e){return(e&&e.name===t?r:Ve)(e)}))},finally:function(e){return this.then((function(t){return e(),t}),(function(t){return e(),Ve(t)}))},stack:{get:function(){if(this._stack)return this._stack;try{we=!0;var e=function e(t,r,n){if(r.length===n)return r;var i,o,s,a="";return!1===t._state&&(null!=(i=t._value)?(o=i.name||"Error",s=i.message||i,a=q(i,0)):(o=i,s=""),r.push(o+(s?": "+s:"")+a)),U&&((a=q(t._stackHolder,2))&&-1===r.indexOf(a)&&r.push(a),t._prev&&e(t._prev,r,n)),r}(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{we=!1}}},timeout:function(e,t){var r=this;return e<1/0?new Fe((function(n,i){var o=setTimeout((function(){return i(new Z.Timeout(t))}),e);r.then(n,i).finally(clearTimeout.bind(null,o))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&h(Fe.prototype,Symbol.toStringTag,"Dexie.Promise"),Ie.env=ot(),c(Fe,{all:function(){var e=j.apply(null,arguments).map(rt);return new Fe((function(t,r){0===e.length&&t([]);var n=e.length;e.forEach((function(i,o){return Fe.resolve(i).then((function(r){e[o]=r,--n||t(e)}),r)}))}))},resolve:function(e){if(e instanceof Fe)return e;if(e&&"function"==typeof e.then)return new Fe((function(t,r){e.then(t,r)}));var t=new Fe(he,!0,e);return Ke(t,Ae),t},reject:Ve,race:function(){var e=j.apply(null,arguments).map(rt);return new Fe((function(t,r){e.map((function(e){return Fe.resolve(e).then(t,r)}))}))},PSD:{get:function(){return Ce},set:function(e){return Ce=e}},newPSD:Ze,usePSD:st,scheduler:{get:function(){return _e},set:function(e){_e=e}},rejectionMapper:{get:function(){return Be},set:function(e){Be=e}},follow:function(e,t){return new Fe((function(r,n){return Ze((function(t,r){var n=Ce;n.unhandleds=[],n.onunhandled=r,n.finalize=oe((function(){var e,n=this;e=function(){0===n.unhandleds.length?t():r(n.unhandleds[0])},Oe.push((function t(){e(),Oe.splice(Oe.indexOf(t),1)})),++Te,_e((function(){0==--Te&&$e()}),[])}),n.finalize),e()}),t,r,n)}))}}),ge&&(ge.allSettled&&h(Fe,"allSettled",(function(){var e=j.apply(null,arguments).map(rt);return new Fe((function(t){0===e.length&&t([]);var r=e.length,n=new Array(r);e.forEach((function(e,i){return Fe.resolve(e).then((function(e){return n[i]={status:"fulfilled",value:e}}),(function(e){return n[i]={status:"rejected",reason:e}})).then((function(){return--r||t(n)}))}))}))})),ge.any&&"undefined"!=typeof AggregateError&&h(Fe,"any",(function(){var e=j.apply(null,arguments).map(rt);return new Fe((function(t,r){0===e.length&&r(new AggregateError([]));var n=e.length,i=new Array(n);e.forEach((function(e,o){return Fe.resolve(e).then((function(e){return t(e)}),(function(e){i[o]=e,--n||r(new AggregateError(i))}))}))}))})));var Ge={awaits:0,echoes:0,id:0},Ye=0,He=[],Xe=0,Je=0,Qe=0;function Ze(e,t,r,n){var i=Ce,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++Qe;var a=Ie.env;s.env=ve?{Promise:Fe,PromiseProp:{value:Fe,configurable:!0,writable:!0},all:Fe.all,race:Fe.race,allSettled:Fe.allSettled,any:Fe.any,resolve:Fe.resolve,reject:Fe.reject,nthen:ut(a.nthen,s),gthen:ut(a.gthen,s)}:{},t&&o(s,t),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=st(s,e,r,n);return 0===s.ref&&s.finalize(),u}function et(){return Ge.id||(Ge.id=++Ye),++Ge.awaits,Ge.echoes+=100,Ge.id}function tt(e){!Ge.awaits||e&&e!==Ge.id||(0==--Ge.awaits&&(Ge.id=0),Ge.echoes=100*Ge.awaits)}function rt(e){return Ge.echoes&&e&&e.constructor===ge?(et(),e.then((function(e){return tt(),e}),(function(e){return tt(),ht(e)}))):e}function nt(){var e=He[He.length-1];He.pop(),it(e,!1)}function it(e,t){var r,n,o,s=Ce;(t?!Ge.echoes||Xe++&&e===Ce:!Xe||--Xe&&e===Ce)||(r=t?function(e){++Je,Ge.echoes&&0!=--Ge.echoes||(Ge.echoes=Ge.id=0),He.push(Ce),it(e,!0)}.bind(null,e):nt,me.call(pe,r)),e!==Ce&&(Ce=e,s===Ie&&(Ie.env=ot()),ve&&(n=Ie.env.Promise,o=e.env,de.then=o.nthen,n.prototype.then=o.gthen,(s.global||e.global)&&(Object.defineProperty(i,"Promise",o.PromiseProp),n.all=o.all,n.race=o.race,n.resolve=o.resolve,n.reject=o.reject,o.allSettled&&(n.allSettled=o.allSettled),o.any&&(n.any=o.any))))}function ot(){var e=i.Promise;return ve?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(i,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:de.then,gthen:e.prototype.then}:{}}function st(e,t,r,n,i){var o=Ce;try{return it(e,!0),t(r,n,i)}finally{it(o,!1)}}function at(e,t,r){return"function"!=typeof e?e:function(){var n=Ce;r&&et(),it(t,!0);try{return e.apply(this,arguments)}finally{it(n,!1)}}}function ut(e,t){return function(r,n){return e.call(this,at(r,t,!1),at(n,t,!1))}}-1===(""+me).indexOf("[native code]")&&(et=tt=re);var ct="unhandledrejection";function lt(e,t){var r;try{r=t.onuncatched(e)}catch(e){}if(!1!==r)try{var n,s={promise:t,reason:e};if(i.document&&document.createEvent?((n=document.createEvent("Event")).initEvent(ct,!0,!0),o(n,s)):i.CustomEvent&&o(n=new CustomEvent(ct,{detail:s}),s),n&&i.dispatchEvent&&(dispatchEvent(n),!i.PromiseRejectionEvent&&i.onunhandledrejection))try{i.onunhandledrejection(n)}catch(e){}U&&n&&!n.defaultPrevented&&console.warn("Unhandled rejection: "+(e.stack||e))}catch(e){}}var ht=Fe.reject;function ft(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)}var pt=String.fromCharCode(65535),dt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",yt="String expected.",mt=[],gt="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),vt=gt,wt=gt,bt="__dbnames",_t="readonly",Et="readwrite";function St(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var xt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1},kt=(At.prototype._trans=function(e,t,r){var n=this._tx||Ce.trans,i=this.name;function o(e,r,n){if(!n.schema[i])throw new Z.NotFound("Table "+i+" not part of transaction");return t(n.idbtrans,n)}var s=ze();try{return n&&n.db===this.db?n===Ce.trans?n._promise(e,o,r):Ze((function(){return n._promise(e,o,r)}),{trans:n,transless:Ce.transless||Ce}):function e(t,r,n,i){if(t._state.openComplete||Ce.letThrough){var o=t._createTransaction(r,n,t._dbSchema);try{o.create()}catch(e){return ht(e)}return o._promise(r,(function(e,t){return Ze((function(){return Ce.trans=o,i(e,t,o)}))})).then((function(e){return o._completion.then((function(){return e}))}))}if(!t._state.isBeingOpened){if(!t._options.autoOpen)return ht(new Z.DatabaseClosed);t.open().catch(re)}return t._state.dbReadyPromise.then((function(){return e(t,r,n,i)}))}(this.db,e,[this.name],o)}finally{s&&qe()}},At.prototype.get=function(e,t){var r=this;return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(function(t){return r.core.get({trans:t,key:e}).then((function(e){return r.hook.reading.fire(e)}))})).then(t)},At.prototype.where=function(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(n(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var t=r(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var i=this.schema.indexes.concat(this.schema.primKey).filter((function(e){return e.compound&&t.every((function(t){return 0<=e.keyPath.indexOf(t)}))&&e.keyPath.every((function(e){return 0<=t.indexOf(e)}))}))[0];if(i&&this.db._maxKey!==pt)return this.where(i.name).equals(i.keyPath.map((function(t){return e[t]})));!i&&U&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a compound index ["+t.join("+")+"]");var o=this.schema.idxByName,s=this.db._deps.indexedDB;function a(e,t){try{return 0===s.cmp(e,t)}catch(e){return!1}}var u=t.reduce((function(t,r){var i=t[0],s=t[1],u=o[r],c=e[r];return[i||u,i||!u?St(s,u&&u.multi?function(e){var t=b(e,r);return n(t)&&t.some((function(e){return a(c,e)}))}:function(e){return a(c,b(e,r))}):s]}),[null,null]),c=u[0],l=u[1];return c?this.where(c.name).equals(e[c.keyPath]).filter(l):i?this.filter(l):this.where(t).equals("")},At.prototype.filter=function(e){return this.toCollection().and(e)},At.prototype.count=function(e){return this.toCollection().count(e)},At.prototype.offset=function(e){return this.toCollection().offset(e)},At.prototype.limit=function(e){return this.toCollection().limit(e)},At.prototype.each=function(e){return this.toCollection().each(e)},At.prototype.toArray=function(e){return this.toCollection().toArray(e)},At.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},At.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,n(e)?"["+e.join("+")+"]":e))},At.prototype.reverse=function(){return this.toCollection().reverse()},At.prototype.mapToClass=function(e){function t(t){if(!t)return t;var r=Object.create(e.prototype);for(var n in t)if(u(t,n))try{r[n]=t[n]}catch(t){}return r}return this.schema.mappedClass=e,this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e},At.prototype.defineClass=function(){return this.mapToClass((function(e){o(this,e)}))},At.prototype.add=function(e,t){var r=this;return this._trans("readwrite",(function(n){return r.core.mutate({trans:n,type:"add",keys:null!=t?[t]:null,values:[e]})})).then((function(e){return e.numFailures?Fe.reject(e.failures[0]):e.lastResult})).then((function(t){if(!r.core.schema.primaryKey.outbound)try{_(e,r.core.schema.primaryKey.keyPath,t)}catch(t){}return t}))},At.prototype.update=function(e,t){if("object"!=typeof t||n(t))throw new Z.InvalidArgument("Modifications must be an object.");if("object"!=typeof e||n(e))return this.where(":id").equals(e).modify(t);r(t).forEach((function(r){_(e,r,t[r])}));var i=b(e,this.schema.primKey.keyPath);return void 0===i?ht(new Z.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(i).modify(t)},At.prototype.put=function(e,t){var r=this;return this._trans("readwrite",(function(n){return r.core.mutate({trans:n,type:"put",values:[e],keys:null!=t?[t]:null})})).then((function(e){return e.numFailures?Fe.reject(e.failures[0]):e.lastResult})).then((function(t){if(!r.core.schema.primaryKey.outbound)try{_(e,r.core.schema.primaryKey.keyPath,t)}catch(t){}return t}))},At.prototype.delete=function(e){var t=this;return this._trans("readwrite",(function(r){return t.core.mutate({trans:r,type:"delete",keys:[e]})})).then((function(e){return e.numFailures?Fe.reject(e.failures[0]):void 0}))},At.prototype.clear=function(){var e=this;return this._trans("readwrite",(function(t){return e.core.mutate({trans:t,type:"deleteRange",range:xt})})).then((function(e){return e.numFailures?Fe.reject(e.failures[0]):void 0}))},At.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",(function(r){return t.core.getMany({keys:e,trans:r})}))},At.prototype.bulkAdd=function(e,t,r){var n=this,i=Array.isArray(t)?t:void 0,o=(r=r||(i?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(function(t){if(!n.core.schema.primaryKey.outbound&&i)throw new Z.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var r=e.length;return n.core.mutate({trans:t,type:"add",keys:i,values:e,wantResults:o}).then((function(e){var t=e.numFailures,i=e.results,s=e.lastResult,a=e.failures;if(0===t)return o?i:s;throw new X(n.name+".bulkAdd(): "+t+" of "+r+" operations failed",Object.keys(a).map((function(e){return a[e]})))}))}))},At.prototype.bulkPut=function(e,t,r){var n=this,i=Array.isArray(t)?t:void 0,o=(r=r||(i?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(function(t){if(!n.core.schema.primaryKey.outbound&&i)throw new Z.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var r=e.length;return n.core.mutate({trans:t,type:"put",keys:i,values:e,wantResults:o}).then((function(e){var t=e.numFailures,i=e.results,s=e.lastResult,a=e.failures;if(0===t)return o?i:s;throw new X(n.name+".bulkPut(): "+t+" of "+r+" operations failed",Object.keys(a).map((function(e){return a[e]})))}))}))},At.prototype.bulkDelete=function(e){var t=this,r=e.length;return this._trans("readwrite",(function(r){return t.core.mutate({trans:r,type:"delete",keys:e})})).then((function(e){var n=e.numFailures,i=e.lastResult,o=e.failures;if(0===n)return i;throw new X(t.name+".bulkDelete(): "+n+" of "+r+" operations failed",o)}))},At);function At(){}function Bt(e){var t={},i=function(r,n){if(n){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return t[r].subscribe.apply(null,o),e}if("string"==typeof r)return t[r]};i.addEventType=a;for(var o=1,s=arguments.length;o<s;++o)a(arguments[o]);return i;function a(e,o,s){if("object"!=typeof e){var u;o=o||ce;var c={subscribers:[],fire:s=s||re,subscribe:function(e){-1===c.subscribers.indexOf(e)&&(c.subscribers.push(e),c.fire=o(c.fire,e))},unsubscribe:function(e){c.subscribers=c.subscribers.filter((function(t){return t!==e})),c.fire=c.subscribers.reduce(o,s)}};return t[e]=i[e]=c,c}r(u=e).forEach((function(e){var t=u[e];if(n(t))a(e,u[e][0],u[e][1]);else{if("asap"!==t)throw new Z.InvalidArgument("Invalid event config");var r=a(e,ne,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach((function(e){v((function(){e.apply(null,t)}))}))}))}}))}}function It(e,t){return f(t).from({prototype:e}),t}function Ct(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Dt(e,t){e.filter=St(e.filter,t)}function Tt(e,t,r){var n=e.replayFilter;e.replayFilter=n?function(){return St(n(),t())}:t,e.justLimit=r&&!n}function Ot(e,t){if(e.isPrimKey)return t.primaryKey;var r=t.getIndexByKeyPath(e.index);if(!r)throw new Z.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function Ft(e,t,r){var n=Ot(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:n,range:e.range}})}function Pt(e,t,r,n){var i=e.replayFilter?St(e.filter,e.replayFilter()):e.filter;if(e.or){var o={},s=function(e,r,n){var s,a;i&&!i(r,n,(function(e){return r.stop(e)}),(function(e){return r.fail(e)}))||("[object ArrayBuffer]"==(a=""+(s=r.primaryKey))&&(a=""+new Uint8Array(s)),u(o,a)||(o[a]=!0,t(e,r,n)))};return Promise.all([e.or._iterate(s,r),Mt(Ft(e,n,r),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}return Mt(Ft(e,n,r),St(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Mt(e,t,r,n){var i=We(n?function(e,t,i){return r(n(e),t,i)}:r);return e.then((function(e){if(e)return e.start((function(){var r=function(){return e.continue()};t&&!t(e,(function(e){return r=e}),(function(t){e.stop(t),r=re}),(function(t){e.fail(t),r=re}))||i(e.value,e,(function(e){return r=e})),r()}))}))}var jt=(Rt.prototype._read=function(e,t){var r=this._ctx;return r.error?r.table._trans(null,ht.bind(null,r.error)):r.table._trans("readonly",e).then(t)},Rt.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,ht.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},Rt.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=St(t.algorithm,e)},Rt.prototype._iterate=function(e,t){return Pt(this._ctx,e,t,this._ctx.table.core)},Rt.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&o(r,e),t._ctx=r,t},Rt.prototype.raw=function(){return this._ctx.valueMapper=null,this},Rt.prototype.each=function(e){var t=this._ctx;return this._read((function(r){return Pt(t,e,r,t.table.core)}))},Rt.prototype.count=function(e){var t=this;return this._read((function(e){var r=t._ctx,n=r.table.core;if(Ct(r,!0))return n.count({trans:e,query:{index:Ot(r,n.schema),range:r.range}}).then((function(e){return Math.min(e,r.limit)}));var i=0;return Pt(r,(function(){return++i,!1}),e,n).then((function(){return i}))})).then(e)},Rt.prototype.sortBy=function(e,t){var r=e.split(".").reverse(),n=r[0],i=r.length-1;function o(e,t){return t?o(e[r[t]],t-1):e[n]}var s="next"===this._ctx.dir?1:-1;function a(e,t){var r=o(e,i),n=o(t,i);return r<n?-s:n<r?s:0}return this.toArray((function(e){return e.sort(a)})).then(t)},Rt.prototype.toArray=function(e){var t=this;return this._read((function(e){var r=t._ctx;if("next"===r.dir&&Ct(r,!0)&&0<r.limit){var n=r.valueMapper,i=Ot(r,r.table.core.schema);return r.table.core.query({trans:e,limit:r.limit,values:!0,query:{index:i,range:r.range}}).then((function(e){var t=e.result;return n?t.map(n):t}))}var o=[];return Pt(r,(function(e){return o.push(e)}),e,r.table.core).then((function(){return o}))}),e)},Rt.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Ct(t)?Tt(t,(function(){var t=e;return function(e,r){return 0===t||(1===t?--t:r((function(){e.advance(t),t=0})),!1)}})):Tt(t,(function(){var t=e;return function(){return--t<0}}))),this},Rt.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Tt(this._ctx,(function(){var t=e;return function(e,r,n){return--t<=0&&r(n),0<=t}}),!0),this},Rt.prototype.until=function(e,t){return Dt(this._ctx,(function(r,n,i){return!e(r.value)||(n(i),t)})),this},Rt.prototype.first=function(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)},Rt.prototype.last=function(e){return this.reverse().first(e)},Rt.prototype.filter=function(e){var t,r;return Dt(this._ctx,(function(t){return e(t.value)})),t=this._ctx,r=e,t.isMatch=St(t.isMatch,r),this},Rt.prototype.and=function(e){return this.filter(e)},Rt.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},Rt.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Rt.prototype.desc=function(){return this.reverse()},Rt.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.key,r)}))},Rt.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},Rt.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.primaryKey,r)}))},Rt.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.key)})).then((function(){return r})).then(e)},Rt.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&Ct(t,!0)&&0<t.limit)return this._read((function(e){var r=Ot(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:r,range:t.range}})})).then((function(e){return e.result})).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.primaryKey)})).then((function(){return r})).then(e)},Rt.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},Rt.prototype.firstKey=function(e){return this.limit(1).keys((function(e){return e[0]})).then(e)},Rt.prototype.lastKey=function(e){return this.reverse().firstKey(e)},Rt.prototype.distinct=function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return Dt(this._ctx,(function(e){var t=e.primaryKey.toString(),n=u(r,t);return r[t]=!0,!n})),this},Rt.prototype.modify=function(e){var t=this,n=this._ctx;return this._write((function(i){var o,s,a;function u(e,t){var n=t.failures,i=t.numFailures;m+=e-i;for(var o=0,s=r(n);o<s.length;o++){var a=s[o];y.push(n[a])}}a="function"==typeof e?e:(o=r(e),s=o.length,function(t){for(var r=!1,n=0;n<s;++n){var i=o[n],a=e[i];b(t,i)!==a&&(_(t,i,a),r=!0)}return r});var c=n.table.core,l=c.schema.primaryKey,h=l.outbound,f=l.extractKey,p="testmode"in Ar?1:2e3,d=t.db.core.cmp,y=[],m=0,g=[];return t.clone().primaryKeys().then((function(e){var t=function(r){var n=Math.min(p,e.length-r);return c.getMany({trans:i,keys:e.slice(r,r+n)}).then((function(o){for(var s=[],l=[],y=h?[]:null,m=[],g=0;g<n;++g){var v=o[g],w={value:I(v),primKey:e[r+g]};!1!==a.call(w,w.value,w)&&(null==w.value?m.push(e[r+g]):h||0===d(f(v),f(w.value))?(l.push(w.value),h&&y.push(e[r+g])):(m.push(e[r+g]),s.push(w.value)))}return Promise.resolve(0<s.length&&c.mutate({trans:i,type:"add",values:s}).then((function(e){for(var t in e.failures)m.splice(parseInt(t),1);u(s.length,e)}))).then((function(e){return 0<l.length&&c.mutate({trans:i,type:"put",keys:y,values:l}).then((function(e){return u(l.length,e)}))})).then((function(){return 0<m.length&&c.mutate({trans:i,type:"delete",keys:m}).then((function(e){return u(m.length,e)}))})).then((function(){return e.length>r+n&&t(r+p)}))}))};return t(0).then((function(){if(0<y.length)throw new H("Error modifying one or more objects",y,m,g);return e.length}))}))}))},Rt.prototype.delete=function(){var e=this._ctx,t=e.range;return Ct(e)&&(e.isPrimKey&&!wt||3===t.type)?this._write((function(r){var n=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:r,query:{index:n,range:i}}).then((function(t){return e.table.core.mutate({trans:r,type:"deleteRange",range:i}).then((function(e){var r=e.failures,n=(e.lastResult,e.results,e.numFailures);if(n)throw new H("Could not delete some values",Object.keys(r).map((function(e){return r[e]})),t-n);return t-n}))}))})):this.modify((function(e,t){return t.value=null}))},Rt);function Rt(){}function Ut(e,t){return e<t?-1:e===t?0:1}function Nt(e,t){return t<e?-1:e===t?0:1}function Kt(e,t,r){var n=e instanceof Wt?new e.Collection(e):e;return n._ctx.error=new(r||TypeError)(t),n}function Lt(e){return new e.Collection(e,(function(){return Vt("")})).limit(0)}function zt(e,t,r,n,i,o){for(var s=Math.min(e.length,n.length),a=-1,u=0;u<s;++u){var c=t[u];if(c!==n[u])return i(e[u],r[u])<0?e.substr(0,u)+r[u]+r.substr(u+1):i(e[u],n[u])<0?e.substr(0,u)+n[u]+r.substr(u+1):0<=a?e.substr(0,a)+t[a]+r.substr(a+1):null;i(e[u],c)<0&&(a=u)}return s<n.length&&"next"===o?e+r.substr(e.length):s<e.length&&"prev"===o?e.substr(0,r.length):a<0?null:e.substr(0,a)+n[a]+r.substr(a+1)}function qt(e,t,r,n){var i,o,s,a,u,c,l,h=r.length;if(!r.every((function(e){return"string"==typeof e})))return Kt(e,yt);function f(e){i="next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()},o="next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()},s="next"===e?Ut:Nt;var t=r.map((function(e){return{lower:o(e),upper:i(e)}})).sort((function(e,t){return s(e.lower,t.lower)}));a=t.map((function(e){return e.upper})),u=t.map((function(e){return e.lower})),l="next"===(c=e)?"":n}f("next");var p=new e.Collection(e,(function(){return $t(a[0],u[h-1]+n)}));p._ondirectionchange=function(e){f(e)};var d=0;return p._addAlgorithm((function(e,r,n){var i=e.key;if("string"!=typeof i)return!1;var f=o(i);if(t(f,u,d))return!0;for(var p=null,y=d;y<h;++y){var m=zt(i,f,a[y],u[y],s,c);null===m&&null===p?d=y+1:(null===p||0<s(p,m))&&(p=m)}return r(null!==p?function(){e.continue(p+l)}:n),!1})),p}function $t(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function Vt(e){return{type:1,lower:e,upper:e}}var Wt=(Object.defineProperty(Gt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!0,configurable:!0}),Gt.prototype.between=function(e,t,r,n){r=!1!==r,n=!0===n;try{return 0<this._cmp(e,t)||0===this._cmp(e,t)&&(r||n)&&(!r||!n)?Lt(this):new this.Collection(this,(function(){return $t(e,t,!r,!n)}))}catch(e){return Kt(this,dt)}},Gt.prototype.equals=function(e){return new this.Collection(this,(function(){return Vt(e)}))},Gt.prototype.above=function(e){return null==e?Kt(this,dt):new this.Collection(this,(function(){return $t(e,void 0,!0)}))},Gt.prototype.aboveOrEqual=function(e){return null==e?Kt(this,dt):new this.Collection(this,(function(){return $t(e,void 0,!1)}))},Gt.prototype.below=function(e){return null==e?Kt(this,dt):new this.Collection(this,(function(){return $t(void 0,e,!1,!0)}))},Gt.prototype.belowOrEqual=function(e){return null==e?Kt(this,dt):new this.Collection(this,(function(){return $t(void 0,e)}))},Gt.prototype.startsWith=function(e){return"string"!=typeof e?Kt(this,yt):this.between(e,e+pt,!0,!0)},Gt.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):qt(this,(function(e,t){return 0===e.indexOf(t[0])}),[e],pt)},Gt.prototype.equalsIgnoreCase=function(e){return qt(this,(function(e,t){return e===t[0]}),[e],"")},Gt.prototype.anyOfIgnoreCase=function(){var e=j.apply(M,arguments);return 0===e.length?Lt(this):qt(this,(function(e,t){return-1!==t.indexOf(e)}),e,"")},Gt.prototype.startsWithAnyOfIgnoreCase=function(){var e=j.apply(M,arguments);return 0===e.length?Lt(this):qt(this,(function(e,t){return t.some((function(t){return 0===e.indexOf(t)}))}),e,pt)},Gt.prototype.anyOf=function(){var e=this,t=j.apply(M,arguments),r=this._cmp;try{t.sort(r)}catch(n){return Kt(this,dt)}if(0===t.length)return Lt(this);var n=new this.Collection(this,(function(){return $t(t[0],t[t.length-1])}));n._ondirectionchange=function(n){r="next"===n?e._ascending:e._descending,t.sort(r)};var i=0;return n._addAlgorithm((function(e,n,o){for(var s=e.key;0<r(s,t[i]);)if(++i===t.length)return n(o),!1;return 0===r(s,t[i])||(n((function(){e.continue(t[i])})),!1)})),n},Gt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Gt.prototype.noneOf=function(){var e=j.apply(M,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return Kt(this,dt)}var t=e.reduce((function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]}),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},Gt.prototype.inAnyRange=function(e,t){var r=this,n=this._cmp,i=this._ascending,o=this._descending,s=this._min,a=this._max;if(0===e.length)return Lt(this);if(!e.every((function(e){return void 0!==e[0]&&void 0!==e[1]&&i(e[0],e[1])<=0})))return Kt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Z.InvalidArgument);var u,c=!t||!1!==t.includeLowers,l=t&&!0===t.includeUppers,h=i;function f(e,t){return h(e[0],t[0])}try{(u=e.reduce((function(e,t){for(var r=0,i=e.length;r<i;++r){var o=e[r];if(n(t[0],o[1])<0&&0<n(t[1],o[0])){o[0]=s(o[0],t[0]),o[1]=a(o[1],t[1]);break}}return r===i&&e.push(t),e}),[])).sort(f)}catch(e){return Kt(this,dt)}var p=0,d=l?function(e){return 0<i(e,u[p][1])}:function(e){return 0<=i(e,u[p][1])},y=c?function(e){return 0<o(e,u[p][0])}:function(e){return 0<=o(e,u[p][0])},m=d,g=new this.Collection(this,(function(){return $t(u[0][0],u[u.length-1][1],!c,!l)}));return g._ondirectionchange=function(e){h="next"===e?(m=d,i):(m=y,o),u.sort(f)},g._addAlgorithm((function(e,t,n){for(var o,s=e.key;m(s);)if(++p===u.length)return t(n),!1;return!d(o=s)&&!y(o)||(0===r._cmp(s,u[p][1])||0===r._cmp(s,u[p][0])||t((function(){h===i?e.continue(u[p][0]):e.continue(u[p][1])})),!1)})),g},Gt.prototype.startsWithAnyOf=function(){var e=j.apply(M,arguments);return e.every((function(e){return"string"==typeof e}))?0===e.length?Lt(this):this.inAnyRange(e.map((function(e){return[e,e+pt]}))):Kt(this,"startsWithAnyOf() only works with strings")},Gt);function Gt(){}function Yt(e){return 1===e.length?e[0]:e}function Ht(e){try{return e.only([[]]),[[]]}catch(e){return pt}}function Xt(e){return We((function(t){return Jt(t),e(t.target.error),!1}))}function Jt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Qt=(Zt.prototype._lock=function(){return g(!Ce.global),++this._reculock,1!==this._reculock||Ce.global||(Ce.lockOwnerFor=this),this},Zt.prototype._unlock=function(){if(g(!Ce.global),0==--this._reculock)for(Ce.global||(Ce.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{st(e[1],e[0])}catch(e){}}return this},Zt.prototype._locked=function(){return this._reculock&&Ce.lockOwnerFor!==this},Zt.prototype.create=function(e){var t=this;if(!this.mode)return this;var r=this.db.idbdb,n=this.db._state.dbOpenError;if(g(!this.idbtrans),!e&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new Z.DatabaseClosed(n);case"MissingAPIError":throw new Z.MissingAPI(n.message,n);default:throw new Z.OpenFailed(n)}if(!this.active)throw new Z.TransactionInactive;return g(null===this._completion._state),(e=this.idbtrans=e||r.transaction(Yt(this.storeNames),this.mode)).onerror=We((function(r){Jt(r),t._reject(e.error)})),e.onabort=We((function(r){Jt(r),t.active&&t._reject(new Z.Abort(e.error)),t.active=!1,t.on("abort").fire(r)})),e.oncomplete=We((function(){t.active=!1,t._resolve()})),this},Zt.prototype._promise=function(e,t,r){var n=this;if("readwrite"===e&&"readwrite"!==this.mode)return ht(new Z.ReadOnly("Transaction is readonly"));if(!this.active)return ht(new Z.TransactionInactive);if(this._locked())return new Fe((function(i,o){n._blockedFuncs.push([function(){n._promise(e,t,r).then(i,o)},Ce])}));if(r)return Ze((function(){var e=new Fe((function(e,r){n._lock();var i=t(e,r,n);i&&i.then&&i.then(e,r)}));return e.finally((function(){return n._unlock()})),e._lib=!0,e}));var i=new Fe((function(e,r){var i=t(e,r,n);i&&i.then&&i.then(e,r)}));return i._lib=!0,i},Zt.prototype._root=function(){return this.parent?this.parent._root():this},Zt.prototype.waitFor=function(e){var t,r=this._root(),n=Fe.resolve(e);r._waitingFor?r._waitingFor=r._waitingFor.then((function(){return n})):(r._waitingFor=n,r._waitingQueue=[],t=r.idbtrans.objectStore(r.storeNames[0]),function e(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(t.get(-1/0).onsuccess=e)}());var i=r._waitingFor;return new Fe((function(e,t){n.then((function(t){return r._waitingQueue.push(We(e.bind(null,t)))}),(function(e){return r._waitingQueue.push(We(t.bind(null,e)))})).finally((function(){r._waitingFor===i&&(r._waitingFor=null)}))}))},Zt.prototype.abort=function(){this.active&&this._reject(new Z.Abort),this.active=!1},Zt.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(u(t,e))return t[e];var r=this.schema[e];if(!r)throw new Z.NotFound("Table "+e+" not part of transaction");var n=new this.db.Table(e,r,this);return n.core=this.db.core.table(e),t[e]=n},Zt);function Zt(){}function er(e,t,r,n,i,o,s){return{name:e,keyPath:t,unique:r,multi:n,auto:i,compound:o,src:(r&&!s?"&":"")+(n?"*":"")+(i?"++":"")+tr(t)}}function tr(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function rr(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:w(r,(function(e){return[e.name,e]}))}}function nr(e){return null==e?function(){}:"string"==typeof e?1===(t=e).split(".").length?function(e){return e[t]}:function(e){return b(e,t)}:function(t){return b(t,e)};var t}function ir(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}function or(e){return[].slice.call(e)}var sr=0;function ar(e){return null==e?":id":"string"==typeof e?e:"["+e.join("+")+"]"}function ur(e,r,i,o){var s=r.cmp.bind(r);function a(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var t=e.lower,r=e.upper,n=e.lowerOpen,o=e.upperOpen;return void 0===t?void 0===r?null:i.upperBound(r,!!o):void 0===r?i.lowerBound(t,!!n):i.bound(t,r,!!n,!!o)}var u,c,l,h=(c=o,l=or((u=e).objectStoreNames),{schema:{name:u.name,tables:l.map((function(e){return c.objectStore(e)})).map((function(e){var t=e.keyPath,r=e.autoIncrement,i=n(t),o=null==t,s={},a={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:o,compound:i,keyPath:t,autoIncrement:r,unique:!0,extractKey:nr(t)},indexes:or(e.indexNames).map((function(t){return e.index(t)})).map((function(e){var t=e.name,r=e.unique,i=e.multiEntry,o=e.keyPath,a={name:t,compound:n(o),keyPath:o,unique:r,multiEntry:i,extractKey:nr(o)};return s[ar(o)]=a})),getIndexByKeyPath:function(e){return s[ar(e)]}};return s[":id"]=a.primaryKey,null!=t&&(s[ar(t)]=a.primaryKey),a}))},hasGetAll:0<l.length&&"getAll"in c.objectStore(l[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),f=h.schema,p=h.hasGetAll,d=f.tables.map((function(e){var r,n=e.name;return{name:n,schema:e,mutate:function(r){var i=r.trans,o=r.type,s=r.keys,u=r.values,c=r.range,l=r.wantResults;return new Promise((function(r,h){r=We(r);var f=i.objectStore(n),p=null==f.keyPath,d="put"===o||"add"===o;if(!d&&"delete"!==o&&"deleteRange"!==o)throw new Error("Invalid operation type: "+o);var y=(s||u||{length:1}).length;if(s&&u&&s.length!==u.length)throw new Error("Given keys array must have same length as given values array.");if(0===y)return r({numFailures:0,failures:{},results:[],lastResult:void 0});function m(e){++_,Jt(e),w&&(w[e.target._reqno]=void 0),b[e.target._reqno]=e.target.error}function g(e){var t=e.target;w[t._reqno]=t.result}var v,w=l&&t(s||ir(e.primaryKey,{type:o,keys:s,values:u})),b=[],_=0;if("deleteRange"===o){if(4===c.type)return r({numFailures:_,failures:b,results:w,lastResult:void 0});v=3===c.type?f.clear():f.delete(a(c))}else{var E=d?p?[u,s]:[u,null]:[s,null],S=E[0],x=E[1];if(d)for(var k=0;k<y;++k)(v=x&&void 0!==x[k]?f[o](S[k],x[k]):f[o](S[k]))._reqno=k,w&&void 0===w[k]&&(v.onsuccess=g),v.onerror=m;else for(k=0;k<y;++k)(v=f[o](S[k]))._reqno=k,v.onerror=m}function A(e){var t=e.target.result;w&&(w[y-1]=t),r({numFailures:_,failures:b,results:w,lastResult:t})}v.onerror=function(e){m(e),A(e)},v.onsuccess=A}))},getMany:function(e){var t=e.trans,r=e.keys;return new Promise((function(e,i){e=We(e);for(var o,s=t.objectStore(n),a=r.length,u=new Array(a),c=0,l=0,h=function(t){var r=t.target;u[r._pos]=r.result,++l===c&&e(u)},f=Xt(i),p=0;p<a;++p)null!=r[p]&&((o=s.get(r[p]))._pos=p,o.onsuccess=h,o.onerror=f,++c);0===c&&e(u)}))},get:function(e){var t=e.trans,r=e.key;return new Promise((function(e,i){e=We(e);var o=t.objectStore(n).get(r);o.onsuccess=function(t){return e(t.target.result)},o.onerror=Xt(i)}))},query:(r=p,function(e){return new Promise((function(t,i){t=We(t);var o,s,u,c,l=e.trans,h=e.values,f=e.limit,p=e.query,d=f===1/0?void 0:f,y=p.index,m=p.range,g=l.objectStore(n),v=y.isPrimaryKey?g:g.index(y.name),w=a(m);if(0===f)return t({result:[]});r?((o=h?v.getAll(w,d):v.getAllKeys(w,d)).onsuccess=function(e){return t({result:e.target.result})},o.onerror=Xt(i)):(s=0,u=!h&&"openKeyCursor"in v?v.openKeyCursor(w):v.openCursor(w),c=[],u.onsuccess=function(e){var r=u.result;return r?(c.push(h?r.value:r.primaryKey),++s===f?t({result:c}):void r.continue()):t({result:c})},u.onerror=Xt(i))}))}),openCursor:function(e){var t=e.trans,r=e.values,i=e.query,o=e.reverse,s=e.unique;return new Promise((function(e,u){e=We(e);var c=i.index,l=i.range,h=t.objectStore(n),f=c.isPrimaryKey?h:h.index(c.name),p=o?s?"prevunique":"prev":s?"nextunique":"next",d=!r&&"openKeyCursor"in f?f.openKeyCursor(a(l),p):f.openCursor(a(l),p);d.onerror=Xt(u),d.onsuccess=We((function(r){var n,i,o,s,a=d.result;a?(a.___id=++sr,a.done=!1,n=a.continue.bind(a),i=(i=a.continuePrimaryKey)&&i.bind(a),o=a.advance.bind(a),s=function(){throw new Error("Cursor not stopped")},a.trans=t,a.stop=a.continue=a.continuePrimaryKey=a.advance=function(){throw new Error("Cursor not started")},a.fail=We(u),a.next=function(){var e=this,t=1;return this.start((function(){return t--?e.continue():e.stop()})).then((function(){return e}))},a.start=function(e){function t(){if(d.result)try{e()}catch(e){a.fail(e)}else a.done=!0,a.start=function(){throw new Error("Cursor behind last entry")},a.stop()}var r=new Promise((function(e,t){e=We(e),d.onerror=Xt(t),a.fail=t,a.stop=function(t){a.stop=a.continue=a.continuePrimaryKey=a.advance=s,e(t)}}));return d.onsuccess=We((function(e){(d.onsuccess=t)()})),a.continue=n,a.continuePrimaryKey=i,a.advance=o,t(),r},e(a)):e(null)}),u)}))},count:function(e){var t=e.query,r=e.trans,i=t.index,o=t.range;return new Promise((function(e,t){var s=r.objectStore(n),u=i.isPrimaryKey?s:s.index(i.name),c=a(o),l=c?u.count(c):u.count();l.onsuccess=We((function(t){return e(t.target.result)})),l.onerror=Xt(t)}))}}})),y={};return d.forEach((function(e){return y[e.name]=e})),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!y[e])throw new Error("Table '"+e+"' not found");return y[e]},cmp:s,MIN_KEY:-1/0,MAX_KEY:Ht(i),schema:f}}function cr(t,r){var n=r.db,i=function(t,r,n,i){var o,s=n.IDBKeyRange;return{dbcore:(o=ur(r,n.indexedDB,s,i),t.dbcore.reduce((function(t,r){var n=r.create;return e(e({},t),n(t))}),o))}}(t._middlewares,n,t._deps,r);t.core=i.dbcore,t.tables.forEach((function(e){var r=e.name;t.core.schema.tables.some((function(e){return e.name===r}))&&(e.core=t.core.table(r),t[r]instanceof t.Table&&(t[r].core=e.core))}))}function lr(e,t,r,n){r.forEach((function(r){var i=n[r];t.forEach((function(t){r in t||(t===e.Transaction.prototype||t instanceof e.Transaction?h(t,r,{get:function(){return this.table(r)},set:function(e){l(this,r,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[r]=new e.Table(r,i))}))}))}function hr(e,t){t.forEach((function(t){for(var r in t)t[r]instanceof e.Table&&delete t[r]}))}function fr(e,t){return e._cfg.version-t._cfg.version}function pr(e,t,r,n){var i=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach((function(e){return dr(i,e)})),i}function dr(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function yr(e,t,r){var n={};return y(t.objectStoreNames,0).forEach((function(e){for(var t=r.objectStore(e),i=er(tr(u=t.keyPath),u||"",!1,!1,!!t.autoIncrement,u&&"string"!=typeof u,!0),o=[],s=0;s<t.indexNames.length;++s){var a=t.index(t.indexNames[s]),u=a.keyPath,c=er(a.name,u,!!a.unique,!!a.multiEntry,!1,u&&"string"!=typeof u,!1);o.push(c)}n[e]=rr(e,i,o)})),n}function mr(e,t,r){for(var n=r.db.objectStoreNames,o=0;o<n.length;++o){var s=n[o],a=r.objectStore(s);e._hasGetAll="getAll"in a;for(var u=0;u<a.indexNames.length;++u){var c,l=a.indexNames[u],h=a.index(l).keyPath,f="string"==typeof h?h:"["+y(h).join("+")+"]";!t[s]||(c=t[s].idxByName[f])&&(c.name=l,delete t[s].idxByName[f],t[s].idxByName[l]=c)}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}var gr,vr=(wr.prototype._parseStoresSpec=function(e,t){r(e).forEach((function(r){if(null!==e[r]){var i=e[r].split(",").map((function(e,t){var r=(e=e.trim()).replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return er(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),n(i),0===t)})),o=i.shift();if(o.multi)throw new Z.Schema("Primary key cannot be multi-valued");i.forEach((function(e){if(e.auto)throw new Z.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new Z.Schema("Index must have a name and cannot be an empty string")})),t[r]=rr(r,o,i)}}))},wr.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?o(this._cfg.storesSource,e):e;var n=t._versions,i={},s={};return n.forEach((function(e){o(i,e._cfg.storesSource),s=e._cfg.dbschema={},e._parseStoresSpec(i,s)})),t._dbSchema=s,hr(t,[t._allTables,t,t.Transaction.prototype]),lr(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],r(s),s),t._storeNames=r(s),this},wr.prototype.upgrade=function(e){return this._cfg.contentUpgrade=e,this},wr);function wr(){}function br(e){return Ze((function(){return Ce.letThrough=!0,e()}))}function _r(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((function(){return t.dbOpenError?ht(t.dbOpenError):e}));U&&(t.openCanceller._stackHolder=z()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var i=t.dbReadyResolve,o=null;return Fe.race([t.openCanceller,new Fe((function(i,s){if(!n)throw new Z.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var a=e.name,u=t.autoSchema?n.open(a):n.open(a,Math.round(10*e.verno));if(!u)throw new Z.MissingAPI("IndexedDB API not available");u.onerror=Xt(s),u.onblocked=We(e._fireOnBlocked),u.onupgradeneeded=We((function(i){var c,l;o=u.transaction,t.autoSchema&&!e._options.allowEmptyDB?(u.onerror=Jt,o.abort(),u.result.close(),(c=n.deleteDatabase(a)).onsuccess=c.onerror=We((function(){s(new Z.NoSuchDatabase("Database "+a+" doesnt exist"))}))):(o.onerror=Xt(s),l=i.oldVersion>Math.pow(2,62)?0:i.oldVersion,e.idbdb=u.result,function(e,t,n,i){var o=e._dbSchema,s=e._createTransaction("readwrite",e._storeNames,o);s.create(n),s._completion.catch(i);var a=s._reject.bind(s),u=Ce.transless||Ce;Ze((function(){var i,c,l,h,f,p,d,y;Ce.trans=s,Ce.transless=u,0===t?(r(o).forEach((function(e){pr(n,e,o[e].primKey,o[e].indexes)})),cr(e,n),Fe.follow((function(){return e.on.populate.fire(s)})).catch(a)):(c=t,l=s,h=n,f=[],p=(i=e)._versions,d=i._dbSchema=yr(0,i.idbdb,h),y=!1,p.filter((function(e){return e._cfg.version>=c})).forEach((function(e){f.push((function(){var t=d,n=e._cfg.dbschema;mr(i,t,h),mr(i,n,h),d=i._dbSchema=n;var o=function(e,t){var r,n={del:[],add:[],change:[]};for(r in e)t[r]||n.del.push(r);for(r in t){var i=e[r],o=t[r];if(i){var s={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(i.primKey.src===o.primKey.src||gt){var a=i.idxByName,u=o.idxByName,c=void 0;for(c in a)u[c]||s.del.push(c);for(c in u){var l=a[c],h=u[c];l?l.src!==h.src&&s.change.push(h):s.add.push(h)}(0<s.del.length||0<s.add.length||0<s.change.length)&&n.change.push(s)}else s.recreate=!0,n.change.push(s)}else n.add.push([r,o])}return n}(t,n);o.add.forEach((function(e){pr(h,e[0],e[1].primKey,e[1].indexes)})),o.change.forEach((function(e){if(e.recreate)throw new Z.Upgrade("Not yet support for changing primary key");var t=h.objectStore(e.name);e.add.forEach((function(e){return dr(t,e)})),e.change.forEach((function(e){t.deleteIndex(e.name),dr(t,e)})),e.del.forEach((function(e){return t.deleteIndex(e)}))}));var s=e._cfg.contentUpgrade;if(s&&e._cfg.version>c){cr(i,h),y=!0;var a=E(n);o.del.forEach((function(e){a[e]=t[e]})),hr(i,[i.Transaction.prototype]),lr(i,[i.Transaction.prototype],r(a),a),l.schema=a;var u,f=R(s);f&&et();var p=Fe.follow((function(){var e;(u=s(l))&&f&&(e=tt.bind(null,null),u.then(e,e))}));return u&&"function"==typeof u.then?Fe.resolve(u):p.then((function(){return u}))}})),f.push((function(t){y&&vt||function(e,t){for(var r=0;r<t.db.objectStoreNames.length;++r){var n=t.db.objectStoreNames[r];null==e[n]&&t.db.deleteObjectStore(n)}}(e._cfg.dbschema,t),hr(i,[i.Transaction.prototype]),lr(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),l.schema=i._dbSchema}))})),function e(){return f.length?Fe.resolve(f.shift()(l.idbtrans)).then(e):Fe.resolve()}().then((function(){var e,t;t=h,r(e=d).forEach((function(r){t.db.objectStoreNames.contains(r)||pr(t,r,e[r].primKey,e[r].indexes)}))})).catch(a))}))}(e,l/10,o,s))}),s),u.onsuccess=We((function(){o=null;var n=e.idbdb=u.result,s=y(n.objectStoreNames);if(0<s.length)try{var c=n.transaction(Yt(s),"readonly");t.autoSchema?function(e,t,n){e.verno=t.version/10;var i=e._dbSchema=yr(0,t,n);e._storeNames=y(t.objectStoreNames,0),lr(e,[e._allTables],r(i),i)}(e,n,c):mr(e,e._dbSchema,c),cr(e,c)}catch(n){}mt.push(e),n.onversionchange=We((function(r){t.vcFired=!0,e.on("versionchange").fire(r)})),gr.add(a),i()}),s)}))]).then((function(){return t.onReadyBeingFired=[],Fe.resolve(br(e.on.ready.fire)).then((function e(){if(0<t.onReadyBeingFired.length){var r=t.onReadyBeingFired.reduce(le,re);return t.onReadyBeingFired=[],Fe.resolve(br(r)).then(e)}}))})).finally((function(){t.onReadyBeingFired=null})).then((function(){return t.isBeingOpened=!1,e})).catch((function(r){try{o&&o.abort()}catch(r){}return t.isBeingOpened=!1,e.close(),t.dbOpenError=r,ht(t.dbOpenError)})).finally((function(){t.openComplete=!0,i()}))}function Er(e){function t(t){return e.next(t)}var r=o(t),i=o((function(t){return e.throw(t)}));function o(e){return function(t){var o=e(t),s=o.value;return o.done?s:s&&"function"==typeof s.then?s.then(r,i):n(s)?Promise.all(s).then(r,i):r(s)}}return o(t)()}function Sr(e,t,r){for(var i=n(e)?e.slice():[e],o=0;o<r;++o)i.push(t);return i}var xr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return e(e({},t),{table:function(r){var n=t.table(r),i=n.schema,o={},s=[];function a(t,r,n){var i=ar(t),u=o[i]=o[i]||[],c=null==t?0:"string"==typeof t?1:t.length,l=0<r,h=e(e({},n),{isVirtual:l,isPrimaryKey:!l&&n.isPrimaryKey,keyTail:r,keyLength:c,extractKey:nr(t),unique:!l&&n.unique});return u.push(h),h.isPrimaryKey||s.push(h),1<c&&a(2===c?t[0]:t.slice(0,c-1),r+1,n),u.sort((function(e,t){return e.keyTail-t.keyTail})),h}var u=a(i.primaryKey.keyPath,0,i.primaryKey);o[":id"]=[u];for(var c=0,l=i.indexes;c<l.length;c++){var h=l[c];a(h.keyPath,0,h)}function f(r){var n,i,o=r.query.index;return o.isVirtual?e(e({},r),{query:{index:o,range:(n=r.query.range,i=o.keyTail,{type:1===n.type?2:n.type,lower:Sr(n.lower,n.lowerOpen?t.MAX_KEY:t.MIN_KEY,i),lowerOpen:!0,upper:Sr(n.upper,n.upperOpen?t.MIN_KEY:t.MAX_KEY,i),upperOpen:!0})}}):r}return e(e({},n),{schema:e(e({},i),{primaryKey:u,indexes:s,getIndexByKeyPath:function(e){var t=o[ar(e)];return t&&t[0]}}),count:function(e){return n.count(f(e))},query:function(e){return n.query(f(e))},openCursor:function(e){var r=e.query.index,i=r.keyTail,o=r.isVirtual,s=r.keyLength;if(!o)return n.openCursor(e);return n.openCursor(f(e)).then((function(r){return r&&function(r){return Object.create(r,{continue:{value:function(n){null!=n?r.continue(Sr(n,e.reverse?t.MAX_KEY:t.MIN_KEY,i)):e.unique?r.continue(Sr(r.key,e.reverse?t.MIN_KEY:t.MAX_KEY,i)):r.continue()}},continuePrimaryKey:{value:function(e,n){r.continuePrimaryKey(Sr(e,t.MAX_KEY,i),n)}},key:{get:function(){var e=r.key;return 1===s?e[0]:e.slice(0,s)}},value:{get:function(){return r.value}}})}(r)}))}})}})}},kr={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return e(e({},r),{table:function(n){var i=r.table(n),o=i.schema.primaryKey;return e(e({},i),{mutate:function(r){var s=Ce.trans,a=s.table(n).hook,u=a.deleting,c=a.creating,l=a.updating;switch(r.type){case"add":if(c.fire===re)break;return s._promise("readwrite",(function(){return h(r)}),!0);case"put":if(c.fire===re&&l.fire===re)break;return s._promise("readwrite",(function(){return h(r)}),!0);case"delete":if(u.fire===re)break;return s._promise("readwrite",(function(){return h(r)}),!0);case"deleteRange":if(u.fire===re)break;return s._promise("readwrite",(function(){return function t(r,n,s){return i.query({trans:r,values:!1,query:{index:o,range:n},limit:s}).then((function(i){var o=i.result;return h({type:"delete",keys:o,trans:r}).then((function(i){return 0<i.numFailures?Promise.reject(i.failures[0]):o.length<s?{failures:[],numFailures:0,lastResult:void 0}:t(r,e(e({},n),{lower:o[o.length-1],lowerOpen:!0}),s)}))}))}((t=r).trans,t.range,1e4);var t}),!0)}return i.mutate(r);function h(r){var n,s,a,h=Ce.trans,f=r.keys||ir(o,r);if(!f)throw new Error("Keys missing");return"delete"!==(r="add"===r.type||"put"===r.type?e(e({},r),{keys:f,wantResults:!0}):e({},r)).type&&(r.values=t(r.values)),r.keys&&(r.keys=t(r.keys)),n=i,a=f,("add"===(s=r).type?Promise.resolve(new Array(s.values.length)):n.getMany({trans:s.trans,keys:a})).then((function(e){var t=f.map((function(t,n){var i,s,a,f,p=e[n],d={onerror:null,onsuccess:null};return"delete"===r.type?u.fire.call(d,t,p,h):"add"===r.type||void 0===p?(i=c.fire.call(d,t,r.values[n],h),null==t&&null!=i&&(t=i,r.keys[n]=t,o.outbound||_(r.values[n],o.keyPath,t))):(s=O(p,r.values[n]),(a=l.fire.call(d,s,t,p,h))&&(f=r.values[n],Object.keys(a).forEach((function(e){_(f,e,a[e])})))),d}));return i.mutate(r).then((function(n){for(var i=n.failures,o=n.results,s=n.numFailures,a=n.lastResult,u=0;u<f.length;++u){var c=o?o[u]:f[u],l=t[u];null==c?l.onerror&&l.onerror(i[u]):l.onsuccess&&l.onsuccess("put"===r.type&&e[u]?r.values[u]:c)}return{failures:i,results:o,numFailures:s,lastResult:a}})).catch((function(e){return t.forEach((function(t){return t.onerror&&t.onerror(e)})),Promise.reject(e)}))}))}}})}})}},Ar=(Br.prototype.version=function(e){if(isNaN(e)||e<.1)throw new Z.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new Z.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,r=t.filter((function(t){return t._cfg.version===e}))[0];return r||(r=new this.Version(e),t.push(r),t.sort(fr),r.stores({}),this._state.autoSchema=!1,r)},Br.prototype._whenReady=function(e){var t=this;return this._state.openComplete||Ce.letThrough?e():new Fe((function(e,r){if(!t._state.isBeingOpened){if(!t._options.autoOpen)return void r(new Z.DatabaseClosed);t.open().catch(re)}t._state.dbReadyPromise.then(e,r)})).then(e)},Br.prototype.use=function(e){var t=e.stack,r=e.create,n=e.level,i=e.name;i&&this.unuse({stack:t,name:i});var o=this._middlewares[t]||(this._middlewares[t]=[]);return o.push({stack:t,create:r,level:null==n?10:n,name:i}),o.sort((function(e,t){return e.level-t.level})),this},Br.prototype.unuse=function(e){var t=e.stack,r=e.name,n=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter((function(e){return n?e.create!==n:!!r&&e.name!==r}))),this},Br.prototype.open=function(){return _r(this)},Br.prototype.close=function(){var e=mt.indexOf(this),t=this._state;if(0<=e&&mt.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(e){}this.idbdb=null}this._options.autoOpen=!1,t.dbOpenError=new Z.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError),t.dbReadyPromise=new Fe((function(e){t.dbReadyResolve=e})),t.openCanceller=new Fe((function(e,r){t.cancelOpen=r}))},Br.prototype.delete=function(){var e=this,t=0<arguments.length,r=this._state;return new Fe((function(n,i){function o(){e.close();var t=e._deps.indexedDB.deleteDatabase(e.name);t.onsuccess=We((function(){gr.remove(e.name),n()})),t.onerror=Xt(i),t.onblocked=e._fireOnBlocked}if(t)throw new Z.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()}))},Br.prototype.backendDB=function(){return this.idbdb},Br.prototype.isOpen=function(){return null!==this.idbdb},Br.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},Br.prototype.hasFailed=function(){return null!==this._state.dbOpenError},Br.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Br.prototype,"tables",{get:function(){var e=this;return r(this._allTables).map((function(t){return e._allTables[t]}))},enumerable:!0,configurable:!0}),Br.prototype.transaction=function(){var e=function(e,t,r){var n=arguments.length;if(n<2)throw new Z.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];return r=i.pop(),[e,x(i),r]}.apply(this,arguments);return this._transaction.apply(this,e)},Br.prototype._transaction=function(e,t,r){var n=this,i=Ce.trans;i&&i.db===this&&-1===e.indexOf("!")||(i=null);var o,s,a=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(s=t.map((function(e){var t=e instanceof n.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||e===_t)o=_t;else{if("rw"!=e&&e!=Et)throw new Z.InvalidArgument("Invalid transaction mode: "+e);o=Et}if(i){if(i.mode===_t&&o===Et){if(!a)throw new Z.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&s.forEach((function(e){if(i&&-1===i.storeNames.indexOf(e)){if(!a)throw new Z.SubTransaction("Table "+e+" not included in parent transaction.");i=null}})),a&&i&&!i.active&&(i=null)}}catch(r){return i?i._promise(null,(function(e,t){t(r)})):ht(r)}var u=function(e,t,r,n,i){return Fe.resolve().then((function(){var o=Ce.transless||Ce,s=e._createTransaction(t,r,e._dbSchema,n),a={trans:s,transless:o};n?s.idbtrans=n.idbtrans:s.create();var u,c=R(i);c&&et();var l=Fe.follow((function(){var e;(u=i.call(s,s))&&(c?(e=tt.bind(null,null),u.then(e,e)):"function"==typeof u.next&&"function"==typeof u.throw&&(u=Er(u)))}),a);return(u&&"function"==typeof u.then?Fe.resolve(u).then((function(e){return s.active?e:ht(new Z.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):l.then((function(){return u}))).then((function(e){return n&&s._resolve(),s._completion.then((function(){return e}))})).catch((function(e){return s._reject(e),ht(e)}))}))}.bind(null,this,o,s,i,r);return i?i._promise(o,u,"lock"):Ce.trans?st(Ce.transless,(function(){return n._whenReady(u)})):this._whenReady(u)},Br.prototype.table=function(e){if(!u(this._allTables,e))throw new Z.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},Br);function Br(t,r){var n=this;this._middlewares={},this.verno=0;var i=Br.dependencies;this._options=r=e({addons:Br.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};var o=r.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={};var s,a,u,c,l,h={dbOpenError:this.idbdb=null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:re,dbReadyPromise:null,cancelOpen:re,openCanceller:null,autoSchema:!0};h.dbReadyPromise=new Fe((function(e){h.dbReadyResolve=e})),h.openCanceller=new Fe((function(e,t){h.cancelOpen=t})),this._state=h,this.name=t,this.on=Bt(this,"populate","blocked","versionchange",{ready:[le,re]}),this.on.ready.subscribe=m(this.on.ready.subscribe,(function(e){return function(t,r){Br.vip((function(){var i,o=n._state;o.openComplete?(o.dbOpenError||Fe.resolve().then(t),r&&e(t)):o.onReadyBeingFired?(o.onReadyBeingFired.push(t),r&&e(t)):(e(t),i=n,r||e((function e(){i.on.ready.unsubscribe(t),i.on.ready.unsubscribe(e)})))}))}})),this.Collection=(s=this,It(jt.prototype,(function(e,t){this.db=s;var r=xt,n=null;if(t)try{r=t()}catch(e){n=e}var i=e._ctx,o=i.table,a=o.hook.reading.fire;this._ctx={table:o,index:i.index,isPrimKey:!i.index||o.schema.primKey.keyPath&&i.index===o.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:n,or:i.or,valueMapper:a!==ne?a:null}}))),this.Table=(a=this,It(kt.prototype,(function(e,t,r){this.db=a,this._tx=r,this.name=e,this.schema=t,this.hook=a._allTables[e]?a._allTables[e].hook:Bt(null,{creating:[se,re],reading:[ie,ne],updating:[ue,re],deleting:[ae,re]})}))),this.Transaction=(u=this,It(Qt.prototype,(function(e,t,r,n){var i=this;this.db=u,this.mode=e,this.storeNames=t,this.schema=r,this.idbtrans=null,this.on=Bt(this,"complete","error","abort"),this.parent=n||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Fe((function(e,t){i._resolve=e,i._reject=t})),this._completion.then((function(){i.active=!1,i.on.complete.fire()}),(function(e){var t=i.active;return i.active=!1,i.on.error.fire(e),i.parent?i.parent._reject(e):t&&i.idbtrans&&i.idbtrans.abort(),ht(e)}))}))),this.Version=(c=this,It(vr.prototype,(function(e){this.db=c,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))),this.WhereClause=(l=this,It(Wt.prototype,(function(e,t,r){this.db=l,this._ctx={table:e,index:":id"===t?null:t,or:r};var n=l._deps.indexedDB;if(!n)throw new Z.MissingAPI("indexedDB API missing");this._cmp=this._ascending=n.cmp.bind(n),this._descending=function(e,t){return n.cmp(t,e)},this._max=function(e,t){return 0<n.cmp(e,t)?e:t},this._min=function(e,t){return n.cmp(e,t)<0?e:t},this._IDBKeyRange=l._deps.IDBKeyRange}))),this.on("versionchange",(function(e){0<e.newVersion?console.warn("Another connection wants to upgrade database '"+n.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+n.name+"'. Closing db now to resume the delete request."),n.close()})),this.on("blocked",(function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+n.name+"') was blocked"):console.warn("Upgrade '"+n.name+"' blocked by other connection holding version "+e.oldVersion/10)})),this._maxKey=Ht(r.IDBKeyRange),this._createTransaction=function(e,t,r,i){return new n.Transaction(e,t,r,i)},this._fireOnBlocked=function(e){n.on("blocked").fire(e),mt.filter((function(e){return e.name===n.name&&e!==n&&!e._state.vcFired})).map((function(t){return t.on("versionchange").fire(e)}))},this.use(xr),this.use(kr),o.forEach((function(e){return e(n)}))}var Ir=Ar;return c(Ir,e(e({},te),{delete:function(e){return new Ir(e).delete()},exists:function(e){return new Ir(e,{addons:[]}).open().then((function(e){return e.close(),!0})).catch("NoSuchDatabaseError",(function(){return!1}))},getDatabaseNames:function(e){return gr?gr.getDatabaseNames().then(e):Fe.resolve([])},defineClass:function(){return function(e){o(this,e)}},ignoreTransaction:function(e){return Ce.trans?st(Ce.transless,e):e()},vip:br,async:function(e){return function(){try{var t=Er(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Fe.resolve(t)}catch(t){return ht(t)}}},spawn:function(e,t,r){try{var n=Er(e.apply(r,t||[]));return n&&"function"==typeof n.then?n:Fe.resolve(n)}catch(e){return ht(e)}},currentTransaction:{get:function(){return Ce.trans||null}},waitFor:function(e,t){var r=Fe.resolve("function"==typeof e?Ir.ignoreTransaction(e):e).timeout(t||6e4);return Ce.trans?Ce.trans.waitFor(r):r},Promise:Fe,debug:{get:function(){return U},set:function(e){N(e,"dexie"===e?function(){return!0}:ft)}},derive:f,extend:o,props:c,override:m,Events:Bt,getByKeyPath:b,setByKeyPath:_,delByKeyPath:function(e,t){"string"==typeof t?_(e,t,void 0):"length"in t&&[].map.call(t,(function(t){_(e,t,void 0)}))},shallowClone:E,deepClone:I,getObjectDiff:O,asap:v,minKey:-1/0,addons:[],connections:mt,errnames:J,dependencies:function(){try{return{indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch(e){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:"3.0.1",version:"3.0.1".split(".").map((function(e){return parseInt(e)})).reduce((function(e,t,r){return e+t/Math.pow(10,2*r)})),default:Ir,Dexie:Ir})),Ir.maxKey=Ht(Ir.dependencies.IDBKeyRange),function(e){try{(i=(t=e)&&"function"==typeof t.databases)||((n=new Ar(bt,{addons:[]})).version(1).stores({dbnames:"name"}),r=n.table("dbnames")),gr={getDatabaseNames:function(){return i?Fe.resolve(t.databases()).then((function(e){return e.map((function(e){return e.name})).filter((function(e){return e!==bt}))})):r.toCollection().primaryKeys()},add:function(e){return!i&&e!==bt&&r.put({name:e}).catch(re)},remove:function(e){return!i&&e!==bt&&r.delete(e).catch(re)}}}catch(e){}var t,r,n,i}(Ar.dependencies.indexedDB),Fe.rejectionMapper=function(e,t){if(!e||e instanceof G||e instanceof TypeError||e instanceof SyntaxError||!e.name||!ee[e.name])return e;var r=new ee[e.name](t||e.message,e);return"stack"in e&&h(r,"stack",{get:function(){return this.inner.stack}}),r},N(U,ft),Ar}));class LFUCache{constructor(e,t){this._keys=0,this._maxHits=1,this._cache={},this._hits={},this.maxSize=e,this.evictHitRatio=t}clear(){this._keys=0,this._maxHits=1,this._cache={},this._hits={}}find(e){const{_cache:t}=this;return Object.keys(t).find(r=>t[r]===e)}get keys(){return Object.keys(this._cache)}get(e){const{_hits:t,_maxHits:r,_cache:n}=this,i=++t[e]||void 0;return i&&(this._maxHits=i>r?i:r)&&n[e]}rename(e,t){const{_hits:r,_cache:n}=this;n[t]=n[e],r[t]=r[e],delete n[e],delete r[e]}del(e){const{_hits:t,_cache:r}=this;delete r[e],delete t[e],this._keys--}set(e,t){return this._keys++,this._keys>this.maxSize&&this._evict(),this._hits[e]=1,this._cache[e]=t}_evict(){const{_hits:e,_cache:t,_maxHits:r,evictHitRatio:n}=this,i={},o={};this._keys=0,Object.keys(e).forEach(s=>{const a=e[s];a&&a/r>n&&(this._keys++,i[s]=1,o[s]=t[s])}),this._cache=o,this._hits=i,this._maxHits=1}}function SingleThreadScheduler(e,t,r){const n=r||Object.create(null);return async function(){const r=Array.from(arguments),i=t.apply(this,r),o=n[i];let s;s=n[i]=o?o.then(()=>e.apply(this,r)):e.apply(this,r);try{const e=await s;return s===n[i]&&delete n[i],e}catch(e){throw s===n[i]&&delete n[i],e}}}var IDB=new Dexie("ProjectStore");IDB.version(1).stores({projects:"pid, name, hash, repo",files:"id, &path, &fid, type, hash",folders:"id, &path, hash",data:"fid",libraries:"url",sessions:"pid",meta:"key"}),IDB.version(2).stores({projects:"pid",files:"id, &path, &fid",folders:"id, &path",data:"fid",libraries:"url",meta:"key"}).upgrade(e=>Promise.all([e.projects.filter(e=>!e.dir).modify(e=>{const t=e.ref?`${e.pid}:${e.ref.split("/").pop()}`:e.pid;e.olddir=t,e.dir=`${t}/${e.name}`}),e.folders.filter(e=>e.deleted).delete(),e.files.filter(e=>e.deleted).delete(),e.data.filter(e=>"base64"===e.encoding).modify(e=>{e.text=castAsReadableArrayBuffer(Buffer.from(e.text,"base64")),e.encoding="binary"})])),IDB.version(3).stores({files:"id, &path, &fid",folders:"id, &path",data:"fid",meta:"key"});var GlobalErrorCodes={ProjectNotFound:"project:404",FileNotFound:"file:404",RemoveFailed:"rm:500",NotADirectory:"rmdir:405",DestinationExists:"mv:403",OperationNotSupported:"copy:501",SourceNotFound:"src:404",INodeNotFound:"inode:404",RemoteNotFound:"remote:404",CriticalDeletionError:"delete:500",InvalidArgument:"args:400",ServerFailError:"server:500"};class ExtError extends Error{constructor(e){super(e.message),Object.assign(this,e)}}const ERROR_SOURCE="filesystem",isIDB=e=>"idb"===e||e.startsWith("idb/"),ext=e=>{if(null===e)return null;const t=basename(e),r=t.lastIndexOf(".");return-1==r?"":t.substr(r).toLowerCase()},uuid4=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),normPathCache=new LFUCache(800,.8),normalizePath=e=>{const t=normPathCache.get(e);if(t)return t;if(e.indexOf("\0")>=0)throw new ExtError({name:"InvalidArgument",src:"filesystem:normalizePath",message:RES_I18N.ErrorMessages.InvalidFor(RES_I18N.Objects.Path),code:GlobalErrorCodes.InvalidArgument});if(!e)throw new ExtError({name:"InvalidArgument",src:"filesystem:normalizePath",message:RES_I18N.ErrorMessages.CannotBeEmptyFor(RES_I18N.Objects.Path),code:GlobalErrorCodes.InvalidArgument});return normPathCache.set(e,e.split("/").filter((e,t)=>(""!==e||0===t)&&"."!==e).join("/"))},dirname=e=>{const t=e.lastIndexOf("/");return-1===t?".":0===t?"/":e.slice(0,t)},relativeTo=(e,t)=>t?e.slice(t.length+(t.endsWith("/")?0:1)):e,childOf=(e,t)=>!!e&&(e=normalizePath(e),t=normalizePath(t),e.startsWith(t+"/")||e===t),basename=e=>{const t=e.lastIndexOf("/");return-1===t?e:e.slice(t+1)},hasExt=(e,t)=>e&&ext(e)===t,join=(e,t)=>t?null==e?null:e.replace(/\/$/,"")+"/"+t.replace(/^\//,""):e,$warn=console?console.warn:()=>{},FileType={FILE:32768,DIRECTORY:16384,SYMLINK:40960};class Stats{constructor({size:e,mode:t,atimeMs:r=null,mtimeMs:n,ctimeMs:i}){let o=Date.now();this.atimeMs="number"!=typeof r?o:r,this.mtimeMs="number"!=typeof n?o:n,this.ctimeMs="number"!=typeof i?o:i,this.size=e,this.mode=Stats.normalizeMode(t),this.uid=this.gid=this.ino=0}get atime(){return new Date(this.atimeMs)}get mtime(){return new Date(this.mtimeMs)}get ctime(){return new Date(this.ctimeMs)}toBuffer(){const e=Buffer.alloc(32);return e.writeUInt32LE(this.size,0),e.writeUInt32LE(this.mode,4),e.writeDoubleLE(this.atimeMs,8),e.writeDoubleLE(this.mtimeMs,16),e.writeDoubleLE(this.ctimeMs,24),e}isFile(){return(61440&this.mode)===FileType.FILE}isDirectory(){return(61440&this.mode)===FileType.DIRECTORY}isSymbolicLink(){return(61440&this.mode)===FileType.SYMLINK}chmod(e){return this.mode=61440&this.mode|e}static normalizeMode(e){let t=e>0?e>>12:0;4!==t&&8!==t&&10!==t&&14!==t&&(t=8);let r=511&e;return r=73&r?493:420,8!==t&&(r=0),(t<<12)+r}}const messageHandlers=window.webkit&&window.webkit.messageHandlers;if(messageHandlers&&messageHandlers.file&&messageHandlers.system){const e="/documents/";class t{constructor({file:e,system:t}){this._file=e,this._system=t,this._id=1,this._callbacks={},this._serverRoot=null,this.isIOS=!0}async initServer(){this.serverUrl=await this.call(this._system,"initServer")}launchWebView(e){this._system.postMessage({method:"launchWebView",url:e})}setConsole(e){this._system.postMessage({method:"setConsole",value:e})}getConsole(){return this.call(this._system,"getConsole")}copyText(e){this._system.postMessage({method:"copyText",value:e})}appVersion(){return this.call(this._system,"appVersion")}isTablet(){return this.call(this._system,"isTablet")}versionName(){return this.call(this._system,"versionName")}async clipboardText(){const{contents:e}=await this.call(this._system,"clipboardText");return e}getUrlFor(e){if(this.serverUrl)return join(this.serverUrl,e);throw new Error("IOS Server uninitialized: call initServer first")}async setServerDir(e){if(e=this._path(e),!await this.call(this._system,"setServerDir",{path:e}))throw new ExtError({code:GlobalErrorCodes.ServerFailError,message:"Fail to configure server."});this._serverRoot=e}async getFileContent(){const{contents:e}=await DeviceFileSystem.promisifyStatus(await this.call(this._file,"getFileContent"));return e}writeExternal(e,t,r){return this.call(this._file,"writeExternal",{path:e,contents:t,base64:r})}getStorageDir(){return e}_path(e){return e.slice(11)}mkdirp(e){return this.call(this._file,"mkdirp",{path:this._path(e)})}exists(e){return this.call(this._file,"exists",{path:this._path(e)})}readFile(e,t){return this.call(this._file,"readFile",{path:this._path(e),encoding:t})}remove(e){return this.call(this._file,"remove",{path:this._path(e)})}readlink(e){return this.call(this._file,"readlink",{path:this._path(e)})}writelink(e,t){return this.call(this._file,"writelink",{path:this._path(e),target:t})}write(e,t,r){return this.call(this._file,"write",{path:this._path(e),contents:t,base64:r})}readdir(e,t,r){return this.call(this._file,"readdir",{path:this._path(e),skipFiles:t,skipFolders:r})}gitHashObject(e,t){return this.call(this._file,"gitHashObject",{path:this._path(t),type:e})}readdirDeep(e,t,r,n=""){return this.call(this._file,"readdirDeep",{path:this._path(e),files:t,folders:r,ignoreName:n})}lstat(e){return this.call(this._file,"lstat",{path:this._path(e)})}mv(e,t){return this.call(this._file,"mv",{src:this._path(e),target:this._path(t)})}saveBase64(e,t){return this.call(this._file,"saveBase64",{contents:e,name:t})}call(e,t,r){r=r||{};const n=this._id++;return e.postMessage(Object.assign({method:t,id:n},r)),new Promise((e,t)=>{this._callbacks[n]={resolve:e,reject:t}})}send(e,t){const r=this._callbacks[e];r&&(delete this._callbacks[e],r.resolve(t))}sendError(e,t){const r=this._callbacks[e];r&&(r.reject(t),delete this._callbacks[e])}}window.Android=window.IOSBridge=new t(messageHandlers)}class Observable{constructor(){this._subscriptions=[]}run(e){return Promise.all(this._subscriptions.map(t=>t(e)))}subscribe(e){return this._subscriptions.push(e),{unsubscribe:()=>{const t=this._subscriptions;t.includes(e)&&t.splice(t.indexOf(e),1)}}}}var ObservableClass=Observable;class DeviceSystem{constructor(e){this._device=e,this._appVersion=null,this._chromeVersion=null,this._appCode=null,this._copiedText=null,this._isTablet=null,this._theme=null,this.observable=new Observable;const t=Object.create(null);this._scheduleCache=t,this.idToken=SingleThreadScheduler(this._idToken,()=>"idToken",t)}async _idToken(){if(ENV.isDebugging)return"test-id-token";const e=this._device,t=e&&e.idToken?await e.idToken():null;return new Promise((e,r)=>{t&&(ACI.callbacks[t]={resolve:e,reject:r})})}get chromeVersion(){if(null!==this._chromeVersion)return this._chromeVersion;{const e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return this._chromeVersion=e?parseInt(e[2],10):0}}get supported(){return this._device&&this._device.appVersion}get serverDirectorySupported(){return this._device&&this._device.setServerDir}get device(){return this._device}get isIOS(){return!(!this._device||!this._device.isIOS)}get theme(){return this._theme}getPackageName(e){switch(e){case"node":return"io.spck.editor.node"}}async getAppCode(){if(ENV.isDebugging){const e=ENV.queryVariable("appCode");if(e)return e}return null!==this._appCode?this._appCode:this._device?(this._device.getAppCode?this._appCode=await this._device.getAppCode():this._appCode="unsupported",this._appCode):this._appCode="browser"}async isTablet(){if(null!==this._isTablet)return this._isTablet;{const e=this._device;return e&&e.isTablet?this._isTablet=await e.isTablet():UIkit2.support.touch&&window.innerWidth>1023}}get showToastSupported(){const e=this._device;return e&&e.showToast}showToast(e,t){const r=this._device;r&&r.showToast?r.showToast(e,"long"):((t=t||{}).timeout=3500,UI.message(e,t))}setTheme(e){const t=this._device;this._theme=e,t&&t.setTheme&&t.setTheme(e)}async initServer(){const e=this._device;e&&e.initServer&&await e.initServer()}get importMultipleFilesSupported(){const e=this._device;return e&&e.importMultipleFiles}async importMultipleFiles(e){const t=this._device;t&&t.importMultipleFiles&&t.importMultipleFiles(e)}get launchWebViewSupported(){const e=this._device;return e&&e.launchWebView}async launchWebView(e){const t=this._device;t&&t.launchWebView&&t.launchWebView(e)}async refreshUserData(){const e=this._device;e&&e.refreshUserData&&await e.refreshUserData()}async openPlayStore(e){const t=this._device;t&&t.launchBillingFlow&&await t.openPlayStore(e||null)}async launchBillingFlow(e){const t=this._device;t&&t.launchBillingFlow&&await t.launchBillingFlow(e,null,null)}async launchAuthFlow(e){const t=this._device;t&&t.launchAuthFlow&&await t.launchAuthFlow(e)}async signOut(){const e=this._device;e&&e.signOut&&await e.signOut()}async launchTerminal(e,t){const r=this._device;r&&r.launchTerminal&&await r.launchTerminal(e,t||null)}async launchTerminalWithUrl(e,t,r){const n=this._device;n&&n.launchTerminalWithUrl&&await n.launchTerminalWithUrl(e,t,r)}async setServerDir(e){if(!this.serverDirectorySupported)throw new ExtError({code:501,message:"Not Supported"});this._device.setServerDir(e)}checkUrlExists(e){const t=this._device;return t&&t.checkUrlExists?t.checkUrlExists(e):null}resourceUrl(e){const t=this._device;return t&&t.getUrlFor?t.getUrlFor(e):null}retrieveSkuList(){const e=this._device;e&&e.retrieveSkuList&&e.retrieveSkuList()}async generateRequestToken(e,t){if(ENV.isDebugging)return e;const r=this._device;return r&&r.generateRequestToken?await r.generateRequestToken(e.slice(-200),t):null}async saveBase64(e,t,r){const n=this._device;return r&&n&&n.saveBase64AsDownload?n.saveBase64AsDownload(Buffer.from(t).toString("base64"),e):n&&n.saveBase64?n.saveBase64(Buffer.from(t).toString("base64"),e):saveAs(new Blob([t]),e)}async proxySupported(){if(null!=this._proxySupported)return this._proxySupported;{const e=this._device;return this._proxySupported=e&&e.proxySupported?await e.proxySupported():null}}async appVersion(){if(this._appVersion)return this._appVersion;{const e=this._device;return this._appVersion=e&&e.appVersion?await e.appVersion():null}}async versionName(){const e=this._device;return e&&e.versionName?e.versionName():null}get orientationSupported(){return!(!this._device||!this._device.setOrientation)}get consoleSupported(){return!(!this._device||!this._device.setConsole)}get userAccountSupported(){if(ENV.isDebugging)return!0;const e=this._device;return!!(e&&e.launchAuthFlow&&e.launchBillingFlow&&e.refreshUserData)}get IMESupported(){const e=this._device;return!!(e&&e.switchKeyboardIME&&e.setIMEMode&&e.getIMEMode)}get consoleModeSupported(){return!(!this._device||!this._device.setConsoleMode)}switchKeyboardIME(){const e=this._device;e&&e.switchKeyboardIME&&e.switchKeyboardIME()}setIMEMode(e){const t=this._device;t&&t.setIMEMode&&t.setIMEMode(e)}get fastFileSystemSupported(){return!(!this._device||!this._device.setUseFastRemove)}setUseFastRemove(e){const t=this._device;t&&t.setUseFastRemove&&t.setUseFastRemove(e)}async getIMEMode(){const e=this._device;return e&&e.getIMEMode?e.getIMEMode():null}setAppToken(e){const t=this._device;t&&t.setAppToken&&t.setAppToken(e)}setConsoleMode(e){const t=this._device;t&&t.setConsoleMode&&(t.setConsoleMode(e),this.observable.run({action:"setConsoleMode",value:e}))}setConsole(e){const t=this._device;t&&t.setConsole&&t.setConsole(e)}async getConsole(){const e=this._device;return e&&e.getConsole?e.getConsole():null}setOrientation(e){const t=this._device;t&&t.setOrientation&&t.setOrientation(e)}async getOrientation(){const e=this._device;return e&&e.getOrientation?e.getOrientation():null}async copyText(e){this._copiedText=e;const t=this._device;t&&t.copyText&&await t.copyText(e)}async clipboardText(){const e=this._device;return e&&e.clipboardText?e.clipboardText():this._copiedText}async getFileContent(){const e=this._device;return e&&e.getFileContent?e.getFileContent():null}async runCommand(e,t){const r=this._device;return r&&r.runCommand?r.runCommand(e,t):null}async writeToSession(e,t){const r=this._device;return r&&r.writeToSession?r.writeToSession(e,t):null}onMessage(e,t){this.observable.run({callbackId:e,data:t})}}var DS=new DeviceSystem(window.Android);class DeviceFileSystem{constructor(e){this.device=e,this._legacy=null,this._supported=!!e&&!!(e.mkdirp&&e.exists&&e.readFile&&e.remove&&e.readlink&&e.writelink&&e.write&&e.readdir&&e.readdirDeep&&e.lstat&&e.mv),this._supported||$warn("DeviceFileSystem is not operational: interface missing")}get supported(){return this._supported}get copySupported(){return this._supported&&!!this.device.copy}get gitHashSupported(){return this._supported&&!!this.device.gitHashObject}get externalFsSupported(){return this._supported&&!!this.device.getAvailableExternalFilesDirs}get storageDir(){if(this._directory)return this._directory;{const e=this.device;return this._directory=e.getStorageDir?e.getStorageDir():"~/",this._directory}}async getExternalFsDirsAsync(){return this.externalFsSupported?DeviceFileSystem.promisifyStatus(await this.device.getAvailableExternalFilesDirs()):null}async gitHashObject(e,t){const{contents:r}=await DeviceFileSystem.promisifyStatus(await this.device.gitHashObject(e,t));return r}async copy(e,t){const{contents:r}=await DeviceFileSystem.promisifyStatus(await this.device.copy(e,t));return r}async readFile(e,t){const{contents:r}=await DeviceFileSystem.promisifyStatus(await this.device.readFile(e,t));return"utf8"===t||"base64"===t?r:Buffer.from(r,"base64")}async remove(e){const t=DS.getPackageName(await DS.getAppCode());if(e===this._directory||e.endsWith(`${t}/files/`))throw new ExtError({name:"CriticalDeletionError",src:`${this.constructor.name}:remove`,message:"Critical deletion error.",code:GlobalErrorCodes.CriticalDeletionError});return DeviceFileSystem.promisifyStatus(await this.device.remove(e))}async readlink(e){const{contents:t}=await DeviceFileSystem.promisifyStatus(await this.device.readlink(e));return t}async writelink(e,t){try{return await DeviceFileSystem.promisifyStatus(await this.device.writelink(e,t))}catch(r){throw new ExtError({name:i18nTag({de:"Sicherheitsfehler",en:"Security Error",es:"Error de seguridad",fr:"Erreur de scurit",id:"Kesalahan keamanan",ja:"",ko:" ",pt:"Erro de segurana",ru:" ",zh:"",zhTW:""}),message:i18nTag({de:`[${e}] ist ein Symlink zu [${t}]. Symbolische Links sind aus Sicherheitsgrnden auf Ihrem System nicht zulssig!`,en:`[${e}] is a symlink to [${t}]. Symbolic links are not allowed on your system for security reasons!`,es:`[${e}] es un enlace simblico a [${t}]. No se permiten enlaces simblicos en su sistema por razones de seguridad!`,fr:`[${e}] est un lien symbolique vers [${t}]. Les liens symboliques ne sont pas autoriss sur votre systme pour des raisons de scurit!`,id:`[${e}] adalah symlink ke [${t}]. Tautan simbolis tidak diperbolehkan di sistem Anda untuk alasan keamanan!`,ja:`[${e}]  [${t}] `,ko:`[${e}] [${t}]   .       !`,pt:`[${e}]  um link simblico para [${t}]. Links simblicos no so permitidos no seu sistema por razes de segurana!`,ru:`[${e}]     [${t}].         !`,zh:`[${e}]  [${t}] `,zhTW:`[${e}]  [${t}] `})})}}async write(e,t,r){return DeviceFileSystem.promisifyStatus(await this.device.write(e,t,!!r))}async exists(e){return this.device.exists(e)}async mkdirp(e){const{contents:t}=await DeviceFileSystem.promisifyStatus(await this.device.mkdirp(e));return t}async readdir(e,t,r){try{return await DeviceFileSystem.promisifyStatus(await this.device.readdir(e,t,r))}catch(e){return null}}async readdirDeep(e,t,r,n){try{return DeviceFileSystem.promisifyStatus(await this.device.readdirDeep(e,t,r,n))}catch(e){return[]}}async lstat(e){try{return new Stats(DeviceFileSystem.normalizeStats(await DeviceFileSystem.promisifyStatus(await this.device.lstat(e))))}catch(e){return null}}async mv(e,t){const{contents:r}=await DeviceFileSystem.promisifyStatus(await this.device.mv(e,t));return r}async writeExternal(e,t,r){const n=this.device;if(n&&n.writeExternal)return DeviceFileSystem.promisifyStatus(await n.writeExternal(e,t,!!r))}static async promisifyStatus(e){switch(e){case"{}":return{};case"[]":return[];default:{const t=tryParseJSON(e);if(t&&t.status)throw new ExtError(t);return t}}}static normalizeStats(e){const t=e.st_mtime||e.mtimeMs,r=e.st_ctime||e.ctimeMs,n=e.st_atime||e.atimeMs;return Object.assign(e,{mtimeMs:1e3*t,ctimeMs:1e3*r,atimeMs:1e3*n}),e}}var DeviceFileSystemClass=DeviceFileSystem,DFS=new DeviceFileSystem(window.Android),PathUtils={uuid4:uuid4,isIDB:isIDB,ext:ext,hasExt:hasExt,dirname:dirname,basename:basename,join:join,relativeTo:relativeTo,childOf:childOf,normalizePath:normalizePath};const FileTypeModes={FILE:33188,DIRECTORY:16384,SYMLINK:40960};class GitFileSystem{constructor(e){this._store=IDB,this._inodes=new LFUCache(9e3,0),this._gitIgnoreCache=new Map,this._fs=e,this.observable=new Observable;const t=Object.create(null);this._scheduleCache=t;const r=e=>e;this.write=SingleThreadScheduler(this._write,r,t),this.writelink=SingleThreadScheduler(this._writelink,r,t),this.mv=SingleThreadScheduler(this._mv,r,t),this.rm=SingleThreadScheduler(this._rm,r,t),this.rmdir=SingleThreadScheduler(this._rmdir,r,t),this.copy=SingleThreadScheduler(this._copy,r,t),this.readdirDeep=SingleThreadScheduler(this._readdirDeep,r,t),this.gitHashObject=e.gitHashSupported?e.gitHashObject.bind(e):null,this._readdirDeepCache=new Map}clearCache(){this._gitIgnoreCache.clear(),this._readdirDeepCache.clear()}gitIgnoreCache(){return this._gitIgnoreCache}async safeWrite(e,t,r){const n=join(r,e);await this.write(n,t,{atomic:!0}),await this.rm(e,{atomic:!0}),await this.mv(n,e,{atomic:!0})}async recoverLostWrite(e,t,r={}){if(!await this.exists(e)){const n=PathUtils.join(t,e);await this.exists(n)&&await this.mv(n,e,r)}}async writeExternal(e,t,r){const n=this._fs;return n.supported&&await n.writeExternal(e,t,r)}isBinaryContent(e){return Buffer.from(e.slice(0,8e3)).some(e=>0===e)}async inode(e,t){const r=this._inodes;return!t&&r.get(e)||r.set(e,uuid4())}async inodePath(e){const t=this._inodes.find(e);if(t)return t;throw new ExtError({src:`${this.constructor.name}:inodePath`,message:"Could not find inode.",inode:e,code:GlobalErrorCodes.INodeNotFound})}inodePathSync(e){return this._inodes.find(e)}async exists(e){e=normalizePath(e);const{_store:t,_fs:r}=this;return r.supported&&!isIDB(e)?await r.exists(e):!!await t.files.get({path:e})||!!await t.folders.get({path:e})}async lookupFolder(e){const{_store:t}=this,r=await t.folders.get({path:e});if(r)return r;{const t=await this.readlink(e);return t&&t!==e?await this.lookupFolder(t):null}}async lookupFile(e){const t=await this._store.files.get({path:e});return t?t.target&&t.target!==e?await this.lookupFile(t.target):t:null}async _copy(e,t,r={updateStatus:!1,atomic:!1}){const{_fs:n}=this;let i;switch(this._readdirDeepCache.clear(),`${isIDB(e)?"I":"F"}${isIDB(t)?"I":"F"}`){case"IF":case"FI":throw new ExtError({name:"OperationNotSupported",src:`${this.constructor.name}:copy`,message:"Moving between IndexedDB and FileSystem is currently not supported!",path:t,code:GlobalErrorCodes.OperationNotSupported});case"II":{const r=await this.lookupFile(e);if(r){const n=r.path,o=await this.read(n);await this.write(n.replace(e,t),o),i="file";break}{const[r,n]=await Promise.all([this.readdirDeep(e,{files:!0,folders:!1}),this.readdirDeep(e,{files:!1,folders:!0})]);n.unshift(e);for(let r of n)await this.mkdir(r.replace(e,t));for(let n of r)await this.write(n.replace(e,t),await this.read(n));i="folder";break}}case"FF":if(n.copySupported){i=await n.copy(e,t);break}throw new ExtError({name:"OperationNotSupported",src:`${this.constructor.name}:copy`,message:"Copy operation not supported by your system.",path:t,code:GlobalErrorCodes.OperationNotSupported})}const{updateStatus:o,atomic:s}=r;return s||await this.observable.run({action:"copy",type:i,updateStatus:o,oldpath:e,path:t}),i}async _mv(e,t,r={updateStatus:!1,atomic:!1,copyDelete:!1,deleteTarget:!1}){if(e=normalizePath(e),t=normalizePath(t),this._readdirDeepCache.clear(),e===t)return;if(await this.exists(t)){if(!r.deleteTarget)throw new ExtError({name:"DestinationExists",src:`${this.constructor.name}:mv`,message:RES_I18N.ErrorMessages.ExistsFor(RES_I18N.Objects.TargetPath),path:t,code:GlobalErrorCodes.DestinationExists});await this._rm(t,{atomic:!0})}const{_store:n,_inodes:i,_fs:o,_gitIgnoreCache:s}=this;let a;if(s.clear(),r.copyDelete)a=await this._copy(e,t,{atomic:!0}),await this._rm(e,{atomic:!0});else if(o.supported&&!isIDB(e))a=await o.mv(e,t);else{const r=await this.lookupFile(e);if(r)await this.mkdir(dirname(t)),await n.files.update(r.id,{path:t,mtimeMs:Date.now()}),a="file";else{const r=await this.lookupFolder(e);if(!r)throw new ExtError({name:"SourceNotFound",src:`${this.constructor.name}:mv`,message:RES_I18N.ErrorMessages.NotExistsFor(RES_I18N.Objects.SourcePath),oldpath:e,code:GlobalErrorCodes.SourceNotFound});{await this.mkdir(dirname(t));const i=Date.now();await n.files.where("path").startsWith(e+"/").modify(r=>{r.path=t+r.path.slice(e.length),r.mtimeMs=i}),await n.folders.where("path").startsWith(e+"/").modify(r=>{r.path=t+r.path.slice(e.length),r.mtimeMs=i}),await n.folders.update(r.id,{path:t,mtimeMs:i}),a="folder"}}}const{updateStatus:u,atomic:c}=r;return c||("file"===a?i.rename(e,t):"folder"===a&&i.keys.filter(t=>t.startsWith(e+"/")).forEach(r=>i.rename(r,r.replace(e,t))),await this.observable.run({action:"mv",updateStatus:u,oldpath:e,path:t,type:a})),{oldpath:e,path:t,type:a}}async read(e,t={}){return this.readFile(e,t).catch(()=>null)}async readFile(e,t={}){e=normalizePath(e);const{_fs:r,_store:n}=this,i=t.encoding;if(r.supported&&!isIDB(e))return r.readFile(e,i);{const t=await this.lookupFile(e);if(t){const e=await n.data.get(t.fid),r=e&&e.text||"",o=e&&e.encoding||"";return o?"utf8"===i&&"utf8"===o?r:i?Buffer.from(r,o).toString(i):Buffer.from(r,o):"utf8"===i?r:i?Buffer.from(r).toString(i):Buffer.from(r)}throw new ExtError({name:"FileNotFound",src:`${this.constructor.name}:read`,message:RES_I18N.ErrorMessages.NotExistsFor(RES_I18N.Objects.File),path:e,code:GlobalErrorCodes.FileNotFound})}}async mkdir(e,t={atomic:!1}){e=normalizePath(e),this._readdirDeepCache.clear();const{_fs:r,_store:n}=this,i=e.split("/").map((e,t,r)=>r.slice(0,t+1).join("/"));let o;o=r.supported&&!isIDB(e)?await r.mkdirp(e):await n.folders.where("path").anyOf(i).keys(e=>{const t=i.filter(t=>!e.includes(t));return t.length>0&&this._mkdirs(t)}),o&&!t.atomic&&await this.observable.run({action:"mkdir",path:e,type:"folder"})}async _write(e,t,r){e=normalizePath(e),t=t||"",this._readdirDeepCache.clear();let{mode:n,target:i,updateStatus:o,atomic:s}=r||{};const{_fs:a,_store:u,_gitIgnoreCache:c}=this;c.has(e)&&c.delete(e),await this.mkdir(dirname(e),{atomic:s});const l=GitFileSystem.isArrayBuffer(t);let h,f;if(a.supported&&!isIDB(e))({mtimeMs:h,size:f,mode:n}=await a.write(e,l?Buffer.from(t).toString("base64"):t,l));else{const r=await this.lookupFile(e),o=l?castAsReadableArrayBuffer(t):t;f=o.byteLength||o.length,h=Date.now();const s=r?r.ctimeMs:h,a=r?r.id:uuid4();await u.files.put({id:a,fid:a,path:e,target:i,mode:n,size:f,ctimeMs:s,mtimeMs:h}),await u.data.put({fid:a,text:o,encoding:l?"binary":"utf8"})}return s||await this.observable.run({action:"write",path:e,type:"file",updateStatus:o}),{mode:n,mtimeMs:h,type:"file",ino:0,size:f}}async _rm(e,t={}){const{tmpDir:r,updateStatus:n,atomic:i}=t;e=normalizePath(e),this._readdirDeepCache.clear();const{_fs:o,_store:s,_inodes:a,_gitIgnoreCache:u}=this;u.has(e)&&u.delete(e);let c=!1;if(r)return this._mv(e,`${r}${e}~${uuid4()}`,{updateStatus:n});{const t=await this.lstat(e);if(t){if(t.isDirectory())return this._rmdir(e,{updateStatus:n});if(o.supported&&!isIDB(e))c=await o.remove(e);else{const t=await s.files.get({path:e});t&&(await Promise.all([s.files.delete(t.id),s.data.delete(t.fid)]),c=!0)}}else c=!0}if(c){const t="file";if(i)return{oldpath:e,path:null,type:t};a.del(e);const r=dirname(e);return"."===r||"/"===r||await this.fileCount(r)>0?(await this.observable.run({action:"rm",updateStatus:n,oldpath:e,path:null,type:t}),{oldpath:e,path:null,type:t}):this._rmdir(r)}throw new ExtError({name:"RemoveFailed",src:`${this.constructor.name}:rm`,message:`Could not remove ${e}.`,path:e,code:GlobalErrorCodes.RemoveFailed})}async _rmdir(e,t={}){const{tmpDir:r,updateStatus:n,atomic:i,skipRemoveEmpty:o}=t;e=normalizePath(e),this._readdirDeepCache.clear();const{_inodes:s,_fs:a,_store:u,_gitIgnoreCache:c}=this;c.clear();const l=e+"/";if(s.keys.filter(e=>e.startsWith(l)).forEach(e=>s.del(e)),r)return this._mv(e,r+e,{updateStatus:n});{const t=await this.lstat(e);let r=!1;if(t){if(!t.isDirectory())throw new ExtError({name:"NotADirectory",src:`${this.constructor.name}:rmdir`,message:`${e} is not a directory.`,path:e,stats:t,code:GlobalErrorCodes.NotADirectory});a.supported&&!isIDB(e)?r=await a.remove(e):(await Promise.all([u.folders.where("path").equals(e).delete(),u.files.where("path").startsWith(l).delete(),u.folders.where("path").startsWith(l).delete()]),r=!0)}else r=!0;if(r){const t="folder",r=dirname(e);return o||"."===r||"/"===r||await this.fileCount(r)>0?(i||await this.observable.run({action:"rmdir",updateStatus:n,oldpath:e,path:null,type:t}),{oldpath:e,path:null,type:t}):this._rmdir(r)}throw new ExtError({name:"RemoveFailed",src:`${this.constructor.name}:rmdir`,message:`Could not remove ${e}.`,path:e,code:GlobalErrorCodes.RemoveFailed})}}async fileCount(e){const t=await this.readdirDeep(e,{files:!0});return t?t.length:null}async readdir(e,t){const{skipFiles:r=!1,skipFolders:n=!1}=t||{};e=normalizePath(e);const{_fs:i,_store:o}=this;let s;if(i.supported&&!isIDB(e))return s=await i.readdir(e,r,n),s&&s.sort(GitFileSystemClass.compareStrings),s;const a=await this.lookupFolder(e);if(a){const e=a.path+"/",t=e.length;let i=n?[]:o.folders.where("path").startsWith(e).filter(e=>!e.path.slice(t).includes("/")).keys(),u=r?[]:o.files.where("path").startsWith(e).filter(e=>!e.path.slice(t).includes("/")).keys();return s=(await i).concat(await u).map(e=>e.slice(t)),s.sort(GitFileSystemClass.compareStrings),s}return null}async _readdirDeep(e,t){const{files:r=!0,folders:n=!1,relative:i=!1,ignoreName:o="",useCache:s}=t||{},{_store:a,_fs:u,_readdirDeepCache:c}=this,l=(e=normalizePath(e))+"/",h=l.length,f=s?`${r<<1|n}|${o}|${e}`:null;let p;if(s&&c.has(f))p=c.get(f);else{if(u.supported&&!isIDB(e))p=await u.readdirDeep(e,r,n,o);else{const[e,t]=await Promise.all([r?a.files.where("path").startsWith(l).keys():[],n?a.folders.where("path").startsWith(l).keys():[]]);p=t.concat(e)}s&&c.set(f,p)}if(p){if(o){const e=new Set(o.split(":")),t=new RegExp(`/(${o.replace(/:/g,"|").replace(/\./g,"\\.")})/`);p=p.filter(r=>!t.test(r)&&!e.has(basename(r)))}p.sort(GitFileSystemClass.compareStrings),i&&(p=p.map(e=>e.slice(h)))}return p}async lstat(e){e=normalizePath(e);const{_store:t,_fs:r}=this;if(r.supported&&!isIDB(e))return await r.lstat(e);{const r=await t.files.get({path:e});if(r)return r.target?new Stats({size:r.size||0,mode:FileTypeModes.SYMLINK,mtimeMs:r.mtimeMs,ctimeMs:r.ctimeMs}):new Stats({size:r.size||0,mode:FileTypeModes.FILE,mtimeMs:r.mtimeMs,ctimeMs:r.ctimeMs});{const r=await t.folders.get({path:e});return r?new Stats({size:0,mode:FileTypeModes.DIRECTORY,mtimeMs:r.mtimeMs,ctimeMs:r.ctimeMs}):null}}}async size(e){return(await this.lstat(e)||{size:0}).size}async readlink(e){e=normalizePath(e);const{_fs:t,_store:r}=this;if(t.supported&&!isIDB(e))return t.readlink(e);const n=await r.files.get({path:e});return n&&n.target||null}async _writelink(e,t){e=normalizePath(e),this._readdirDeepCache.clear();const{_fs:r}=this,n=t.toString("utf8");return r.supported&&!isIDB(e)?(await this.mkdir(dirname(e)),r.writelink(e,n)):this._write(e,"",{target:n,mode:FileTypeModes.SYMLINK})}_mkdirs(e){const t=Date.now();return this._store.folders.bulkAdd(e.map(e=>({id:uuid4(),path:e,mtimeMs:t,ctimeMs:t})))}static compareStrings(e,t){return-(e<t)||+(e>t)}static isArrayBuffer(e){return e instanceof ArrayBuffer||e&&e.buffer instanceof ArrayBuffer&&void 0!==e.byteLength}}var GitFileSystemClass=GitFileSystem,GFS=new GitFileSystem(DFS);class Environ{constructor(e,t){this._fs=e,this._ds=t,this.locale="en",this._serverDirectory=null,this._nodeStoragePath=null}async setServerDir(e){this._ds.serverDirectorySupported?(await this._ds.setServerDir(e),this._serverDirectory=e):this._serverDirectory=null}locationSearchString(){try{return window.location.search}catch(e){return null}}queryVariable(e){const t=this.locationSearchString().substring(1).split("&");for(let r=0;r<t.length;r++){let n=t[r].split("=");if(decodeURIComponent(n[0])==e)return decodeURIComponent(n[1])}}get isDebugging(){return this.queryVariable("debug")}get apiUrl(){return this.isDebugging?"http://localhost:8321":"https://api.spck.io/v2"}setNodeJsModuleStoragePath(e){this._nodeStoragePath=e}getNodeJsModuleStoragePath(){return this._nodeStoragePath}resource(e){if(e){if(isIDB(e))return join("/run",e);if(this._ds.serverDirectorySupported){const t=this._serverDirectory;return t&&e.startsWith(t)?this._ds.resourceUrl(relativeTo(e,t)):null}return this._ds.resourceUrl(e)}return e}async getExternalFsDirsAsync(){const e=await this._fs.getExternalFsDirsAsync();return e&&e.length?(e[0].name="External",e[0].id="external",e.slice(1,3).forEach((e,t)=>{e.name=`SD${t+1}`,e.id=`SD${t+1}`}),e):[]}getInternalDir(e){return this._internalDir||(this._internalDir=this._fs.supported?this._fs.storageDir:"idb"),join(this._internalDir,e)}projectConfigPath(e){return join(e,".projects")}gitConfigPath(){return this.getInternalDir(".gitconfig")}settingsConfigPath(){return this.getInternalDir(".settings")}globalTasksConfigPath(){return this.getInternalDir(".metadata/.tasks/.global")}cachedUserDataPath(){return this.getInternalDir(".metadata/.user")}fontsDir(){return this.getInternalDir(".metadata/.fonts")}signatureDir(){return this.getInternalDir(".metadata/.sig")}projectTasksConfigPath(e){return join(`${dirname(e)}/.metadata/.tasks`,basename(e))}tmpDir(e){return join(`${dirname(e)}/.tmp`,basename(e))}metadataPath(e){return join(`${dirname(e)}/.metadata`,basename(e))}trashDir(e){return join(`${dirname(e)}/.trash`,basename(e))}}var ENV=new Environ(DFS,DS);function tryParseJSON(e){try{return JSON.parse(e)||null}catch(e){return null}}function castAsReadableArrayBuffer(e){if(e instanceof ArrayBuffer)return e;if(e instanceof Uint8Array)return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(Buffer.isBuffer(e))return e.buffer;throw new Error("Argument type not recognized: "+typeof e)}