!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).buffer=t()}((function(){return function t(e,r,n){function i(s,a){if(!r[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};e[s][0].call(l.exports,(function(t){return i(e[s][1][t]||t)}),l,l.exports,t,e,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,e,r){(function(e){"use strict";var n=t("base64-js"),i=t("ieee754"),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=e,r.SlowBuffer=function(t){return+t!=t&&(t=0),e.alloc(+t)},r.INSPECT_MAX_BYTES=50;var s=2147483647;function a(t){if(t>s)throw new RangeError('The value "'+t+'" is invalid for option "size"');var r=new Uint8Array(t);return Object.setPrototypeOf(r,e.prototype),r}function e(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}return u(t,e,r)}function u(t,r,n){if("string"==typeof t)return function(t,r){if("string"==typeof r&&""!==r||(r="utf8"),!e.isEncoding(r))throw new TypeError("Unknown encoding: "+r);var n=0|p(t,r),i=a(n),o=i.write(t,r);return o!==n&&(i=i.slice(0,o)),i}(t,r);if(ArrayBuffer.isView(t))return f(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(N(t,ArrayBuffer)||t&&N(t.buffer,ArrayBuffer))return function(t,r,n){if(r<0||t.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<r+(n||0))throw new RangeError('"length" is outside of buffer bounds');var i;return i=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),Object.setPrototypeOf(i,e.prototype),i}(t,r,n);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return e.from(i,r,n);var o=function(t){if(e.isBuffer(t)){var r=0|h(t.length),n=a(r);return 0===n.length?n:(t.copy(n,0,0,r),n)}return void 0!==t.length?"number"!=typeof t.length||K(t.length)?a(0):f(t):"Buffer"===t.type&&Array.isArray(t.data)?f(t.data):void 0}(t);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return e.from(t[Symbol.toPrimitive]("string"),r,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function l(t){return c(t),a(t<0?0:0|h(t))}function f(t){for(var e=t.length<0?0:0|h(t.length),r=a(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function h(t){if(t>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|t}function p(t,r){if(e.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||N(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var n=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var o=!1;;)switch(r){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return j(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return R(t).length;default:if(o)return i?-1:j(t).length;r=(""+r).toLowerCase(),o=!0}}function d(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function y(t,r,n,i,o){if(0===t.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),K(n=+n)&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof r&&(r=e.from(r,i)),e.isBuffer(r))return 0===r.length?-1:m(t,r,n,i,o);if("number"==typeof r)return r&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,r,n):Uint8Array.prototype.lastIndexOf.call(t,r,n):m(t,[r],n,i,o);throw new TypeError("val must be string, number or Buffer")}function m(t,e,r,n,i){var o,s=1,a=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,a/=2,u/=2,r/=2}function c(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var l=-1;for(o=r;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(r+u>a&&(r=a-u),o=r;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function g(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(e.substr(2*s,2),16);if(K(a))return s;t[r+s]=a}return s}function v(t,e,r,n){return U(j(e,t.length-r),t,r,n)}function w(t,e,r,n){return U(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function b(t,e,r,n){return w(t,e,r,n)}function _(t,e,r,n){return U(R(e),t,r,n)}function E(t,e,r,n){return U(function(t,e){for(var r,n,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=(r=t.charCodeAt(s))>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function S(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function x(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,s,a,u,c=t[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=r)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=f}return function(t){var e=t.length;if(e<=k)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=k));return r}(n)}r.kMaxLength=s,e.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),e.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(e.prototype,"parent",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.buffer}}),Object.defineProperty(e.prototype,"offset",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&e[Symbol.species]===e&&Object.defineProperty(e,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),e.poolSize=8192,e.from=function(t,e,r){return u(t,e,r)},Object.setPrototypeOf(e.prototype,Uint8Array.prototype),Object.setPrototypeOf(e,Uint8Array),e.alloc=function(t,e,r){return function(t,e,r){return c(t),t<=0?a(t):void 0!==e?"string"==typeof r?a(t).fill(e,r):a(t).fill(e):a(t)}(t,e,r)},e.allocUnsafe=function(t){return l(t)},e.allocUnsafeSlow=function(t){return l(t)},e.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==e.prototype},e.compare=function(t,r){if(N(t,Uint8Array)&&(t=e.from(t,t.offset,t.byteLength)),N(r,Uint8Array)&&(r=e.from(r,r.offset,r.byteLength)),!e.isBuffer(t)||!e.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===r)return 0;for(var n=t.length,i=r.length,o=0,s=Math.min(n,i);o<s;++o)if(t[o]!==r[o]){n=t[o],i=r[o];break}return n<i?-1:i<n?1:0},e.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},e.concat=function(t,r){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return e.alloc(0);var n;if(void 0===r)for(r=0,n=0;n<t.length;++n)r+=t[n].length;var i=e.allocUnsafe(r),o=0;for(n=0;n<t.length;++n){var s=t[n];if(N(s,Uint8Array)&&(s=e.from(s)),!e.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,o),o+=s.length}return i},e.byteLength=p,e.prototype._isBuffer=!0,e.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)d(this,e,e+1);return this},e.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)d(this,e,e+3),d(this,e+1,e+2);return this},e.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)d(this,e,e+7),d(this,e+1,e+6),d(this,e+2,e+5),d(this,e+3,e+4);return this},e.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?x(this,0,t):function(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return I(this,e,r);case"utf8":case"utf-8":return x(this,e,r);case"ascii":return A(this,e,r);case"latin1":case"binary":return B(this,e,r);case"base64":return S(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},e.prototype.toLocaleString=e.prototype.toString,e.prototype.equals=function(t){if(!e.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===e.compare(this,t)},e.prototype.inspect=function(){var t="",e=r.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},o&&(e.prototype[o]=e.prototype.inspect),e.prototype.compare=function(t,r,n,i,o){if(N(t,Uint8Array)&&(t=e.from(t,t.offset,t.byteLength)),!e.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===r&&(r=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===o&&(o=this.length),r<0||n>t.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&r>=n)return 0;if(i>=o)return-1;if(r>=n)return 1;if(this===t)return 0;for(var s=(o>>>=0)-(i>>>=0),a=(n>>>=0)-(r>>>=0),u=Math.min(s,a),c=this.slice(i,o),l=t.slice(r,n),f=0;f<u;++f)if(c[f]!==l[f]){s=c[f],a=l[f];break}return s<a?-1:a<s?1:0},e.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},e.prototype.indexOf=function(t,e,r){return y(this,t,e,r,!0)},e.prototype.lastIndexOf=function(t,e,r){return y(this,t,e,r,!1)},e.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return g(this,t,e,r);case"utf8":case"utf-8":return v(this,t,e,r);case"ascii":return w(this,t,e,r);case"latin1":case"binary":return b(this,t,e,r);case"base64":return _(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},e.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function A(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function B(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function I(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=L[t[o]];return i}function C(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function T(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function O(t,r,n,i,o,s){if(!e.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>o||r<s)throw new RangeError('"value" argument is out of bounds');if(n+i>t.length)throw new RangeError("Index out of range")}function D(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function F(t,e,r,n,o){return e=+e,r>>>=0,o||D(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function P(t,e,r,n,o){return e=+e,r>>>=0,o||D(t,0,r,8),i.write(t,e,r,n,52,8),r+8}e.prototype.slice=function(t,r){var n=this.length;(t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<t&&(r=t);var i=this.subarray(t,r);return Object.setPrototypeOf(i,e.prototype),i},e.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||T(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},e.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||T(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},e.prototype.readUInt8=function(t,e){return t>>>=0,e||T(t,1,this.length),this[t]},e.prototype.readUInt16LE=function(t,e){return t>>>=0,e||T(t,2,this.length),this[t]|this[t+1]<<8},e.prototype.readUInt16BE=function(t,e){return t>>>=0,e||T(t,2,this.length),this[t]<<8|this[t+1]},e.prototype.readUInt32LE=function(t,e){return t>>>=0,e||T(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},e.prototype.readUInt32BE=function(t,e){return t>>>=0,e||T(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},e.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||T(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},e.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||T(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},e.prototype.readInt8=function(t,e){return t>>>=0,e||T(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},e.prototype.readInt16LE=function(t,e){t>>>=0,e||T(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt16BE=function(t,e){t>>>=0,e||T(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt32LE=function(t,e){return t>>>=0,e||T(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},e.prototype.readInt32BE=function(t,e){return t>>>=0,e||T(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},e.prototype.readFloatLE=function(t,e){return t>>>=0,e||T(t,4,this.length),i.read(this,t,!0,23,4)},e.prototype.readFloatBE=function(t,e){return t>>>=0,e||T(t,4,this.length),i.read(this,t,!1,23,4)},e.prototype.readDoubleLE=function(t,e){return t>>>=0,e||T(t,8,this.length),i.read(this,t,!0,52,8)},e.prototype.readDoubleBE=function(t,e){return t>>>=0,e||T(t,8,this.length),i.read(this,t,!1,52,8)},e.prototype.writeUIntLE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||O(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},e.prototype.writeUIntBE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||O(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},e.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,1,255,0),this[e]=255&t,e+1},e.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},e.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},e.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},e.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},e.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);O(this,t,e,r,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<r&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},e.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);O(this,t,e,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},e.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},e.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},e.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},e.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},e.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||O(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},e.prototype.writeFloatLE=function(t,e,r){return F(this,t,e,!0,r)},e.prototype.writeFloatBE=function(t,e,r){return F(this,t,e,!1,r)},e.prototype.writeDoubleLE=function(t,e,r){return P(this,t,e,!0,r)},e.prototype.writeDoubleBE=function(t,e,r){return P(this,t,e,!1,r)},e.prototype.copy=function(t,r,n,i){if(!e.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),r>=t.length&&(r=t.length),r||(r=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===t.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-r<i-n&&(i=t.length-r+n);var o=i-n;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,n,i);else if(this===t&&n<r&&r<i)for(var s=o-1;s>=0;--s)t[s+r]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,i),r);return o},e.prototype.fill=function(t,r,n,i){if("string"==typeof t){if("string"==typeof r?(i=r,r=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!e.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===t.length){var o=t.charCodeAt(0);("utf8"===i&&o<128||"latin1"===i)&&(t=o)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;var s;if(r>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(s=r;s<n;++s)this[s]=t;else{var a=e.isBuffer(t)?t:e.from(t,i),u=a.length;if(0===u)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(s=0;s<n-r;++s)this[s+r]=a[s%u]}return this};var M=/[^+\/0-9A-Za-z-_]/g;function j(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],s=0;s<n;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function R(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function U(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function N(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function K(t){return t!=t}var L=function(){for(var t=new Array(256),e=0;e<16;++e)for(var r=16*e,n=0;n<16;++n)t[r+n]="0123456789abcdef"[e]+"0123456789abcdef"[n];return t}()}).call(this,t("buffer").Buffer)},{"base64-js":2,buffer:5,ieee754:3}],2:[function(t,e,r){"use strict";r.byteLength=function(t){var e=c(t),r=e[0],n=e[1];return 3*(r+n)/4-n},r.toByteArray=function(t){var e,r,n=c(t),s=n[0],a=n[1],u=new o(function(t,e,r){return 3*(e+r)/4-r}(0,s,a)),l=0,f=a>0?s-4:s;for(r=0;r<f;r+=4)e=i[t.charCodeAt(r)]<<18|i[t.charCodeAt(r+1)]<<12|i[t.charCodeAt(r+2)]<<6|i[t.charCodeAt(r+3)],u[l++]=e>>16&255,u[l++]=e>>8&255,u[l++]=255&e;return 2===a&&(e=i[t.charCodeAt(r)]<<2|i[t.charCodeAt(r+1)]>>4,u[l++]=255&e),1===a&&(e=i[t.charCodeAt(r)]<<10|i[t.charCodeAt(r+1)]<<4|i[t.charCodeAt(r+2)]>>2,u[l++]=e>>8&255,u[l++]=255&e),u},r.fromByteArray=function(t){for(var e,r=t.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(l(t,s,s+16383>a?a:s+16383));return 1===i?(e=t[r-1],o.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],o.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"=")),o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=s.length;a<u;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function l(t,e,r){for(var i,o,s=[],a=e;a<r;a+=3)i=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],3:[function(t,e,r){r.read=function(t,e,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,f=r?i-1:0,h=r?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)},r.write=function(t,e,r,n,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),(e+=s+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(s++,u/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(e*u-1)*Math.pow(2,i),s+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;t[r+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;t[r+p]=255&s,p+=d,s/=256,c-=8);t[r+p-d]|=128*y}},{}],4:[function(t,e,r){arguments[4][2][0].apply(r,arguments)},{dup:2}],5:[function(t,e,r){(function(e){"use strict";var n=t("base64-js"),i=t("ieee754");r.Buffer=e,r.SlowBuffer=function(t){return+t!=t&&(t=0),e.alloc(+t)},r.INSPECT_MAX_BYTES=50;var o=2147483647;function s(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');var r=new Uint8Array(t);return r.__proto__=e.prototype,r}function e(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return c(t)}return a(t,e,r)}function a(t,r,n){if("string"==typeof t)return function(t,r){if("string"==typeof r&&""!==r||(r="utf8"),!e.isEncoding(r))throw new TypeError("Unknown encoding: "+r);var n=0|h(t,r),i=s(n),o=i.write(t,r);return o!==n&&(i=i.slice(0,o)),i}(t,r);if(ArrayBuffer.isView(t))return l(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(N(t,ArrayBuffer)||t&&N(t.buffer,ArrayBuffer))return function(t,r,n){if(r<0||t.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<r+(n||0))throw new RangeError('"length" is outside of buffer bounds');var i;return(i=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n)).__proto__=e.prototype,i}(t,r,n);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return e.from(i,r,n);var o=function(t){if(e.isBuffer(t)){var r=0|f(t.length),n=s(r);return 0===n.length?n:(t.copy(n,0,0,r),n)}return void 0!==t.length?"number"!=typeof t.length||K(t.length)?s(0):l(t):"Buffer"===t.type&&Array.isArray(t.data)?l(t.data):void 0}(t);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return e.from(t[Symbol.toPrimitive]("string"),r,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function c(t){return u(t),s(t<0?0:0|f(t))}function l(t){for(var e=t.length<0?0:0|f(t.length),r=s(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function f(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function h(t,r){if(e.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||N(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var n=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var o=!1;;)switch(r){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return j(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return R(t).length;default:if(o)return i?-1:j(t).length;r=(""+r).toLowerCase(),o=!0}}function p(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function d(t,r,n,i,o){if(0===t.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),K(n=+n)&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof r&&(r=e.from(r,i)),e.isBuffer(r))return 0===r.length?-1:y(t,r,n,i,o);if("number"==typeof r)return r&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,r,n):Uint8Array.prototype.lastIndexOf.call(t,r,n):y(t,[r],n,i,o);throw new TypeError("val must be string, number or Buffer")}function y(t,e,r,n,i){var o,s=1,a=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,a/=2,u/=2,r/=2}function c(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var l=-1;for(o=r;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(r+u>a&&(r=a-u),o=r;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function m(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(e.substr(2*s,2),16);if(K(a))return s;t[r+s]=a}return s}function g(t,e,r,n){return U(j(e,t.length-r),t,r,n)}function v(t,e,r,n){return U(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function w(t,e,r,n){return v(t,e,r,n)}function b(t,e,r,n){return U(R(e),t,r,n)}function _(t,e,r,n){return U(function(t,e){for(var r,n,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=(r=t.charCodeAt(s))>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function E(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function S(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,s,a,u,c=t[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=r)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=f}return function(t){var e=t.length;if(e<=x)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=x));return r}(n)}r.kMaxLength=o,e.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}(),e.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(e.prototype,"parent",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.buffer}}),Object.defineProperty(e.prototype,"offset",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&e[Symbol.species]===e&&Object.defineProperty(e,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),e.poolSize=8192,e.from=function(t,e,r){return a(t,e,r)},e.prototype.__proto__=Uint8Array.prototype,e.__proto__=Uint8Array,e.alloc=function(t,e,r){return function(t,e,r){return u(t),t<=0?s(t):void 0!==e?"string"==typeof r?s(t).fill(e,r):s(t).fill(e):s(t)}(t,e,r)},e.allocUnsafe=function(t){return c(t)},e.allocUnsafeSlow=function(t){return c(t)},e.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==e.prototype},e.compare=function(t,r){if(N(t,Uint8Array)&&(t=e.from(t,t.offset,t.byteLength)),N(r,Uint8Array)&&(r=e.from(r,r.offset,r.byteLength)),!e.isBuffer(t)||!e.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===r)return 0;for(var n=t.length,i=r.length,o=0,s=Math.min(n,i);o<s;++o)if(t[o]!==r[o]){n=t[o],i=r[o];break}return n<i?-1:i<n?1:0},e.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},e.concat=function(t,r){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return e.alloc(0);var n;if(void 0===r)for(r=0,n=0;n<t.length;++n)r+=t[n].length;var i=e.allocUnsafe(r),o=0;for(n=0;n<t.length;++n){var s=t[n];if(N(s,Uint8Array)&&(s=e.from(s)),!e.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,o),o+=s.length}return i},e.byteLength=h,e.prototype._isBuffer=!0,e.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)p(this,e,e+1);return this},e.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)p(this,e,e+3),p(this,e+1,e+2);return this},e.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)p(this,e,e+7),p(this,e+1,e+6),p(this,e+2,e+5),p(this,e+3,e+4);return this},e.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?S(this,0,t):function(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return B(this,e,r);case"utf8":case"utf-8":return S(this,e,r);case"ascii":return k(this,e,r);case"latin1":case"binary":return A(this,e,r);case"base64":return E(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},e.prototype.toLocaleString=e.prototype.toString,e.prototype.equals=function(t){if(!e.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===e.compare(this,t)},e.prototype.inspect=function(){var t="",e=r.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},e.prototype.compare=function(t,r,n,i,o){if(N(t,Uint8Array)&&(t=e.from(t,t.offset,t.byteLength)),!e.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===r&&(r=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===o&&(o=this.length),r<0||n>t.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&r>=n)return 0;if(i>=o)return-1;if(r>=n)return 1;if(this===t)return 0;for(var s=(o>>>=0)-(i>>>=0),a=(n>>>=0)-(r>>>=0),u=Math.min(s,a),c=this.slice(i,o),l=t.slice(r,n),f=0;f<u;++f)if(c[f]!==l[f]){s=c[f],a=l[f];break}return s<a?-1:a<s?1:0},e.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},e.prototype.indexOf=function(t,e,r){return d(this,t,e,r,!0)},e.prototype.lastIndexOf=function(t,e,r){return d(this,t,e,r,!1)},e.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return m(this,t,e,r);case"utf8":case"utf-8":return g(this,t,e,r);case"ascii":return v(this,t,e,r);case"latin1":case"binary":return w(this,t,e,r);case"base64":return b(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},e.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var x=4096;function k(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function A(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function B(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=M(t[o]);return i}function I(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function C(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function T(t,r,n,i,o,s){if(!e.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>o||r<s)throw new RangeError('"value" argument is out of bounds');if(n+i>t.length)throw new RangeError("Index out of range")}function O(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(t,e,r,n,o){return e=+e,r>>>=0,o||O(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function F(t,e,r,n,o){return e=+e,r>>>=0,o||O(t,0,r,8),i.write(t,e,r,n,52,8),r+8}e.prototype.slice=function(t,r){var n=this.length;(t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<t&&(r=t);var i=this.subarray(t,r);return i.__proto__=e.prototype,i},e.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},e.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},e.prototype.readUInt8=function(t,e){return t>>>=0,e||C(t,1,this.length),this[t]},e.prototype.readUInt16LE=function(t,e){return t>>>=0,e||C(t,2,this.length),this[t]|this[t+1]<<8},e.prototype.readUInt16BE=function(t,e){return t>>>=0,e||C(t,2,this.length),this[t]<<8|this[t+1]},e.prototype.readUInt32LE=function(t,e){return t>>>=0,e||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},e.prototype.readUInt32BE=function(t,e){return t>>>=0,e||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},e.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},e.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},e.prototype.readInt8=function(t,e){return t>>>=0,e||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},e.prototype.readInt16LE=function(t,e){t>>>=0,e||C(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt16BE=function(t,e){t>>>=0,e||C(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt32LE=function(t,e){return t>>>=0,e||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},e.prototype.readInt32BE=function(t,e){return t>>>=0,e||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},e.prototype.readFloatLE=function(t,e){return t>>>=0,e||C(t,4,this.length),i.read(this,t,!0,23,4)},e.prototype.readFloatBE=function(t,e){return t>>>=0,e||C(t,4,this.length),i.read(this,t,!1,23,4)},e.prototype.readDoubleLE=function(t,e){return t>>>=0,e||C(t,8,this.length),i.read(this,t,!0,52,8)},e.prototype.readDoubleBE=function(t,e){return t>>>=0,e||C(t,8,this.length),i.read(this,t,!1,52,8)},e.prototype.writeUIntLE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||T(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},e.prototype.writeUIntBE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||T(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},e.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,1,255,0),this[e]=255&t,e+1},e.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},e.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},e.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},e.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},e.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);T(this,t,e,r,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<r&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},e.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);T(this,t,e,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},e.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},e.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},e.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},e.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},e.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},e.prototype.writeFloatLE=function(t,e,r){return D(this,t,e,!0,r)},e.prototype.writeFloatBE=function(t,e,r){return D(this,t,e,!1,r)},e.prototype.writeDoubleLE=function(t,e,r){return F(this,t,e,!0,r)},e.prototype.writeDoubleBE=function(t,e,r){return F(this,t,e,!1,r)},e.prototype.copy=function(t,r,n,i){if(!e.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),r>=t.length&&(r=t.length),r||(r=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===t.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-r<i-n&&(i=t.length-r+n);var o=i-n;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,n,i);else if(this===t&&n<r&&r<i)for(var s=o-1;s>=0;--s)t[s+r]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,i),r);return o},e.prototype.fill=function(t,r,n,i){if("string"==typeof t){if("string"==typeof r?(i=r,r=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!e.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===t.length){var o=t.charCodeAt(0);("utf8"===i&&o<128||"latin1"===i)&&(t=o)}}else"number"==typeof t&&(t&=255);if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;var s;if(r>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(s=r;s<n;++s)this[s]=t;else{var a=e.isBuffer(t)?t:e.from(t,i),u=a.length;if(0===u)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(s=0;s<n-r;++s)this[s+r]=a[s%u]}return this};var P=/[^+\/0-9A-Za-z-_]/g;function M(t){return t<16?"0"+t.toString(16):t.toString(16)}function j(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],s=0;s<n;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function R(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function U(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function N(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function K(t){return t!=t}}).call(this,t("buffer").Buffer)},{"base64-js":4,buffer:5,ieee754:6}],6:[function(t,e,r){arguments[4][3][0].apply(r,arguments)},{dup:3}]},{},[1])(1)}));var Buffer=buffer.Buffer;!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Dexie=e()}(this,(function(){"use strict";var t=function(){return(t=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function e(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n}var r=Object.keys,n=Array.isArray,i="undefined"!=typeof self?self:"undefined"!=typeof window?window:global;function o(t,e){return"object"!=typeof e||r(e).forEach((function(r){t[r]=e[r]})),t}"undefined"==typeof Promise||i.Promise||(i.Promise=Promise);var s=Object.getPrototypeOf,a={}.hasOwnProperty;function u(t,e){return a.call(t,e)}function c(t,e){"function"==typeof e&&(e=e(s(t))),r(e).forEach((function(r){f(t,r,e[r])}))}var l=Object.defineProperty;function f(t,e,r,n){l(t,e,o(r&&u(r,"get")&&"function"==typeof r.get?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function h(t){return{from:function(e){return t.prototype=Object.create(e.prototype),f(t.prototype,"constructor",t),{extend:c.bind(null,t.prototype)}}}}var p=Object.getOwnPropertyDescriptor,d=[].slice;function y(t,e,r){return d.call(t,e,r)}function m(t,e){return e(t)}function g(t){if(!t)throw new Error("Assertion Failed")}function v(t){i.setImmediate?setImmediate(t):setTimeout(t,0)}function w(t,e){return t.reduce((function(t,r,n){var i=e(r,n);return i&&(t[i[0]]=i[1]),t}),{})}function b(t,e){if(u(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var r=[],n=0,i=e.length;n<i;++n){var o=b(t,e[n]);r.push(o)}return r}var s=e.indexOf(".");if(-1!==s){var a=t[e.substr(0,s)];return void 0===a?void 0:b(a,e.substr(s+1))}}function _(t,e,r){if(t&&void 0!==e&&!("isFrozen"in Object&&Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){g("string"!=typeof r&&"length"in r);for(var i=0,o=e.length;i<o;++i)_(t,e[i],r[i])}else{var s,a,u=e.indexOf(".");-1!==u?(s=e.substr(0,u),""===(a=e.substr(u+1))?void 0===r?n(t)&&!isNaN(parseInt(s))?t.splice(s,1):delete t[s]:t[s]=r:_(t[s]||(t[s]={}),a,r)):void 0===r?n(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=r}}function E(t){var e={};for(var r in t)u(t,r)&&(e[r]=t[r]);return e}var S=[].concat;function x(t){return S.apply([],t)}var k="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(x([8,16,32,64].map((function(t){return["Int","Uint","Float"].map((function(e){return e+t+"Array"}))})))).filter((function(t){return i[t]})),A=k.map((function(t){return i[t]})),B=w(k,(function(t){return[t,!0]}));function I(t){if(!t||"object"!=typeof t)return t;var e;if(n(t)){e=[];for(var r=0,i=t.length;r<i;++r)e.push(I(t[r]))}else if(0<=A.indexOf(t.constructor))e=t;else for(var o in e=t.constructor?Object.create(t.constructor.prototype):{},t)u(t,o)&&(e[o]=I(t[o]));return e}var C={}.toString;function T(t){return C.call(t).slice(8,-1)}var O=function(t,e){return"Array"===e?""+t.map((function(t){return O(t,T(t))})):"ArrayBuffer"===e?""+new Uint8Array(t):"Date"===e?t.getTime():ArrayBuffer.isView(t)?""+new Uint8Array(t.buffer):t};function D(t,e,n,i){return n=n||{},i=i||"",r(t).forEach((function(r){var o,s,a,c;u(e,r)?(o=t[r],s=e[r],"object"==typeof o&&"object"==typeof s&&o&&s?(a=T(o))===(c=T(s))?B[a]?O(o,a)!==O(s,c)&&(n[i+r]=e[r]):D(o,s,n,i+r+"."):n[i+r]=e[r]:o!==s&&(n[i+r]=e[r])):n[i+r]=void 0})),r(e).forEach((function(r){u(t,r)||(n[i+r]=e[r])})),n}var F="undefined"!=typeof Symbol&&Symbol.iterator,P=F?function(t){var e;return null!=t&&(e=t[F])&&e.apply(t)}:function(){return null},M={};function j(t){var e,r,i,o;if(1===arguments.length){if(n(t))return t.slice();if(this===M&&"string"==typeof t)return[t];if(o=P(t)){for(r=[];!(i=o.next()).done;)r.push(i.value);return r}if(null==t)return[t];if("number"!=typeof(e=t.length))return[t];for(r=new Array(e);e--;)r[e]=t[e];return r}for(e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r}var R="undefined"!=typeof Symbol?function(t){return"AsyncFunction"===t[Symbol.toStringTag]}:function(){return!1},U="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function N(t,e){U=t,K=e}var K=function(){return!0},L=!new Error("").stack;function z(){if(L)try{throw new Error}catch(t){return t}return new Error}function q(t,e){var r=t.stack;return r?(e=e||0,0===r.indexOf(t.name)&&(e+=(t.name+t.message).split("\n").length),r.split("\n").slice(e).filter(K).map((function(t){return"\n"+t})).join("")):""}var $=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],V=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat($),W={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function G(t,e){this._e=z(),this.name=t,this.message=e}function Y(t,e){return t+". Errors: "+Object.keys(e).map((function(t){return e[t].toString()})).filter((function(t,e,r){return r.indexOf(t)===e})).join("\n")}function H(t,e,r,n){this._e=z(),this.failures=e,this.failedKeys=n,this.successCount=r,this.message=Y(t,e)}function X(t,e){this._e=z(),this.name="BulkError",this.failures=e,this.message=Y(t,e)}h(G).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+q(this._e,2))}},toString:function(){return this.name+": "+this.message}}),h(H).from(G),h(X).from(G);var J=V.reduce((function(t,e){return t[e]=e+"Error",t}),{}),Q=G,Z=V.reduce((function(t,e){var r=e+"Error";function n(t,n){this._e=z(),this.name=r,t?"string"==typeof t?(this.message=t+(n?"\n "+n:""),this.inner=n||null):"object"==typeof t&&(this.message=t.name+" "+t.message,this.inner=t):(this.message=W[e]||r,this.inner=null)}return h(n).from(Q),t[e]=n,t}),{});Z.Syntax=SyntaxError,Z.Type=TypeError,Z.Range=RangeError;var tt=$.reduce((function(t,e){return t[e+"Error"]=Z[e],t}),{}),et=V.reduce((function(t,e){return-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=Z[e]),t}),{});function rt(){}function nt(t){return t}function it(t,e){return null==t||t===nt?e:function(r){return e(t(r))}}function ot(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function st(t,e){return t===rt?e:function(){var r=t.apply(this,arguments);void 0!==r&&(arguments[0]=r);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?ot(n,this.onsuccess):n),i&&(this.onerror=this.onerror?ot(i,this.onerror):i),void 0!==o?o:r}}function at(t,e){return t===rt?e:function(){t.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?ot(r,this.onsuccess):r),n&&(this.onerror=this.onerror?ot(n,this.onerror):n)}}function ut(t,e){return t===rt?e:function(r){var n=t.apply(this,arguments);o(r,n);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?ot(i,this.onsuccess):i),s&&(this.onerror=this.onerror?ot(s,this.onerror):s),void 0===n?void 0===a?void 0:a:o(n,a)}}function ct(t,e){return t===rt?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function lt(t,e){return t===rt?e:function(){var r=t.apply(this,arguments);if(r&&"function"==typeof r.then){for(var n=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return r.then((function(){return e.apply(n,o)}))}return e.apply(this,arguments)}}et.ModifyError=H,et.DexieError=G,et.BulkError=X;var ft={},ht="undefined"==typeof Promise?[]:function(){var t=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[t,t.__proto__,t];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,e.__proto__,t]}(),pt=ht[0],dt=ht[1],yt=ht[2],mt=dt&&dt.then,gt=pt&&pt.constructor,vt=!!yt,wt=!1,bt=yt?function(){yt.then(Lt)}:i.setImmediate?setImmediate.bind(null,Lt):i.MutationObserver?function(){var t=document.createElement("div");new MutationObserver((function(){Lt(),t=null})).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(Lt,0)},_t=function(t,e){Tt.push([t,e]),St&&(bt(),St=!1)},Et=!0,St=!0,xt=[],kt=[],At=null,Bt=nt,It={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:le,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((function(t){try{le(t[0],t[1])}catch(t){}}))}},Ct=It,Tt=[],Ot=0,Dt=[];function Ft(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=rt,this._lib=!1;var e=this._PSD=Ct;if(U&&(this._stackHolder=z(),this._prev=null,this._numPrev=0),"function"!=typeof t){if(t!==ft)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&jt(this,this._value))}this._state=null,this._value=null,++e.ref,function t(e,r){try{r((function(r){if(null===e._state){if(r===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&zt();r&&"function"==typeof r.then?t(e,(function(t,e){r instanceof Ft?r._then(t,e):r.then(t,e)})):(e._state=!0,e._value=r,Rt(e)),n&&qt()}}),jt.bind(null,e))}catch(r){jt(e,r)}}(this,t)}var Pt={get:function(){var t=Ct,e=Jt;function r(r,n){var i=this,o=!t.global&&(t!==Ct||e!==Jt);o&&ee();var s=new Ft((function(e,s){Ut(i,new Mt(ae(r,t,o),ae(n,t,o),e,s,t))}));return U&&Kt(s,this),s}return r.prototype=ft,r},set:function(t){f(this,"then",t&&t.prototype===ft?Pt:{get:function(){return t},set:Pt.set})}};function Mt(t,e,r,n,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=r,this.reject=n,this.psd=i}function jt(t,e){var r,n;kt.push(e),null===t._state&&(r=t._lib&&zt(),e=Bt(e),t._state=!1,t._value=e,U&&null!==e&&"object"==typeof e&&!e._promise&&function(t,e,r){try{t.apply(null,void 0)}catch(t){}}((function(){var r=function t(e,r){var n;return p(e,r)||(n=s(e))&&t(n,r)}(e,"stack");e._promise=t,f(e,"stack",{get:function(){return wt?r&&(r.get?r.get.apply(e):r.value):t.stack}})})),n=t,xt.some((function(t){return t._value===n._value}))||xt.push(n),Rt(t),r&&qt())}function Rt(t){var e=t._listeners;t._listeners=[];for(var r=0,n=e.length;r<n;++r)Ut(t,e[r]);var i=t._PSD;--i.ref||i.finalize(),0===Ot&&(++Ot,_t((function(){0==--Ot&&$t()}),[]))}function Ut(t,e){if(null!==t._state){var r=t._state?e.onFulfilled:e.onRejected;if(null===r)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Ot,_t(Nt,[r,t,e])}else t._listeners.push(e)}function Nt(t,e,r){try{var n,i=(At=e)._value;e._state?n=t(i):(kt.length&&(kt=[]),n=t(i),-1===kt.indexOf(i)&&function(t){for(var e=xt.length;e;)if(xt[--e]._value===t._value)return xt.splice(e,1)}(e)),r.resolve(n)}catch(t){r.reject(t)}finally{At=null,0==--Ot&&$t(),--r.psd.ref||r.psd.finalize()}}function Kt(t,e){var r=e?e._numPrev+1:0;r<100&&(t._prev=e,t._numPrev=r)}function Lt(){zt()&&qt()}function zt(){var t=Et;return St=Et=!1,t}function qt(){var t,e,r;do{for(;0<Tt.length;)for(t=Tt,Tt=[],r=t.length,e=0;e<r;++e){var n=t[e];n[0].apply(null,n[1])}}while(0<Tt.length);St=Et=!0}function $t(){var t=xt;xt=[],t.forEach((function(t){t._PSD.onunhandled.call(null,t._value,t)}));for(var e=Dt.slice(0),r=e.length;r;)e[--r]()}function Vt(t){return new Ft(ft,!1,t)}function Wt(t,e){var r=Ct;return function(){var n=zt(),i=Ct;try{return ie(r,!0),t.apply(this,arguments)}catch(n){e&&e(n)}finally{ie(i,!1),n&&qt()}}}c(Ft.prototype,{then:Pt,_then:function(t,e){Ut(this,new Mt(null,null,t,e,Ct))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=t,r=arguments[1];return"function"==typeof e?this.then(null,(function(t){return(t instanceof e?r:Vt)(t)})):this.then(null,(function(t){return(t&&t.name===e?r:Vt)(t)}))},finally:function(t){return this.then((function(e){return t(),e}),(function(e){return t(),Vt(e)}))},stack:{get:function(){if(this._stack)return this._stack;try{wt=!0;var t=function t(e,r,n){if(r.length===n)return r;var i,o,s,a="";return!1===e._state&&(null!=(i=e._value)?(o=i.name||"Error",s=i.message||i,a=q(i,0)):(o=i,s=""),r.push(o+(s?": "+s:"")+a)),U&&((a=q(e._stackHolder,2))&&-1===r.indexOf(a)&&r.push(a),e._prev&&t(e._prev,r,n)),r}(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{wt=!1}}},timeout:function(t,e){var r=this;return t<1/0?new Ft((function(n,i){var o=setTimeout((function(){return i(new Z.Timeout(e))}),t);r.then(n,i).finally(clearTimeout.bind(null,o))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&f(Ft.prototype,Symbol.toStringTag,"Dexie.Promise"),It.env=oe(),c(Ft,{all:function(){var t=j.apply(null,arguments).map(re);return new Ft((function(e,r){0===t.length&&e([]);var n=t.length;t.forEach((function(i,o){return Ft.resolve(i).then((function(r){t[o]=r,--n||e(t)}),r)}))}))},resolve:function(t){if(t instanceof Ft)return t;if(t&&"function"==typeof t.then)return new Ft((function(e,r){t.then(e,r)}));var e=new Ft(ft,!0,t);return Kt(e,At),e},reject:Vt,race:function(){var t=j.apply(null,arguments).map(re);return new Ft((function(e,r){t.map((function(t){return Ft.resolve(t).then(e,r)}))}))},PSD:{get:function(){return Ct},set:function(t){return Ct=t}},newPSD:Zt,usePSD:se,scheduler:{get:function(){return _t},set:function(t){_t=t}},rejectionMapper:{get:function(){return Bt},set:function(t){Bt=t}},follow:function(t,e){return new Ft((function(r,n){return Zt((function(e,r){var n=Ct;n.unhandleds=[],n.onunhandled=r,n.finalize=ot((function(){var t,n=this;t=function(){0===n.unhandleds.length?e():r(n.unhandleds[0])},Dt.push((function e(){t(),Dt.splice(Dt.indexOf(e),1)})),++Ot,_t((function(){0==--Ot&&$t()}),[])}),n.finalize),t()}),e,r,n)}))}}),gt&&(gt.allSettled&&f(Ft,"allSettled",(function(){var t=j.apply(null,arguments).map(re);return new Ft((function(e){0===t.length&&e([]);var r=t.length,n=new Array(r);t.forEach((function(t,i){return Ft.resolve(t).then((function(t){return n[i]={status:"fulfilled",value:t}}),(function(t){return n[i]={status:"rejected",reason:t}})).then((function(){return--r||e(n)}))}))}))})),gt.any&&"undefined"!=typeof AggregateError&&f(Ft,"any",(function(){var t=j.apply(null,arguments).map(re);return new Ft((function(e,r){0===t.length&&r(new AggregateError([]));var n=t.length,i=new Array(n);t.forEach((function(t,o){return Ft.resolve(t).then((function(t){return e(t)}),(function(t){i[o]=t,--n||r(new AggregateError(i))}))}))}))})));var Gt={awaits:0,echoes:0,id:0},Yt=0,Ht=[],Xt=0,Jt=0,Qt=0;function Zt(t,e,r,n){var i=Ct,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++Qt;var a=It.env;s.env=vt?{Promise:Ft,PromiseProp:{value:Ft,configurable:!0,writable:!0},all:Ft.all,race:Ft.race,allSettled:Ft.allSettled,any:Ft.any,resolve:Ft.resolve,reject:Ft.reject,nthen:ue(a.nthen,s),gthen:ue(a.gthen,s)}:{},e&&o(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=se(s,t,r,n);return 0===s.ref&&s.finalize(),u}function te(){return Gt.id||(Gt.id=++Yt),++Gt.awaits,Gt.echoes+=100,Gt.id}function ee(t){!Gt.awaits||t&&t!==Gt.id||(0==--Gt.awaits&&(Gt.id=0),Gt.echoes=100*Gt.awaits)}function re(t){return Gt.echoes&&t&&t.constructor===gt?(te(),t.then((function(t){return ee(),t}),(function(t){return ee(),fe(t)}))):t}function ne(){var t=Ht[Ht.length-1];Ht.pop(),ie(t,!1)}function ie(t,e){var r,n,o,s=Ct;(e?!Gt.echoes||Xt++&&t===Ct:!Xt||--Xt&&t===Ct)||(r=e?function(t){++Jt,Gt.echoes&&0!=--Gt.echoes||(Gt.echoes=Gt.id=0),Ht.push(Ct),ie(t,!0)}.bind(null,t):ne,mt.call(pt,r)),t!==Ct&&(Ct=t,s===It&&(It.env=oe()),vt&&(n=It.env.Promise,o=t.env,dt.then=o.nthen,n.prototype.then=o.gthen,(s.global||t.global)&&(Object.defineProperty(i,"Promise",o.PromiseProp),n.all=o.all,n.race=o.race,n.resolve=o.resolve,n.reject=o.reject,o.allSettled&&(n.allSettled=o.allSettled),o.any&&(n.any=o.any))))}function oe(){var t=i.Promise;return vt?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(i,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:dt.then,gthen:t.prototype.then}:{}}function se(t,e,r,n,i){var o=Ct;try{return ie(t,!0),e(r,n,i)}finally{ie(o,!1)}}function ae(t,e,r){return"function"!=typeof t?t:function(){var n=Ct;r&&te(),ie(e,!0);try{return t.apply(this,arguments)}finally{ie(n,!1)}}}function ue(t,e){return function(r,n){return t.call(this,ae(r,e,!1),ae(n,e,!1))}}-1===(""+mt).indexOf("[native code]")&&(te=ee=rt);var ce="unhandledrejection";function le(t,e){var r;try{r=e.onuncatched(t)}catch(t){}if(!1!==r)try{var n,s={promise:e,reason:t};if(i.document&&document.createEvent?((n=document.createEvent("Event")).initEvent(ce,!0,!0),o(n,s)):i.CustomEvent&&o(n=new CustomEvent(ce,{detail:s}),s),n&&i.dispatchEvent&&(dispatchEvent(n),!i.PromiseRejectionEvent&&i.onunhandledrejection))try{i.onunhandledrejection(n)}catch(t){}U&&n&&!n.defaultPrevented&&console.warn("Unhandled rejection: "+(t.stack||t))}catch(t){}}var fe=Ft.reject;function he(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)}var pe=String.fromCharCode(65535),de="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ye="String expected.",me=[],ge="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),ve=ge,we=ge,be="__dbnames",_e="readonly",Ee="readwrite";function Se(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var xe={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1},ke=(Ae.prototype._trans=function(t,e,r){var n=this._tx||Ct.trans,i=this.name;function o(t,r,n){if(!n.schema[i])throw new Z.NotFound("Table "+i+" not part of transaction");return e(n.idbtrans,n)}var s=zt();try{return n&&n.db===this.db?n===Ct.trans?n._promise(t,o,r):Zt((function(){return n._promise(t,o,r)}),{trans:n,transless:Ct.transless||Ct}):function t(e,r,n,i){if(e._state.openComplete||Ct.letThrough){var o=e._createTransaction(r,n,e._dbSchema);try{o.create()}catch(t){return fe(t)}return o._promise(r,(function(t,e){return Zt((function(){return Ct.trans=o,i(t,e,o)}))})).then((function(t){return o._completion.then((function(){return t}))}))}if(!e._state.isBeingOpened){if(!e._options.autoOpen)return fe(new Z.DatabaseClosed);e.open().catch(rt)}return e._state.dbReadyPromise.then((function(){return t(e,r,n,i)}))}(this.db,t,[this.name],o)}finally{s&&qt()}},Ae.prototype.get=function(t,e){var r=this;return t&&t.constructor===Object?this.where(t).first(e):this._trans("readonly",(function(e){return r.core.get({trans:e,key:t}).then((function(t){return r.hook.reading.fire(t)}))})).then(e)},Ae.prototype.where=function(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if(n(t))return new this.db.WhereClause(this,"["+t.join("+")+"]");var e=r(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);var i=this.schema.indexes.concat(this.schema.primKey).filter((function(t){return t.compound&&e.every((function(e){return 0<=t.keyPath.indexOf(e)}))&&t.keyPath.every((function(t){return 0<=e.indexOf(t)}))}))[0];if(i&&this.db._maxKey!==pe)return this.where(i.name).equals(i.keyPath.map((function(e){return t[e]})));!i&&U&&console.warn("The query "+JSON.stringify(t)+" on "+this.name+" would benefit of a compound index ["+e.join("+")+"]");var o=this.schema.idxByName,s=this.db._deps.indexedDB;function a(t,e){try{return 0===s.cmp(t,e)}catch(t){return!1}}var u=e.reduce((function(e,r){var i=e[0],s=e[1],u=o[r],c=t[r];return[i||u,i||!u?Se(s,u&&u.multi?function(t){var e=b(t,r);return n(e)&&e.some((function(t){return a(c,t)}))}:function(t){return a(c,b(t,r))}):s]}),[null,null]),c=u[0],l=u[1];return c?this.where(c.name).equals(t[c.keyPath]).filter(l):i?this.filter(l):this.where(e).equals("")},Ae.prototype.filter=function(t){return this.toCollection().and(t)},Ae.prototype.count=function(t){return this.toCollection().count(t)},Ae.prototype.offset=function(t){return this.toCollection().offset(t)},Ae.prototype.limit=function(t){return this.toCollection().limit(t)},Ae.prototype.each=function(t){return this.toCollection().each(t)},Ae.prototype.toArray=function(t){return this.toCollection().toArray(t)},Ae.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Ae.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,n(t)?"["+t.join("+")+"]":t))},Ae.prototype.reverse=function(){return this.toCollection().reverse()},Ae.prototype.mapToClass=function(t){function e(e){if(!e)return e;var r=Object.create(t.prototype);for(var n in e)if(u(e,n))try{r[n]=e[n]}catch(e){}return r}return this.schema.mappedClass=t,this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),t},Ae.prototype.defineClass=function(){return this.mapToClass((function(t){o(this,t)}))},Ae.prototype.add=function(t,e){var r=this;return this._trans("readwrite",(function(n){return r.core.mutate({trans:n,type:"add",keys:null!=e?[e]:null,values:[t]})})).then((function(t){return t.numFailures?Ft.reject(t.failures[0]):t.lastResult})).then((function(e){if(!r.core.schema.primaryKey.outbound)try{_(t,r.core.schema.primaryKey.keyPath,e)}catch(e){}return e}))},Ae.prototype.update=function(t,e){if("object"!=typeof e||n(e))throw new Z.InvalidArgument("Modifications must be an object.");if("object"!=typeof t||n(t))return this.where(":id").equals(t).modify(e);r(e).forEach((function(r){_(t,r,e[r])}));var i=b(t,this.schema.primKey.keyPath);return void 0===i?fe(new Z.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(i).modify(e)},Ae.prototype.put=function(t,e){var r=this;return this._trans("readwrite",(function(n){return r.core.mutate({trans:n,type:"put",values:[t],keys:null!=e?[e]:null})})).then((function(t){return t.numFailures?Ft.reject(t.failures[0]):t.lastResult})).then((function(e){if(!r.core.schema.primaryKey.outbound)try{_(t,r.core.schema.primaryKey.keyPath,e)}catch(e){}return e}))},Ae.prototype.delete=function(t){var e=this;return this._trans("readwrite",(function(r){return e.core.mutate({trans:r,type:"delete",keys:[t]})})).then((function(t){return t.numFailures?Ft.reject(t.failures[0]):void 0}))},Ae.prototype.clear=function(){var t=this;return this._trans("readwrite",(function(e){return t.core.mutate({trans:e,type:"deleteRange",range:xe})})).then((function(t){return t.numFailures?Ft.reject(t.failures[0]):void 0}))},Ae.prototype.bulkGet=function(t){var e=this;return this._trans("readonly",(function(r){return e.core.getMany({keys:t,trans:r})}))},Ae.prototype.bulkAdd=function(t,e,r){var n=this,i=Array.isArray(e)?e:void 0,o=(r=r||(i?void 0:e))?r.allKeys:void 0;return this._trans("readwrite",(function(e){if(!n.core.schema.primaryKey.outbound&&i)throw new Z.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var r=t.length;return n.core.mutate({trans:e,type:"add",keys:i,values:t,wantResults:o}).then((function(t){var e=t.numFailures,i=t.results,s=t.lastResult,a=t.failures;if(0===e)return o?i:s;throw new X(n.name+".bulkAdd(): "+e+" of "+r+" operations failed",Object.keys(a).map((function(t){return a[t]})))}))}))},Ae.prototype.bulkPut=function(t,e,r){var n=this,i=Array.isArray(e)?e:void 0,o=(r=r||(i?void 0:e))?r.allKeys:void 0;return this._trans("readwrite",(function(e){if(!n.core.schema.primaryKey.outbound&&i)throw new Z.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var r=t.length;return n.core.mutate({trans:e,type:"put",keys:i,values:t,wantResults:o}).then((function(t){var e=t.numFailures,i=t.results,s=t.lastResult,a=t.failures;if(0===e)return o?i:s;throw new X(n.name+".bulkPut(): "+e+" of "+r+" operations failed",Object.keys(a).map((function(t){return a[t]})))}))}))},Ae.prototype.bulkDelete=function(t){var e=this,r=t.length;return this._trans("readwrite",(function(r){return e.core.mutate({trans:r,type:"delete",keys:t})})).then((function(t){var n=t.numFailures,i=t.lastResult,o=t.failures;if(0===n)return i;throw new X(e.name+".bulkDelete(): "+n+" of "+r+" operations failed",o)}))},Ae);function Ae(){}function Be(t){var e={},i=function(r,n){if(n){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return e[r].subscribe.apply(null,o),t}if("string"==typeof r)return e[r]};i.addEventType=a;for(var o=1,s=arguments.length;o<s;++o)a(arguments[o]);return i;function a(t,o,s){if("object"!=typeof t){var u;o=o||ct;var c={subscribers:[],fire:s=s||rt,subscribe:function(t){-1===c.subscribers.indexOf(t)&&(c.subscribers.push(t),c.fire=o(c.fire,t))},unsubscribe:function(t){c.subscribers=c.subscribers.filter((function(e){return e!==t})),c.fire=c.subscribers.reduce(o,s)}};return e[t]=i[t]=c,c}r(u=t).forEach((function(t){var e=u[t];if(n(e))a(t,u[t][0],u[t][1]);else{if("asap"!==e)throw new Z.InvalidArgument("Invalid event config");var r=a(t,nt,(function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];r.subscribers.forEach((function(t){v((function(){t.apply(null,e)}))}))}))}}))}}function Ie(t,e){return h(e).from({prototype:t}),e}function Ce(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Te(t,e){t.filter=Se(t.filter,e)}function Oe(t,e,r){var n=t.replayFilter;t.replayFilter=n?function(){return Se(n(),e())}:e,t.justLimit=r&&!n}function De(t,e){if(t.isPrimKey)return e.primaryKey;var r=e.getIndexByKeyPath(t.index);if(!r)throw new Z.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return r}function Fe(t,e,r){var n=De(t,e.schema);return e.openCursor({trans:r,values:!t.keysOnly,reverse:"prev"===t.dir,unique:!!t.unique,query:{index:n,range:t.range}})}function Pe(t,e,r,n){var i=t.replayFilter?Se(t.filter,t.replayFilter()):t.filter;if(t.or){var o={},s=function(t,r,n){var s,a;i&&!i(r,n,(function(t){return r.stop(t)}),(function(t){return r.fail(t)}))||("[object ArrayBuffer]"==(a=""+(s=r.primaryKey))&&(a=""+new Uint8Array(s)),u(o,a)||(o[a]=!0,e(t,r,n)))};return Promise.all([t.or._iterate(s,r),Me(Fe(t,n,r),t.algorithm,s,!t.keysOnly&&t.valueMapper)])}return Me(Fe(t,n,r),Se(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function Me(t,e,r,n){var i=Wt(n?function(t,e,i){return r(n(t),e,i)}:r);return t.then((function(t){if(t)return t.start((function(){var r=function(){return t.continue()};e&&!e(t,(function(t){return r=t}),(function(e){t.stop(e),r=rt}),(function(e){t.fail(e),r=rt}))||i(t.value,t,(function(t){return r=t})),r()}))}))}var je=(Re.prototype._read=function(t,e){var r=this._ctx;return r.error?r.table._trans(null,fe.bind(null,r.error)):r.table._trans("readonly",t).then(e)},Re.prototype._write=function(t){var e=this._ctx;return e.error?e.table._trans(null,fe.bind(null,e.error)):e.table._trans("readwrite",t,"locked")},Re.prototype._addAlgorithm=function(t){var e=this._ctx;e.algorithm=Se(e.algorithm,t)},Re.prototype._iterate=function(t,e){return Pe(this._ctx,t,e,this._ctx.table.core)},Re.prototype.clone=function(t){var e=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&o(r,t),e._ctx=r,e},Re.prototype.raw=function(){return this._ctx.valueMapper=null,this},Re.prototype.each=function(t){var e=this._ctx;return this._read((function(r){return Pe(e,t,r,e.table.core)}))},Re.prototype.count=function(t){var e=this;return this._read((function(t){var r=e._ctx,n=r.table.core;if(Ce(r,!0))return n.count({trans:t,query:{index:De(r,n.schema),range:r.range}}).then((function(t){return Math.min(t,r.limit)}));var i=0;return Pe(r,(function(){return++i,!1}),t,n).then((function(){return i}))})).then(t)},Re.prototype.sortBy=function(t,e){var r=t.split(".").reverse(),n=r[0],i=r.length-1;function o(t,e){return e?o(t[r[e]],e-1):t[n]}var s="next"===this._ctx.dir?1:-1;function a(t,e){var r=o(t,i),n=o(e,i);return r<n?-s:n<r?s:0}return this.toArray((function(t){return t.sort(a)})).then(e)},Re.prototype.toArray=function(t){var e=this;return this._read((function(t){var r=e._ctx;if("next"===r.dir&&Ce(r,!0)&&0<r.limit){var n=r.valueMapper,i=De(r,r.table.core.schema);return r.table.core.query({trans:t,limit:r.limit,values:!0,query:{index:i,range:r.range}}).then((function(t){var e=t.result;return n?e.map(n):e}))}var o=[];return Pe(r,(function(t){return o.push(t)}),t,r.table.core).then((function(){return o}))}),t)},Re.prototype.offset=function(t){var e=this._ctx;return t<=0||(e.offset+=t,Ce(e)?Oe(e,(function(){var e=t;return function(t,r){return 0===e||(1===e?--e:r((function(){t.advance(e),e=0})),!1)}})):Oe(e,(function(){var e=t;return function(){return--e<0}}))),this},Re.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Oe(this._ctx,(function(){var e=t;return function(t,r,n){return--e<=0&&r(n),0<=e}}),!0),this},Re.prototype.until=function(t,e){return Te(this._ctx,(function(r,n,i){return!t(r.value)||(n(i),e)})),this},Re.prototype.first=function(t){return this.limit(1).toArray((function(t){return t[0]})).then(t)},Re.prototype.last=function(t){return this.reverse().first(t)},Re.prototype.filter=function(t){var e,r;return Te(this._ctx,(function(e){return t(e.value)})),e=this._ctx,r=t,e.isMatch=Se(e.isMatch,r),this},Re.prototype.and=function(t){return this.filter(t)},Re.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},Re.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Re.prototype.desc=function(){return this.reverse()},Re.prototype.eachKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,r){t(r.key,r)}))},Re.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},Re.prototype.eachPrimaryKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,r){t(r.primaryKey,r)}))},Re.prototype.keys=function(t){var e=this._ctx;e.keysOnly=!e.isMatch;var r=[];return this.each((function(t,e){r.push(e.key)})).then((function(){return r})).then(t)},Re.prototype.primaryKeys=function(t){var e=this._ctx;if("next"===e.dir&&Ce(e,!0)&&0<e.limit)return this._read((function(t){var r=De(e,e.table.core.schema);return e.table.core.query({trans:t,values:!1,limit:e.limit,query:{index:r,range:e.range}})})).then((function(t){return t.result})).then(t);e.keysOnly=!e.isMatch;var r=[];return this.each((function(t,e){r.push(e.primaryKey)})).then((function(){return r})).then(t)},Re.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},Re.prototype.firstKey=function(t){return this.limit(1).keys((function(t){return t[0]})).then(t)},Re.prototype.lastKey=function(t){return this.reverse().firstKey(t)},Re.prototype.distinct=function(){var t=this._ctx,e=t.index&&t.table.schema.idxByName[t.index];if(!e||!e.multi)return this;var r={};return Te(this._ctx,(function(t){var e=t.primaryKey.toString(),n=u(r,e);return r[e]=!0,!n})),this},Re.prototype.modify=function(t){var e=this,n=this._ctx;return this._write((function(i){var o,s,a;function u(t,e){var n=e.failures,i=e.numFailures;m+=t-i;for(var o=0,s=r(n);o<s.length;o++){var a=s[o];y.push(n[a])}}a="function"==typeof t?t:(o=r(t),s=o.length,function(e){for(var r=!1,n=0;n<s;++n){var i=o[n],a=t[i];b(e,i)!==a&&(_(e,i,a),r=!0)}return r});var c=n.table.core,l=c.schema.primaryKey,f=l.outbound,h=l.extractKey,p="testmode"in Ar?1:2e3,d=e.db.core.cmp,y=[],m=0,g=[];return e.clone().primaryKeys().then((function(t){var e=function(r){var n=Math.min(p,t.length-r);return c.getMany({trans:i,keys:t.slice(r,r+n)}).then((function(o){for(var s=[],l=[],y=f?[]:null,m=[],g=0;g<n;++g){var v=o[g],w={value:I(v),primKey:t[r+g]};!1!==a.call(w,w.value,w)&&(null==w.value?m.push(t[r+g]):f||0===d(h(v),h(w.value))?(l.push(w.value),f&&y.push(t[r+g])):(m.push(t[r+g]),s.push(w.value)))}return Promise.resolve(0<s.length&&c.mutate({trans:i,type:"add",values:s}).then((function(t){for(var e in t.failures)m.splice(parseInt(e),1);u(s.length,t)}))).then((function(t){return 0<l.length&&c.mutate({trans:i,type:"put",keys:y,values:l}).then((function(t){return u(l.length,t)}))})).then((function(){return 0<m.length&&c.mutate({trans:i,type:"delete",keys:m}).then((function(t){return u(m.length,t)}))})).then((function(){return t.length>r+n&&e(r+p)}))}))};return e(0).then((function(){if(0<y.length)throw new H("Error modifying one or more objects",y,m,g);return t.length}))}))}))},Re.prototype.delete=function(){var t=this._ctx,e=t.range;return Ce(t)&&(t.isPrimKey&&!we||3===e.type)?this._write((function(r){var n=t.table.core.schema.primaryKey,i=e;return t.table.core.count({trans:r,query:{index:n,range:i}}).then((function(e){return t.table.core.mutate({trans:r,type:"deleteRange",range:i}).then((function(t){var r=t.failures,n=(t.lastResult,t.results,t.numFailures);if(n)throw new H("Could not delete some values",Object.keys(r).map((function(t){return r[t]})),e-n);return e-n}))}))})):this.modify((function(t,e){return e.value=null}))},Re);function Re(){}function Ue(t,e){return t<e?-1:t===e?0:1}function Ne(t,e){return e<t?-1:t===e?0:1}function Ke(t,e,r){var n=t instanceof We?new t.Collection(t):t;return n._ctx.error=new(r||TypeError)(e),n}function Le(t){return new t.Collection(t,(function(){return Ve("")})).limit(0)}function ze(t,e,r,n,i,o){for(var s=Math.min(t.length,n.length),a=-1,u=0;u<s;++u){var c=e[u];if(c!==n[u])return i(t[u],r[u])<0?t.substr(0,u)+r[u]+r.substr(u+1):i(t[u],n[u])<0?t.substr(0,u)+n[u]+r.substr(u+1):0<=a?t.substr(0,a)+e[a]+r.substr(a+1):null;i(t[u],c)<0&&(a=u)}return s<n.length&&"next"===o?t+r.substr(t.length):s<t.length&&"prev"===o?t.substr(0,r.length):a<0?null:t.substr(0,a)+n[a]+r.substr(a+1)}function qe(t,e,r,n){var i,o,s,a,u,c,l,f=r.length;if(!r.every((function(t){return"string"==typeof t})))return Ke(t,ye);function h(t){i="next"===t?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()},o="next"===t?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()},s="next"===t?Ue:Ne;var e=r.map((function(t){return{lower:o(t),upper:i(t)}})).sort((function(t,e){return s(t.lower,e.lower)}));a=e.map((function(t){return t.upper})),u=e.map((function(t){return t.lower})),l="next"===(c=t)?"":n}h("next");var p=new t.Collection(t,(function(){return $e(a[0],u[f-1]+n)}));p._ondirectionchange=function(t){h(t)};var d=0;return p._addAlgorithm((function(t,r,n){var i=t.key;if("string"!=typeof i)return!1;var h=o(i);if(e(h,u,d))return!0;for(var p=null,y=d;y<f;++y){var m=ze(i,h,a[y],u[y],s,c);null===m&&null===p?d=y+1:(null===p||0<s(p,m))&&(p=m)}return r(null!==p?function(){t.continue(p+l)}:n),!1})),p}function $e(t,e,r,n){return{type:2,lower:t,upper:e,lowerOpen:r,upperOpen:n}}function Ve(t){return{type:1,lower:t,upper:t}}var We=(Object.defineProperty(Ge.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!0,configurable:!0}),Ge.prototype.between=function(t,e,r,n){r=!1!==r,n=!0===n;try{return 0<this._cmp(t,e)||0===this._cmp(t,e)&&(r||n)&&(!r||!n)?Le(this):new this.Collection(this,(function(){return $e(t,e,!r,!n)}))}catch(t){return Ke(this,de)}},Ge.prototype.equals=function(t){return new this.Collection(this,(function(){return Ve(t)}))},Ge.prototype.above=function(t){return null==t?Ke(this,de):new this.Collection(this,(function(){return $e(t,void 0,!0)}))},Ge.prototype.aboveOrEqual=function(t){return null==t?Ke(this,de):new this.Collection(this,(function(){return $e(t,void 0,!1)}))},Ge.prototype.below=function(t){return null==t?Ke(this,de):new this.Collection(this,(function(){return $e(void 0,t,!1,!0)}))},Ge.prototype.belowOrEqual=function(t){return null==t?Ke(this,de):new this.Collection(this,(function(){return $e(void 0,t)}))},Ge.prototype.startsWith=function(t){return"string"!=typeof t?Ke(this,ye):this.between(t,t+pe,!0,!0)},Ge.prototype.startsWithIgnoreCase=function(t){return""===t?this.startsWith(t):qe(this,(function(t,e){return 0===t.indexOf(e[0])}),[t],pe)},Ge.prototype.equalsIgnoreCase=function(t){return qe(this,(function(t,e){return t===e[0]}),[t],"")},Ge.prototype.anyOfIgnoreCase=function(){var t=j.apply(M,arguments);return 0===t.length?Le(this):qe(this,(function(t,e){return-1!==e.indexOf(t)}),t,"")},Ge.prototype.startsWithAnyOfIgnoreCase=function(){var t=j.apply(M,arguments);return 0===t.length?Le(this):qe(this,(function(t,e){return e.some((function(e){return 0===t.indexOf(e)}))}),t,pe)},Ge.prototype.anyOf=function(){var t=this,e=j.apply(M,arguments),r=this._cmp;try{e.sort(r)}catch(n){return Ke(this,de)}if(0===e.length)return Le(this);var n=new this.Collection(this,(function(){return $e(e[0],e[e.length-1])}));n._ondirectionchange=function(n){r="next"===n?t._ascending:t._descending,e.sort(r)};var i=0;return n._addAlgorithm((function(t,n,o){for(var s=t.key;0<r(s,e[i]);)if(++i===e.length)return n(o),!1;return 0===r(s,e[i])||(n((function(){t.continue(e[i])})),!1)})),n},Ge.prototype.notEqual=function(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Ge.prototype.noneOf=function(){var t=j.apply(M,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this._ascending)}catch(t){return Ke(this,de)}var e=t.reduce((function(t,e){return t?t.concat([[t[t.length-1][1],e]]):[[-1/0,e]]}),null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})},Ge.prototype.inAnyRange=function(t,e){var r=this,n=this._cmp,i=this._ascending,o=this._descending,s=this._min,a=this._max;if(0===t.length)return Le(this);if(!t.every((function(t){return void 0!==t[0]&&void 0!==t[1]&&i(t[0],t[1])<=0})))return Ke(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Z.InvalidArgument);var u,c=!e||!1!==e.includeLowers,l=e&&!0===e.includeUppers,f=i;function h(t,e){return f(t[0],e[0])}try{(u=t.reduce((function(t,e){for(var r=0,i=t.length;r<i;++r){var o=t[r];if(n(e[0],o[1])<0&&0<n(e[1],o[0])){o[0]=s(o[0],e[0]),o[1]=a(o[1],e[1]);break}}return r===i&&t.push(e),t}),[])).sort(h)}catch(t){return Ke(this,de)}var p=0,d=l?function(t){return 0<i(t,u[p][1])}:function(t){return 0<=i(t,u[p][1])},y=c?function(t){return 0<o(t,u[p][0])}:function(t){return 0<=o(t,u[p][0])},m=d,g=new this.Collection(this,(function(){return $e(u[0][0],u[u.length-1][1],!c,!l)}));return g._ondirectionchange=function(t){f="next"===t?(m=d,i):(m=y,o),u.sort(h)},g._addAlgorithm((function(t,e,n){for(var o,s=t.key;m(s);)if(++p===u.length)return e(n),!1;return!d(o=s)&&!y(o)||(0===r._cmp(s,u[p][1])||0===r._cmp(s,u[p][0])||e((function(){f===i?t.continue(u[p][0]):t.continue(u[p][1])})),!1)})),g},Ge.prototype.startsWithAnyOf=function(){var t=j.apply(M,arguments);return t.every((function(t){return"string"==typeof t}))?0===t.length?Le(this):this.inAnyRange(t.map((function(t){return[t,t+pe]}))):Ke(this,"startsWithAnyOf() only works with strings")},Ge);function Ge(){}function Ye(t){return 1===t.length?t[0]:t}function He(t){try{return t.only([[]]),[[]]}catch(t){return pe}}function Xe(t){return Wt((function(e){return Je(e),t(e.target.error),!1}))}function Je(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Qe=(Ze.prototype._lock=function(){return g(!Ct.global),++this._reculock,1!==this._reculock||Ct.global||(Ct.lockOwnerFor=this),this},Ze.prototype._unlock=function(){if(g(!Ct.global),0==--this._reculock)for(Ct.global||(Ct.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var t=this._blockedFuncs.shift();try{se(t[1],t[0])}catch(t){}}return this},Ze.prototype._locked=function(){return this._reculock&&Ct.lockOwnerFor!==this},Ze.prototype.create=function(t){var e=this;if(!this.mode)return this;var r=this.db.idbdb,n=this.db._state.dbOpenError;if(g(!this.idbtrans),!t&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new Z.DatabaseClosed(n);case"MissingAPIError":throw new Z.MissingAPI(n.message,n);default:throw new Z.OpenFailed(n)}if(!this.active)throw new Z.TransactionInactive;return g(null===this._completion._state),(t=this.idbtrans=t||r.transaction(Ye(this.storeNames),this.mode)).onerror=Wt((function(r){Je(r),e._reject(t.error)})),t.onabort=Wt((function(r){Je(r),e.active&&e._reject(new Z.Abort(t.error)),e.active=!1,e.on("abort").fire(r)})),t.oncomplete=Wt((function(){e.active=!1,e._resolve()})),this},Ze.prototype._promise=function(t,e,r){var n=this;if("readwrite"===t&&"readwrite"!==this.mode)return fe(new Z.ReadOnly("Transaction is readonly"));if(!this.active)return fe(new Z.TransactionInactive);if(this._locked())return new Ft((function(i,o){n._blockedFuncs.push([function(){n._promise(t,e,r).then(i,o)},Ct])}));if(r)return Zt((function(){var t=new Ft((function(t,r){n._lock();var i=e(t,r,n);i&&i.then&&i.then(t,r)}));return t.finally((function(){return n._unlock()})),t._lib=!0,t}));var i=new Ft((function(t,r){var i=e(t,r,n);i&&i.then&&i.then(t,r)}));return i._lib=!0,i},Ze.prototype._root=function(){return this.parent?this.parent._root():this},Ze.prototype.waitFor=function(t){var e,r=this._root(),n=Ft.resolve(t);r._waitingFor?r._waitingFor=r._waitingFor.then((function(){return n})):(r._waitingFor=n,r._waitingQueue=[],e=r.idbtrans.objectStore(r.storeNames[0]),function t(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(e.get(-1/0).onsuccess=t)}());var i=r._waitingFor;return new Ft((function(t,e){n.then((function(e){return r._waitingQueue.push(Wt(t.bind(null,e)))}),(function(t){return r._waitingQueue.push(Wt(e.bind(null,t)))})).finally((function(){r._waitingFor===i&&(r._waitingFor=null)}))}))},Ze.prototype.abort=function(){this.active&&this._reject(new Z.Abort),this.active=!1},Ze.prototype.table=function(t){var e=this._memoizedTables||(this._memoizedTables={});if(u(e,t))return e[t];var r=this.schema[t];if(!r)throw new Z.NotFound("Table "+t+" not part of transaction");var n=new this.db.Table(t,r,this);return n.core=this.db.core.table(t),e[t]=n},Ze);function Ze(){}function tr(t,e,r,n,i,o,s){return{name:t,keyPath:e,unique:r,multi:n,auto:i,compound:o,src:(r&&!s?"&":"")+(n?"*":"")+(i?"++":"")+er(e)}}function er(t){return"string"==typeof t?t:t?"["+[].join.call(t,"+")+"]":""}function rr(t,e,r){return{name:t,primKey:e,indexes:r,mappedClass:null,idxByName:w(r,(function(t){return[t.name,t]}))}}function nr(t){return null==t?function(){}:"string"==typeof t?1===(e=t).split(".").length?function(t){return t[e]}:function(t){return b(t,e)}:function(e){return b(e,t)};var e}function ir(t,e){return"delete"===e.type?e.keys:e.keys||e.values.map(t.extractKey)}function or(t){return[].slice.call(t)}var sr=0;function ar(t){return null==t?":id":"string"==typeof t?t:"["+t.join("+")+"]"}function ur(t,r,i,o){var s=r.cmp.bind(r);function a(t){if(3===t.type)return null;if(4===t.type)throw new Error("Cannot convert never type to IDBKeyRange");var e=t.lower,r=t.upper,n=t.lowerOpen,o=t.upperOpen;return void 0===e?void 0===r?null:i.upperBound(r,!!o):void 0===r?i.lowerBound(e,!!n):i.bound(e,r,!!n,!!o)}var u,c,l,f=(c=o,l=or((u=t).objectStoreNames),{schema:{name:u.name,tables:l.map((function(t){return c.objectStore(t)})).map((function(t){var e=t.keyPath,r=t.autoIncrement,i=n(e),o=null==e,s={},a={name:t.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:o,compound:i,keyPath:e,autoIncrement:r,unique:!0,extractKey:nr(e)},indexes:or(t.indexNames).map((function(e){return t.index(e)})).map((function(t){var e=t.name,r=t.unique,i=t.multiEntry,o=t.keyPath,a={name:e,compound:n(o),keyPath:o,unique:r,multiEntry:i,extractKey:nr(o)};return s[ar(o)]=a})),getIndexByKeyPath:function(t){return s[ar(t)]}};return s[":id"]=a.primaryKey,null!=e&&(s[ar(e)]=a.primaryKey),a}))},hasGetAll:0<l.length&&"getAll"in c.objectStore(l[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),h=f.schema,p=f.hasGetAll,d=h.tables.map((function(t){var r,n=t.name;return{name:n,schema:t,mutate:function(r){var i=r.trans,o=r.type,s=r.keys,u=r.values,c=r.range,l=r.wantResults;return new Promise((function(r,f){r=Wt(r);var h=i.objectStore(n),p=null==h.keyPath,d="put"===o||"add"===o;if(!d&&"delete"!==o&&"deleteRange"!==o)throw new Error("Invalid operation type: "+o);var y=(s||u||{length:1}).length;if(s&&u&&s.length!==u.length)throw new Error("Given keys array must have same length as given values array.");if(0===y)return r({numFailures:0,failures:{},results:[],lastResult:void 0});function m(t){++_,Je(t),w&&(w[t.target._reqno]=void 0),b[t.target._reqno]=t.target.error}function g(t){var e=t.target;w[e._reqno]=e.result}var v,w=l&&e(s||ir(t.primaryKey,{type:o,keys:s,values:u})),b=[],_=0;if("deleteRange"===o){if(4===c.type)return r({numFailures:_,failures:b,results:w,lastResult:void 0});v=3===c.type?h.clear():h.delete(a(c))}else{var E=d?p?[u,s]:[u,null]:[s,null],S=E[0],x=E[1];if(d)for(var k=0;k<y;++k)(v=x&&void 0!==x[k]?h[o](S[k],x[k]):h[o](S[k]))._reqno=k,w&&void 0===w[k]&&(v.onsuccess=g),v.onerror=m;else for(k=0;k<y;++k)(v=h[o](S[k]))._reqno=k,v.onerror=m}function A(t){var e=t.target.result;w&&(w[y-1]=e),r({numFailures:_,failures:b,results:w,lastResult:e})}v.onerror=function(t){m(t),A(t)},v.onsuccess=A}))},getMany:function(t){var e=t.trans,r=t.keys;return new Promise((function(t,i){t=Wt(t);for(var o,s=e.objectStore(n),a=r.length,u=new Array(a),c=0,l=0,f=function(e){var r=e.target;u[r._pos]=r.result,++l===c&&t(u)},h=Xe(i),p=0;p<a;++p)null!=r[p]&&((o=s.get(r[p]))._pos=p,o.onsuccess=f,o.onerror=h,++c);0===c&&t(u)}))},get:function(t){var e=t.trans,r=t.key;return new Promise((function(t,i){t=Wt(t);var o=e.objectStore(n).get(r);o.onsuccess=function(e){return t(e.target.result)},o.onerror=Xe(i)}))},query:(r=p,function(t){return new Promise((function(e,i){e=Wt(e);var o,s,u,c,l=t.trans,f=t.values,h=t.limit,p=t.query,d=h===1/0?void 0:h,y=p.index,m=p.range,g=l.objectStore(n),v=y.isPrimaryKey?g:g.index(y.name),w=a(m);if(0===h)return e({result:[]});r?((o=f?v.getAll(w,d):v.getAllKeys(w,d)).onsuccess=function(t){return e({result:t.target.result})},o.onerror=Xe(i)):(s=0,u=!f&&"openKeyCursor"in v?v.openKeyCursor(w):v.openCursor(w),c=[],u.onsuccess=function(t){var r=u.result;return r?(c.push(f?r.value:r.primaryKey),++s===h?e({result:c}):void r.continue()):e({result:c})},u.onerror=Xe(i))}))}),openCursor:function(t){var e=t.trans,r=t.values,i=t.query,o=t.reverse,s=t.unique;return new Promise((function(t,u){t=Wt(t);var c=i.index,l=i.range,f=e.objectStore(n),h=c.isPrimaryKey?f:f.index(c.name),p=o?s?"prevunique":"prev":s?"nextunique":"next",d=!r&&"openKeyCursor"in h?h.openKeyCursor(a(l),p):h.openCursor(a(l),p);d.onerror=Xe(u),d.onsuccess=Wt((function(r){var n,i,o,s,a=d.result;a?(a.___id=++sr,a.done=!1,n=a.continue.bind(a),i=(i=a.continuePrimaryKey)&&i.bind(a),o=a.advance.bind(a),s=function(){throw new Error("Cursor not stopped")},a.trans=e,a.stop=a.continue=a.continuePrimaryKey=a.advance=function(){throw new Error("Cursor not started")},a.fail=Wt(u),a.next=function(){var t=this,e=1;return this.start((function(){return e--?t.continue():t.stop()})).then((function(){return t}))},a.start=function(t){function e(){if(d.result)try{t()}catch(t){a.fail(t)}else a.done=!0,a.start=function(){throw new Error("Cursor behind last entry")},a.stop()}var r=new Promise((function(t,e){t=Wt(t),d.onerror=Xe(e),a.fail=e,a.stop=function(e){a.stop=a.continue=a.continuePrimaryKey=a.advance=s,t(e)}}));return d.onsuccess=Wt((function(t){(d.onsuccess=e)()})),a.continue=n,a.continuePrimaryKey=i,a.advance=o,e(),r},t(a)):t(null)}),u)}))},count:function(t){var e=t.query,r=t.trans,i=e.index,o=e.range;return new Promise((function(t,e){var s=r.objectStore(n),u=i.isPrimaryKey?s:s.index(i.name),c=a(o),l=c?u.count(c):u.count();l.onsuccess=Wt((function(e){return t(e.target.result)})),l.onerror=Xe(e)}))}}})),y={};return d.forEach((function(t){return y[t.name]=t})),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(t){if(!y[t])throw new Error("Table '"+t+"' not found");return y[t]},cmp:s,MIN_KEY:-1/0,MAX_KEY:He(i),schema:h}}function cr(e,r){var n=r.db,i=function(e,r,n,i){var o,s=n.IDBKeyRange;return{dbcore:(o=ur(r,n.indexedDB,s,i),e.dbcore.reduce((function(e,r){var n=r.create;return t(t({},e),n(e))}),o))}}(e._middlewares,n,e._deps,r);e.core=i.dbcore,e.tables.forEach((function(t){var r=t.name;e.core.schema.tables.some((function(t){return t.name===r}))&&(t.core=e.core.table(r),e[r]instanceof e.Table&&(e[r].core=t.core))}))}function lr(t,e,r,n){r.forEach((function(r){var i=n[r];e.forEach((function(e){r in e||(e===t.Transaction.prototype||e instanceof t.Transaction?f(e,r,{get:function(){return this.table(r)},set:function(t){l(this,r,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):e[r]=new t.Table(r,i))}))}))}function fr(t,e){e.forEach((function(e){for(var r in e)e[r]instanceof t.Table&&delete e[r]}))}function hr(t,e){return t._cfg.version-e._cfg.version}function pr(t,e,r,n){var i=t.db.createObjectStore(e,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach((function(t){return dr(i,t)})),i}function dr(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function yr(t,e,r){var n={};return y(e.objectStoreNames,0).forEach((function(t){for(var e=r.objectStore(t),i=tr(er(u=e.keyPath),u||"",!1,!1,!!e.autoIncrement,u&&"string"!=typeof u,!0),o=[],s=0;s<e.indexNames.length;++s){var a=e.index(e.indexNames[s]),u=a.keyPath,c=tr(a.name,u,!!a.unique,!!a.multiEntry,!1,u&&"string"!=typeof u,!1);o.push(c)}n[t]=rr(t,i,o)})),n}function mr(t,e,r){for(var n=r.db.objectStoreNames,o=0;o<n.length;++o){var s=n[o],a=r.objectStore(s);t._hasGetAll="getAll"in a;for(var u=0;u<a.indexNames.length;++u){var c,l=a.indexNames[u],f=a.index(l).keyPath,h="string"==typeof f?f:"["+y(f).join("+")+"]";!e[s]||(c=e[s].idxByName[h])&&(c.name=l,delete e[s].idxByName[h],e[s].idxByName[l]=c)}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}var gr,vr=(wr.prototype._parseStoresSpec=function(t,e){r(t).forEach((function(r){if(null!==t[r]){var i=t[r].split(",").map((function(t,e){var r=(t=t.trim()).replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return tr(r,i||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),n(i),0===e)})),o=i.shift();if(o.multi)throw new Z.Schema("Primary key cannot be multi-valued");i.forEach((function(t){if(t.auto)throw new Z.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new Z.Schema("Index must have a name and cannot be an empty string")})),e[r]=rr(r,o,i)}}))},wr.prototype.stores=function(t){var e=this.db;this._cfg.storesSource=this._cfg.storesSource?o(this._cfg.storesSource,t):t;var n=e._versions,i={},s={};return n.forEach((function(t){o(i,t._cfg.storesSource),s=t._cfg.dbschema={},t._parseStoresSpec(i,s)})),e._dbSchema=s,fr(e,[e._allTables,e,e.Transaction.prototype]),lr(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],r(s),s),e._storeNames=r(s),this},wr.prototype.upgrade=function(t){return this._cfg.contentUpgrade=t,this},wr);function wr(){}function br(t){return Zt((function(){return Ct.letThrough=!0,t()}))}function _r(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then((function(){return e.dbOpenError?fe(e.dbOpenError):t}));U&&(e.openCanceller._stackHolder=z()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var i=e.dbReadyResolve,o=null;return Ft.race([e.openCanceller,new Ft((function(i,s){if(!n)throw new Z.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var a=t.name,u=e.autoSchema?n.open(a):n.open(a,Math.round(10*t.verno));if(!u)throw new Z.MissingAPI("IndexedDB API not available");u.onerror=Xe(s),u.onblocked=Wt(t._fireOnBlocked),u.onupgradeneeded=Wt((function(i){var c,l;o=u.transaction,e.autoSchema&&!t._options.allowEmptyDB?(u.onerror=Je,o.abort(),u.result.close(),(c=n.deleteDatabase(a)).onsuccess=c.onerror=Wt((function(){s(new Z.NoSuchDatabase("Database "+a+" doesnt exist"))}))):(o.onerror=Xe(s),l=i.oldVersion>Math.pow(2,62)?0:i.oldVersion,t.idbdb=u.result,function(t,e,n,i){var o=t._dbSchema,s=t._createTransaction("readwrite",t._storeNames,o);s.create(n),s._completion.catch(i);var a=s._reject.bind(s),u=Ct.transless||Ct;Zt((function(){var i,c,l,f,h,p,d,y;Ct.trans=s,Ct.transless=u,0===e?(r(o).forEach((function(t){pr(n,t,o[t].primKey,o[t].indexes)})),cr(t,n),Ft.follow((function(){return t.on.populate.fire(s)})).catch(a)):(c=e,l=s,f=n,h=[],p=(i=t)._versions,d=i._dbSchema=yr(0,i.idbdb,f),y=!1,p.filter((function(t){return t._cfg.version>=c})).forEach((function(t){h.push((function(){var e=d,n=t._cfg.dbschema;mr(i,e,f),mr(i,n,f),d=i._dbSchema=n;var o=function(t,e){var r,n={del:[],add:[],change:[]};for(r in t)e[r]||n.del.push(r);for(r in e){var i=t[r],o=e[r];if(i){var s={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(i.primKey.src===o.primKey.src||ge){var a=i.idxByName,u=o.idxByName,c=void 0;for(c in a)u[c]||s.del.push(c);for(c in u){var l=a[c],f=u[c];l?l.src!==f.src&&s.change.push(f):s.add.push(f)}(0<s.del.length||0<s.add.length||0<s.change.length)&&n.change.push(s)}else s.recreate=!0,n.change.push(s)}else n.add.push([r,o])}return n}(e,n);o.add.forEach((function(t){pr(f,t[0],t[1].primKey,t[1].indexes)})),o.change.forEach((function(t){if(t.recreate)throw new Z.Upgrade("Not yet support for changing primary key");var e=f.objectStore(t.name);t.add.forEach((function(t){return dr(e,t)})),t.change.forEach((function(t){e.deleteIndex(t.name),dr(e,t)})),t.del.forEach((function(t){return e.deleteIndex(t)}))}));var s=t._cfg.contentUpgrade;if(s&&t._cfg.version>c){cr(i,f),y=!0;var a=E(n);o.del.forEach((function(t){a[t]=e[t]})),fr(i,[i.Transaction.prototype]),lr(i,[i.Transaction.prototype],r(a),a),l.schema=a;var u,h=R(s);h&&te();var p=Ft.follow((function(){var t;(u=s(l))&&h&&(t=ee.bind(null,null),u.then(t,t))}));return u&&"function"==typeof u.then?Ft.resolve(u):p.then((function(){return u}))}})),h.push((function(e){y&&ve||function(t,e){for(var r=0;r<e.db.objectStoreNames.length;++r){var n=e.db.objectStoreNames[r];null==t[n]&&e.db.deleteObjectStore(n)}}(t._cfg.dbschema,e),fr(i,[i.Transaction.prototype]),lr(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),l.schema=i._dbSchema}))})),function t(){return h.length?Ft.resolve(h.shift()(l.idbtrans)).then(t):Ft.resolve()}().then((function(){var t,e;e=f,r(t=d).forEach((function(r){e.db.objectStoreNames.contains(r)||pr(e,r,t[r].primKey,t[r].indexes)}))})).catch(a))}))}(t,l/10,o,s))}),s),u.onsuccess=Wt((function(){o=null;var n=t.idbdb=u.result,s=y(n.objectStoreNames);if(0<s.length)try{var c=n.transaction(Ye(s),"readonly");e.autoSchema?function(t,e,n){t.verno=e.version/10;var i=t._dbSchema=yr(0,e,n);t._storeNames=y(e.objectStoreNames,0),lr(t,[t._allTables],r(i),i)}(t,n,c):mr(t,t._dbSchema,c),cr(t,c)}catch(n){}me.push(t),n.onversionchange=Wt((function(r){e.vcFired=!0,t.on("versionchange").fire(r)})),gr.add(a),i()}),s)}))]).then((function(){return e.onReadyBeingFired=[],Ft.resolve(br(t.on.ready.fire)).then((function t(){if(0<e.onReadyBeingFired.length){var r=e.onReadyBeingFired.reduce(lt,rt);return e.onReadyBeingFired=[],Ft.resolve(br(r)).then(t)}}))})).finally((function(){e.onReadyBeingFired=null})).then((function(){return e.isBeingOpened=!1,t})).catch((function(r){try{o&&o.abort()}catch(r){}return e.isBeingOpened=!1,t.close(),e.dbOpenError=r,fe(e.dbOpenError)})).finally((function(){e.openComplete=!0,i()}))}function Er(t){function e(e){return t.next(e)}var r=o(e),i=o((function(e){return t.throw(e)}));function o(t){return function(e){var o=t(e),s=o.value;return o.done?s:s&&"function"==typeof s.then?s.then(r,i):n(s)?Promise.all(s).then(r,i):r(s)}}return o(e)()}function Sr(t,e,r){for(var i=n(t)?t.slice():[t],o=0;o<r;++o)i.push(e);return i}var xr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return t(t({},e),{table:function(r){var n=e.table(r),i=n.schema,o={},s=[];function a(e,r,n){var i=ar(e),u=o[i]=o[i]||[],c=null==e?0:"string"==typeof e?1:e.length,l=0<r,f=t(t({},n),{isVirtual:l,isPrimaryKey:!l&&n.isPrimaryKey,keyTail:r,keyLength:c,extractKey:nr(e),unique:!l&&n.unique});return u.push(f),f.isPrimaryKey||s.push(f),1<c&&a(2===c?e[0]:e.slice(0,c-1),r+1,n),u.sort((function(t,e){return t.keyTail-e.keyTail})),f}var u=a(i.primaryKey.keyPath,0,i.primaryKey);o[":id"]=[u];for(var c=0,l=i.indexes;c<l.length;c++){var f=l[c];a(f.keyPath,0,f)}function h(r){var n,i,o=r.query.index;return o.isVirtual?t(t({},r),{query:{index:o,range:(n=r.query.range,i=o.keyTail,{type:1===n.type?2:n.type,lower:Sr(n.lower,n.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:Sr(n.upper,n.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}):r}return t(t({},n),{schema:t(t({},i),{primaryKey:u,indexes:s,getIndexByKeyPath:function(t){var e=o[ar(t)];return e&&e[0]}}),count:function(t){return n.count(h(t))},query:function(t){return n.query(h(t))},openCursor:function(t){var r=t.query.index,i=r.keyTail,o=r.isVirtual,s=r.keyLength;if(!o)return n.openCursor(t);return n.openCursor(h(t)).then((function(r){return r&&function(r){return Object.create(r,{continue:{value:function(n){null!=n?r.continue(Sr(n,t.reverse?e.MAX_KEY:e.MIN_KEY,i)):t.unique?r.continue(Sr(r.key,t.reverse?e.MIN_KEY:e.MAX_KEY,i)):r.continue()}},continuePrimaryKey:{value:function(t,n){r.continuePrimaryKey(Sr(t,e.MAX_KEY,i),n)}},key:{get:function(){var t=r.key;return 1===s?t[0]:t.slice(0,s)}},value:{get:function(){return r.value}}})}(r)}))}})}})}},kr={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return t(t({},r),{table:function(n){var i=r.table(n),o=i.schema.primaryKey;return t(t({},i),{mutate:function(r){var s=Ct.trans,a=s.table(n).hook,u=a.deleting,c=a.creating,l=a.updating;switch(r.type){case"add":if(c.fire===rt)break;return s._promise("readwrite",(function(){return f(r)}),!0);case"put":if(c.fire===rt&&l.fire===rt)break;return s._promise("readwrite",(function(){return f(r)}),!0);case"delete":if(u.fire===rt)break;return s._promise("readwrite",(function(){return f(r)}),!0);case"deleteRange":if(u.fire===rt)break;return s._promise("readwrite",(function(){return function e(r,n,s){return i.query({trans:r,values:!1,query:{index:o,range:n},limit:s}).then((function(i){var o=i.result;return f({type:"delete",keys:o,trans:r}).then((function(i){return 0<i.numFailures?Promise.reject(i.failures[0]):o.length<s?{failures:[],numFailures:0,lastResult:void 0}:e(r,t(t({},n),{lower:o[o.length-1],lowerOpen:!0}),s)}))}))}((e=r).trans,e.range,1e4);var e}),!0)}return i.mutate(r);function f(r){var n,s,a,f=Ct.trans,h=r.keys||ir(o,r);if(!h)throw new Error("Keys missing");return"delete"!==(r="add"===r.type||"put"===r.type?t(t({},r),{keys:h,wantResults:!0}):t({},r)).type&&(r.values=e(r.values)),r.keys&&(r.keys=e(r.keys)),n=i,a=h,("add"===(s=r).type?Promise.resolve(new Array(s.values.length)):n.getMany({trans:s.trans,keys:a})).then((function(t){var e=h.map((function(e,n){var i,s,a,h,p=t[n],d={onerror:null,onsuccess:null};return"delete"===r.type?u.fire.call(d,e,p,f):"add"===r.type||void 0===p?(i=c.fire.call(d,e,r.values[n],f),null==e&&null!=i&&(e=i,r.keys[n]=e,o.outbound||_(r.values[n],o.keyPath,e))):(s=D(p,r.values[n]),(a=l.fire.call(d,s,e,p,f))&&(h=r.values[n],Object.keys(a).forEach((function(t){_(h,t,a[t])})))),d}));return i.mutate(r).then((function(n){for(var i=n.failures,o=n.results,s=n.numFailures,a=n.lastResult,u=0;u<h.length;++u){var c=o?o[u]:h[u],l=e[u];null==c?l.onerror&&l.onerror(i[u]):l.onsuccess&&l.onsuccess("put"===r.type&&t[u]?r.values[u]:c)}return{failures:i,results:o,numFailures:s,lastResult:a}})).catch((function(t){return e.forEach((function(e){return e.onerror&&e.onerror(t)})),Promise.reject(t)}))}))}}})}})}},Ar=(Br.prototype.version=function(t){if(isNaN(t)||t<.1)throw new Z.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new Z.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,r=e.filter((function(e){return e._cfg.version===t}))[0];return r||(r=new this.Version(t),e.push(r),e.sort(hr),r.stores({}),this._state.autoSchema=!1,r)},Br.prototype._whenReady=function(t){var e=this;return this._state.openComplete||Ct.letThrough?t():new Ft((function(t,r){if(!e._state.isBeingOpened){if(!e._options.autoOpen)return void r(new Z.DatabaseClosed);e.open().catch(rt)}e._state.dbReadyPromise.then(t,r)})).then(t)},Br.prototype.use=function(t){var e=t.stack,r=t.create,n=t.level,i=t.name;i&&this.unuse({stack:e,name:i});var o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:r,level:null==n?10:n,name:i}),o.sort((function(t,e){return t.level-e.level})),this},Br.prototype.unuse=function(t){var e=t.stack,r=t.name,n=t.create;return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((function(t){return n?t.create!==n:!!r&&t.name!==r}))),this},Br.prototype.open=function(){return _r(this)},Br.prototype.close=function(){var t=me.indexOf(this),e=this._state;if(0<=t&&me.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(t){}this.idbdb=null}this._options.autoOpen=!1,e.dbOpenError=new Z.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError),e.dbReadyPromise=new Ft((function(t){e.dbReadyResolve=t})),e.openCanceller=new Ft((function(t,r){e.cancelOpen=r}))},Br.prototype.delete=function(){var t=this,e=0<arguments.length,r=this._state;return new Ft((function(n,i){function o(){t.close();var e=t._deps.indexedDB.deleteDatabase(t.name);e.onsuccess=Wt((function(){gr.remove(t.name),n()})),e.onerror=Xe(i),e.onblocked=t._fireOnBlocked}if(e)throw new Z.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()}))},Br.prototype.backendDB=function(){return this.idbdb},Br.prototype.isOpen=function(){return null!==this.idbdb},Br.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&"DatabaseClosed"===t.name},Br.prototype.hasFailed=function(){return null!==this._state.dbOpenError},Br.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Br.prototype,"tables",{get:function(){var t=this;return r(this._allTables).map((function(e){return t._allTables[e]}))},enumerable:!0,configurable:!0}),Br.prototype.transaction=function(){var t=function(t,e,r){var n=arguments.length;if(n<2)throw new Z.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];return r=i.pop(),[t,x(i),r]}.apply(this,arguments);return this._transaction.apply(this,t)},Br.prototype._transaction=function(t,e,r){var n=this,i=Ct.trans;i&&i.db===this&&-1===t.indexOf("!")||(i=null);var o,s,a=-1!==t.indexOf("?");t=t.replace("!","").replace("?","");try{if(s=e.map((function(t){var e=t instanceof n.Table?t.name:t;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e})),"r"==t||t===_e)o=_e;else{if("rw"!=t&&t!=Ee)throw new Z.InvalidArgument("Invalid transaction mode: "+t);o=Ee}if(i){if(i.mode===_e&&o===Ee){if(!a)throw new Z.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&s.forEach((function(t){if(i&&-1===i.storeNames.indexOf(t)){if(!a)throw new Z.SubTransaction("Table "+t+" not included in parent transaction.");i=null}})),a&&i&&!i.active&&(i=null)}}catch(r){return i?i._promise(null,(function(t,e){e(r)})):fe(r)}var u=function(t,e,r,n,i){return Ft.resolve().then((function(){var o=Ct.transless||Ct,s=t._createTransaction(e,r,t._dbSchema,n),a={trans:s,transless:o};n?s.idbtrans=n.idbtrans:s.create();var u,c=R(i);c&&te();var l=Ft.follow((function(){var t;(u=i.call(s,s))&&(c?(t=ee.bind(null,null),u.then(t,t)):"function"==typeof u.next&&"function"==typeof u.throw&&(u=Er(u)))}),a);return(u&&"function"==typeof u.then?Ft.resolve(u).then((function(t){return s.active?t:fe(new Z.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):l.then((function(){return u}))).then((function(t){return n&&s._resolve(),s._completion.then((function(){return t}))})).catch((function(t){return s._reject(t),fe(t)}))}))}.bind(null,this,o,s,i,r);return i?i._promise(o,u,"lock"):Ct.trans?se(Ct.transless,(function(){return n._whenReady(u)})):this._whenReady(u)},Br.prototype.table=function(t){if(!u(this._allTables,t))throw new Z.InvalidTable("Table "+t+" does not exist");return this._allTables[t]},Br);function Br(e,r){var n=this;this._middlewares={},this.verno=0;var i=Br.dependencies;this._options=r=t({addons:Br.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};var o=r.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={};var s,a,u,c,l,f={dbOpenError:this.idbdb=null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:rt,dbReadyPromise:null,cancelOpen:rt,openCanceller:null,autoSchema:!0};f.dbReadyPromise=new Ft((function(t){f.dbReadyResolve=t})),f.openCanceller=new Ft((function(t,e){f.cancelOpen=e})),this._state=f,this.name=e,this.on=Be(this,"populate","blocked","versionchange",{ready:[lt,rt]}),this.on.ready.subscribe=m(this.on.ready.subscribe,(function(t){return function(e,r){Br.vip((function(){var i,o=n._state;o.openComplete?(o.dbOpenError||Ft.resolve().then(e),r&&t(e)):o.onReadyBeingFired?(o.onReadyBeingFired.push(e),r&&t(e)):(t(e),i=n,r||t((function t(){i.on.ready.unsubscribe(e),i.on.ready.unsubscribe(t)})))}))}})),this.Collection=(s=this,Ie(je.prototype,(function(t,e){this.db=s;var r=xe,n=null;if(e)try{r=e()}catch(t){n=t}var i=t._ctx,o=i.table,a=o.hook.reading.fire;this._ctx={table:o,index:i.index,isPrimKey:!i.index||o.schema.primKey.keyPath&&i.index===o.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:n,or:i.or,valueMapper:a!==nt?a:null}}))),this.Table=(a=this,Ie(ke.prototype,(function(t,e,r){this.db=a,this._tx=r,this.name=t,this.schema=e,this.hook=a._allTables[t]?a._allTables[t].hook:Be(null,{creating:[st,rt],reading:[it,nt],updating:[ut,rt],deleting:[at,rt]})}))),this.Transaction=(u=this,Ie(Qe.prototype,(function(t,e,r,n){var i=this;this.db=u,this.mode=t,this.storeNames=e,this.schema=r,this.idbtrans=null,this.on=Be(this,"complete","error","abort"),this.parent=n||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ft((function(t,e){i._resolve=t,i._reject=e})),this._completion.then((function(){i.active=!1,i.on.complete.fire()}),(function(t){var e=i.active;return i.active=!1,i.on.error.fire(t),i.parent?i.parent._reject(t):e&&i.idbtrans&&i.idbtrans.abort(),fe(t)}))}))),this.Version=(c=this,Ie(vr.prototype,(function(t){this.db=c,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))),this.WhereClause=(l=this,Ie(We.prototype,(function(t,e,r){this.db=l,this._ctx={table:t,index:":id"===e?null:e,or:r};var n=l._deps.indexedDB;if(!n)throw new Z.MissingAPI("indexedDB API missing");this._cmp=this._ascending=n.cmp.bind(n),this._descending=function(t,e){return n.cmp(e,t)},this._max=function(t,e){return 0<n.cmp(t,e)?t:e},this._min=function(t,e){return n.cmp(t,e)<0?t:e},this._IDBKeyRange=l._deps.IDBKeyRange}))),this.on("versionchange",(function(t){0<t.newVersion?console.warn("Another connection wants to upgrade database '"+n.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+n.name+"'. Closing db now to resume the delete request."),n.close()})),this.on("blocked",(function(t){!t.newVersion||t.newVersion<t.oldVersion?console.warn("Dexie.delete('"+n.name+"') was blocked"):console.warn("Upgrade '"+n.name+"' blocked by other connection holding version "+t.oldVersion/10)})),this._maxKey=He(r.IDBKeyRange),this._createTransaction=function(t,e,r,i){return new n.Transaction(t,e,r,i)},this._fireOnBlocked=function(t){n.on("blocked").fire(t),me.filter((function(t){return t.name===n.name&&t!==n&&!t._state.vcFired})).map((function(e){return e.on("versionchange").fire(t)}))},this.use(xr),this.use(kr),o.forEach((function(t){return t(n)}))}var Ir=Ar;return c(Ir,t(t({},et),{delete:function(t){return new Ir(t).delete()},exists:function(t){return new Ir(t,{addons:[]}).open().then((function(t){return t.close(),!0})).catch("NoSuchDatabaseError",(function(){return!1}))},getDatabaseNames:function(t){return gr?gr.getDatabaseNames().then(t):Ft.resolve([])},defineClass:function(){return function(t){o(this,t)}},ignoreTransaction:function(t){return Ct.trans?se(Ct.transless,t):t()},vip:br,async:function(t){return function(){try{var e=Er(t.apply(this,arguments));return e&&"function"==typeof e.then?e:Ft.resolve(e)}catch(e){return fe(e)}}},spawn:function(t,e,r){try{var n=Er(t.apply(r,e||[]));return n&&"function"==typeof n.then?n:Ft.resolve(n)}catch(t){return fe(t)}},currentTransaction:{get:function(){return Ct.trans||null}},waitFor:function(t,e){var r=Ft.resolve("function"==typeof t?Ir.ignoreTransaction(t):t).timeout(e||6e4);return Ct.trans?Ct.trans.waitFor(r):r},Promise:Ft,debug:{get:function(){return U},set:function(t){N(t,"dexie"===t?function(){return!0}:he)}},derive:h,extend:o,props:c,override:m,Events:Be,getByKeyPath:b,setByKeyPath:_,delByKeyPath:function(t,e){"string"==typeof e?_(t,e,void 0):"length"in e&&[].map.call(e,(function(e){_(t,e,void 0)}))},shallowClone:E,deepClone:I,getObjectDiff:D,asap:v,minKey:-1/0,addons:[],connections:me,errnames:J,dependencies:function(){try{return{indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch(t){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:"3.0.1",version:"3.0.1".split(".").map((function(t){return parseInt(t)})).reduce((function(t,e,r){return t+e/Math.pow(10,2*r)})),default:Ir,Dexie:Ir})),Ir.maxKey=He(Ir.dependencies.IDBKeyRange),function(t){try{(i=(e=t)&&"function"==typeof e.databases)||((n=new Ar(be,{addons:[]})).version(1).stores({dbnames:"name"}),r=n.table("dbnames")),gr={getDatabaseNames:function(){return i?Ft.resolve(e.databases()).then((function(t){return t.map((function(t){return t.name})).filter((function(t){return t!==be}))})):r.toCollection().primaryKeys()},add:function(t){return!i&&t!==be&&r.put({name:t}).catch(rt)},remove:function(t){return!i&&t!==be&&r.delete(t).catch(rt)}}}catch(t){}var e,r,n,i}(Ar.dependencies.indexedDB),Ft.rejectionMapper=function(t,e){if(!t||t instanceof G||t instanceof TypeError||t instanceof SyntaxError||!t.name||!tt[t.name])return t;var r=new tt[t.name](e||t.message,t);return"stack"in t&&f(r,"stack",{get:function(){return this.inner.stack}}),r},N(U,he),Ar}));class LFUCache{constructor(t,e){this._keys=0,this._maxHits=1,this._cache={},this._hits={},this.maxSize=t,this.evictHitRatio=e}clear(){this._keys=0,this._maxHits=1,this._cache={},this._hits={}}find(t){const{_cache:e}=this;return Object.keys(e).find(r=>e[r]===t)}get keys(){return Object.keys(this._cache)}get(t){const{_hits:e,_maxHits:r,_cache:n}=this,i=++e[t]||void 0;return i&&(this._maxHits=i>r?i:r)&&n[t]}rename(t,e){const{_hits:r,_cache:n}=this;n[e]=n[t],r[e]=r[t],delete n[t],delete r[t]}del(t){const{_hits:e,_cache:r}=this;delete r[t],delete e[t],this._keys--}set(t,e){return this._keys++,this._keys>this.maxSize&&this._evict(),this._hits[t]=1,this._cache[t]=e}_evict(){const{_hits:t,_cache:e,_maxHits:r,evictHitRatio:n}=this,i={},o={};this._keys=0,Object.keys(t).forEach(s=>{const a=t[s];a&&a/r>n&&(this._keys++,i[s]=1,o[s]=e[s])}),this._cache=o,this._hits=i,this._maxHits=1}}function SingleThreadScheduler(t,e,r){const n=r||Object.create(null);return async function(){const r=Array.from(arguments),i=e.apply(this,r),o=n[i];let s;s=n[i]=o?o.then(()=>t.apply(this,r)):t.apply(this,r);try{const t=await s;return s===n[i]&&delete n[i],t}catch(t){throw s===n[i]&&delete n[i],t}}}var IDB=new Dexie("ProjectStore");IDB.version(1).stores({projects:"pid, name, hash, repo",files:"id, &path, &fid, type, hash",folders:"id, &path, hash",data:"fid",libraries:"url",sessions:"pid",meta:"key"}),IDB.version(2).stores({projects:"pid",files:"id, &path, &fid",folders:"id, &path",data:"fid",libraries:"url",meta:"key"}).upgrade(t=>Promise.all([t.projects.filter(t=>!t.dir).modify(t=>{const e=t.ref?`${t.pid}:${t.ref.split("/").pop()}`:t.pid;t.olddir=e,t.dir=`${e}/${t.name}`}),t.folders.filter(t=>t.deleted).delete(),t.files.filter(t=>t.deleted).delete(),t.data.filter(t=>"base64"===t.encoding).modify(t=>{t.text=castAsReadableArrayBuffer(Buffer.from(t.text,"base64")),t.encoding="binary"})])),IDB.version(3).stores({files:"id, &path, &fid",folders:"id, &path",data:"fid",meta:"key"});var GlobalErrorCodes={ProjectNotFound:"project:404",FileNotFound:"file:404",RemoveFailed:"rm:500",NotADirectory:"rmdir:405",DestinationExists:"mv:403",OperationNotSupported:"copy:501",SourceNotFound:"src:404",INodeNotFound:"inode:404",RemoteNotFound:"remote:404",CriticalDeletionError:"delete:500",InvalidArgument:"args:400",ServerFailError:"server:500"};class ExtError extends Error{constructor(t){super(t.message),Object.assign(this,t)}}const ERROR_SOURCE="filesystem",isIDB=t=>"idb"===t||t.startsWith("idb/"),ext=t=>{if(null===t)return null;const e=basename(t),r=e.lastIndexOf(".");return-1==r?"":e.substr(r).toLowerCase()},uuid4=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}),normPathCache=new LFUCache(800,.8),normalizePath=t=>{const e=normPathCache.get(t);if(e)return e;if(t.indexOf("\0")>=0)throw new ExtError({name:"InvalidArgument",src:"filesystem:normalizePath",message:RES_I18N.ErrorMessages.InvalidFor(RES_I18N.Objects.Path),code:GlobalErrorCodes.InvalidArgument});if(!t)throw new ExtError({name:"InvalidArgument",src:"filesystem:normalizePath",message:RES_I18N.ErrorMessages.CannotBeEmptyFor(RES_I18N.Objects.Path),code:GlobalErrorCodes.InvalidArgument});return normPathCache.set(t,t.split("/").filter((t,e)=>(""!==t||0===e)&&"."!==t).join("/"))},dirname=t=>{const e=t.lastIndexOf("/");return-1===e?".":0===e?"/":t.slice(0,e)},relativeTo=(t,e)=>e?t.slice(e.length+(e.endsWith("/")?0:1)):t,childOf=(t,e)=>!!t&&(t=normalizePath(t),e=normalizePath(e),t.startsWith(e+"/")||t===e),basename=t=>{const e=t.lastIndexOf("/");return-1===e?t:t.slice(e+1)},hasExt=(t,e)=>t&&ext(t)===e,join=(t,e)=>e?null==t?null:t.replace(/\/$/,"")+"/"+e.replace(/^\//,""):t,$warn=console?console.warn:()=>{},FileType={FILE:32768,DIRECTORY:16384,SYMLINK:40960};class Stats{constructor({size:t,mode:e,atimeMs:r=null,mtimeMs:n,ctimeMs:i}){let o=Date.now();this.atimeMs="number"!=typeof r?o:r,this.mtimeMs="number"!=typeof n?o:n,this.ctimeMs="number"!=typeof i?o:i,this.size=t,this.mode=Stats.normalizeMode(e),this.uid=this.gid=this.ino=0}get atime(){return new Date(this.atimeMs)}get mtime(){return new Date(this.mtimeMs)}get ctime(){return new Date(this.ctimeMs)}toBuffer(){const t=Buffer.alloc(32);return t.writeUInt32LE(this.size,0),t.writeUInt32LE(this.mode,4),t.writeDoubleLE(this.atimeMs,8),t.writeDoubleLE(this.mtimeMs,16),t.writeDoubleLE(this.ctimeMs,24),t}isFile(){return(61440&this.mode)===FileType.FILE}isDirectory(){return(61440&this.mode)===FileType.DIRECTORY}isSymbolicLink(){return(61440&this.mode)===FileType.SYMLINK}chmod(t){return this.mode=61440&this.mode|t}static normalizeMode(t){let e=t>0?t>>12:0;4!==e&&8!==e&&10!==e&&14!==e&&(e=8);let r=511&t;return r=73&r?493:420,8!==e&&(r=0),(e<<12)+r}}const messageHandlers=window.webkit&&window.webkit.messageHandlers;if(messageHandlers&&messageHandlers.file&&messageHandlers.system){const t="/documents/";class e{constructor({file:t,system:e}){this._file=t,this._system=e,this._id=1,this._callbacks={},this._serverRoot=null,this.isIOS=!0}async initServer(){this.serverUrl=await this.call(this._system,"initServer")}launchWebView(t){this._system.postMessage({method:"launchWebView",url:t})}setConsole(t){this._system.postMessage({method:"setConsole",value:t})}getConsole(){return this.call(this._system,"getConsole")}copyText(t){this._system.postMessage({method:"copyText",value:t})}appVersion(){return this.call(this._system,"appVersion")}isTablet(){return this.call(this._system,"isTablet")}versionName(){return this.call(this._system,"versionName")}async clipboardText(){const{contents:t}=await this.call(this._system,"clipboardText");return t}getUrlFor(t){if(this.serverUrl)return join(this.serverUrl,t);throw new Error("IOS Server uninitialized: call initServer first")}async setServerDir(t){if(t=this._path(t),!await this.call(this._system,"setServerDir",{path:t}))throw new ExtError({code:GlobalErrorCodes.ServerFailError,message:"Fail to configure server."});this._serverRoot=t}async getFileContent(){const{contents:t}=await DeviceFileSystem.promisifyStatus(await this.call(this._file,"getFileContent"));return t}writeExternal(t,e,r){return this.call(this._file,"writeExternal",{path:t,contents:e,base64:r})}getStorageDir(){return t}_path(t){return t.slice(11)}mkdirp(t){return this.call(this._file,"mkdirp",{path:this._path(t)})}exists(t){return this.call(this._file,"exists",{path:this._path(t)})}readFile(t,e){return this.call(this._file,"readFile",{path:this._path(t),encoding:e})}remove(t){return this.call(this._file,"remove",{path:this._path(t)})}readlink(t){return this.call(this._file,"readlink",{path:this._path(t)})}writelink(t,e){return this.call(this._file,"writelink",{path:this._path(t),target:e})}write(t,e,r){return this.call(this._file,"write",{path:this._path(t),contents:e,base64:r})}readdir(t,e,r){return this.call(this._file,"readdir",{path:this._path(t),skipFiles:e,skipFolders:r})}gitHashObject(t,e){return this.call(this._file,"gitHashObject",{path:this._path(e),type:t})}readdirDeep(t,e,r,n=""){return this.call(this._file,"readdirDeep",{path:this._path(t),files:e,folders:r,ignoreName:n})}lstat(t){return this.call(this._file,"lstat",{path:this._path(t)})}mv(t,e){return this.call(this._file,"mv",{src:this._path(t),target:this._path(e)})}saveBase64(t,e){return this.call(this._file,"saveBase64",{contents:t,name:e})}call(t,e,r){r=r||{};const n=this._id++;return t.postMessage(Object.assign({method:e,id:n},r)),new Promise((t,e)=>{this._callbacks[n]={resolve:t,reject:e}})}send(t,e){const r=this._callbacks[t];r&&(delete this._callbacks[t],r.resolve(e))}sendError(t,e){const r=this._callbacks[t];r&&(r.reject(e),delete this._callbacks[t])}}window.Android=window.IOSBridge=new e(messageHandlers)}class Observable{constructor(){this._subscriptions=[]}run(t){return Promise.all(this._subscriptions.map(e=>e(t)))}subscribe(t){return this._subscriptions.push(t),{unsubscribe:()=>{const e=this._subscriptions;e.includes(t)&&e.splice(e.indexOf(t),1)}}}}var ObservableClass=Observable;class DeviceSystem{constructor(t){this._device=t,this._appVersion=null,this._chromeVersion=null,this._appCode=null,this._copiedText=null,this._isTablet=null,this._theme=null,this.observable=new Observable;const e=Object.create(null);this._scheduleCache=e,this.idToken=SingleThreadScheduler(this._idToken,()=>"idToken",e)}async _idToken(){if(ENV.isDebugging)return"test-id-token";const t=this._device,e=t&&t.idToken?await t.idToken():null;return new Promise((t,r)=>{e&&(ACI.callbacks[e]={resolve:t,reject:r})})}get chromeVersion(){if(null!==this._chromeVersion)return this._chromeVersion;{const t=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return this._chromeVersion=t?parseInt(t[2],10):0}}get supported(){return this._device&&this._device.appVersion}get serverDirectorySupported(){return this._device&&this._device.setServerDir}get device(){return this._device}get isIOS(){return!(!this._device||!this._device.isIOS)}get theme(){return this._theme}async getPackageName(){switch(await this.getAppCode()){case"node":return"io.spck.editor.node"}}async getAppCode(){if(ENV.isDebugging){const t=ENV.queryVariable("appCode");if(t)return t}return null!==this._appCode?this._appCode:this._device?(this._device.getAppCode?this._appCode=await this._device.getAppCode():this._appCode="unsupported",this._appCode):this._appCode="browser"}async isTablet(){if(null!==this._isTablet)return this._isTablet;{const t=this._device;return t&&t.isTablet?this._isTablet=await t.isTablet():UIkit2.support.touch&&window.innerWidth>1023}}showToast(t,e){const r=this._device;r&&r.showToast?r.showToast(t,"long"):((e=e||{}).timeout=3500,UI.message(t,e))}setTheme(t){const e=this._device;this._theme=t,e&&e.setTheme&&e.setTheme(t)}async initServer(){const t=this._device;t&&t.initServer&&await t.initServer()}get importMultipleFilesSupported(){const t=this._device;return t&&t.importMultipleFiles}async importMultipleFiles(t){const e=this._device;e&&e.importMultipleFiles&&e.importMultipleFiles(t)}get launchWebViewSupported(){const t=this._device;return t&&t.launchWebView}async launchWebView(t){const e=this._device;e&&e.launchWebView&&e.launchWebView(t)}async refreshUserData(){const t=this._device;t&&t.refreshUserData&&await t.refreshUserData()}async openPlayStore(t){const e=this._device;e&&e.launchBillingFlow&&await e.openPlayStore(t||null)}async launchBillingFlow(t){const e=this._device;e&&e.launchBillingFlow&&await e.launchBillingFlow(t,null,null)}async launchAuthFlow(t){const e=this._device;e&&e.launchAuthFlow&&await e.launchAuthFlow(t)}async signOut(){const t=this._device;t&&t.signOut&&await t.signOut()}async launchTerminal(t,e){const r=this._device;r&&r.launchTerminal&&await r.launchTerminal(t,e||null)}async launchTerminalWithUrl(t,e,r){const n=this._device;n&&n.launchTerminalWithUrl&&await n.launchTerminalWithUrl(t,e,r)}async setServerDir(t){if(!this.serverDirectorySupported)throw new ExtError({code:501,message:"Not Supported"});this._device.setServerDir(t)}checkUrlExists(t){const e=this._device;return e&&e.checkUrlExists?e.checkUrlExists(t):null}resourceUrl(t){const e=this._device;return e&&e.getUrlFor?e.getUrlFor(t):null}retrieveSkuList(){const t=this._device;t&&t.retrieveSkuList&&t.retrieveSkuList()}async generateRequestToken(t,e){if(ENV.isDebugging)return t;const r=this._device;return r&&r.generateRequestToken?await r.generateRequestToken(t.slice(-200),e):null}async saveBase64(t,e,r){const n=this._device;return r&&n&&n.saveBase64AsDownload?n.saveBase64AsDownload(Buffer.from(e).toString("base64"),t):n&&n.saveBase64?n.saveBase64(Buffer.from(e).toString("base64"),t):saveAs(new Blob([e]),t)}async proxySupported(){if(null!=this._proxySupported)return this._proxySupported;{const t=this._device;return this._proxySupported=t&&t.proxySupported?await t.proxySupported():null}}async appVersion(){if(this._appVersion)return this._appVersion;{const t=this._device;return this._appVersion=t&&t.appVersion?await t.appVersion():null}}async versionName(){const t=this._device;return t&&t.versionName?t.versionName():null}get orientationSupported(){return!(!this._device||!this._device.setOrientation)}get consoleSupported(){return!(!this._device||!this._device.setConsole)}get userAccountSupported(){if(ENV.isDebugging)return!0;const t=this._device;return!!(t&&t.launchAuthFlow&&t.launchBillingFlow&&t.refreshUserData)}get IMESupported(){const t=this._device;return!!(t&&t.switchKeyboardIME&&t.setIMEMode&&t.getIMEMode)}get consoleModeSupported(){return!(!this._device||!this._device.setConsoleMode)}switchKeyboardIME(){const t=this._device;t&&t.switchKeyboardIME&&t.switchKeyboardIME()}setIMEMode(t){const e=this._device;e&&e.setIMEMode&&e.setIMEMode(t)}get fastFileSystemSupported(){return!(!this._device||!this._device.setUseFastRemove)}setUseFastRemove(t){const e=this._device;e&&e.setUseFastRemove&&e.setUseFastRemove(t)}async getIMEMode(){const t=this._device;return t&&t.getIMEMode?t.getIMEMode():null}setAppToken(t){const e=this._device;e&&e.setAppToken&&e.setAppToken(t)}setConsoleMode(t){const e=this._device;e&&e.setConsoleMode&&(e.setConsoleMode(t),this.observable.run({action:"setConsoleMode",value:t}))}setConsole(t){const e=this._device;e&&e.setConsole&&e.setConsole(t)}async getConsole(){const t=this._device;return t&&t.getConsole?t.getConsole():null}setOrientation(t){const e=this._device;e&&e.setOrientation&&e.setOrientation(t)}async getOrientation(){const t=this._device;return t&&t.getOrientation?t.getOrientation():null}async copyText(t){this._copiedText=t;const e=this._device;e&&e.copyText&&await e.copyText(t)}async clipboardText(){const t=this._device;return t&&t.clipboardText?t.clipboardText():this._copiedText}async getFileContent(){const t=this._device;return t&&t.getFileContent?t.getFileContent():null}async runCommand(t,e){const r=this._device;return r&&r.runCommand?r.runCommand(t,e):null}async writeToSession(t,e){const r=this._device;return r&&r.writeToSession?r.writeToSession(t,e):null}onMessage(t,e){this.observable.run({callbackId:t,data:e})}}var DS=new DeviceSystem(window.Android);class DeviceFileSystem{constructor(t){this.device=t,this._legacy=null,this._supported=!!t&&!!(t.mkdirp&&t.exists&&t.readFile&&t.remove&&t.readlink&&t.writelink&&t.write&&t.readdir&&t.readdirDeep&&t.lstat&&t.mv),this._supported||$warn("DeviceFileSystem is not operational: interface missing")}get supported(){return this._supported}get copySupported(){return this._supported&&!!this.device.copy}get gitHashSupported(){return this._supported&&!!this.device.gitHashObject}get externalFsSupported(){return this._supported&&!!this.device.getAvailableExternalFilesDirs}get storageDir(){if(this._directory)return this._directory;{const t=this.device;return this._directory=t.getStorageDir?t.getStorageDir():"~/",this._directory}}async getExternalFsDirsAsync(){return this.externalFsSupported?DeviceFileSystem.promisifyStatus(await this.device.getAvailableExternalFilesDirs()):null}async gitHashObject(t,e){const{contents:r}=await DeviceFileSystem.promisifyStatus(await this.device.gitHashObject(t,e));return r}async copy(t,e){const{contents:r}=await DeviceFileSystem.promisifyStatus(await this.device.copy(t,e));return r}async readFile(t,e){const{contents:r}=await DeviceFileSystem.promisifyStatus(await this.device.readFile(t,e));return"utf8"===e||"base64"===e?r:Buffer.from(r,"base64")}async remove(t){const e=await DS.getPackageName();if(t===this._directory||t.endsWith(`${e}/files/`))throw new ExtError({name:"CriticalDeletionError",src:`${this.constructor.name}:remove`,message:"Critical deletion error.",code:GlobalErrorCodes.CriticalDeletionError});return DeviceFileSystem.promisifyStatus(await this.device.remove(t))}async readlink(t){const{contents:e}=await DeviceFileSystem.promisifyStatus(await this.device.readlink(t));return e}async writelink(t,e){try{return await DeviceFileSystem.promisifyStatus(await this.device.writelink(t,e))}catch(r){throw new ExtError({name:i18nTag({de:"Sicherheitsfehler",en:"Security Error",es:"Error de seguridad",fr:"Erreur de scurit",id:"Kesalahan keamanan",ja:"",ko:" ",pt:"Erro de segurana",ru:" ",zh:"",zhTW:""}),message:i18nTag({de:`[${t}] ist ein Symlink zu [${e}]. Symbolische Links sind aus Sicherheitsgrnden auf Ihrem System nicht zulssig!`,en:`[${t}] is a symlink to [${e}]. Symbolic links are not allowed on your system for security reasons!`,es:`[${t}] es un enlace simblico a [${e}]. No se permiten enlaces simblicos en su sistema por razones de seguridad!`,fr:`[${t}] est un lien symbolique vers [${e}]. Les liens symboliques ne sont pas autoriss sur votre systme pour des raisons de scurit!`,id:`[${t}] adalah symlink ke [${e}]. Tautan simbolis tidak diperbolehkan di sistem Anda untuk alasan keamanan!`,ja:`[${t}]  [${e}] `,ko:`[${t}] [${e}]   .       !`,pt:`[${t}]  um link simblico para [${e}]. Links simblicos no so permitidos no seu sistema por razes de segurana!`,ru:`[${t}]     [${e}].         !`,zh:`[${t}]  [${e}] `,zhTW:`[${t}]  [${e}] `})})}}async write(t,e,r){return DeviceFileSystem.promisifyStatus(await this.device.write(t,e,!!r))}async exists(t){return this.device.exists(t)}async mkdirp(t){const{contents:e}=await DeviceFileSystem.promisifyStatus(await this.device.mkdirp(t));return e}async readdir(t,e,r){try{return await DeviceFileSystem.promisifyStatus(await this.device.readdir(t,e,r))}catch(t){return null}}async readdirDeep(t,e,r,n){try{return DeviceFileSystem.promisifyStatus(await this.device.readdirDeep(t,e,r,n))}catch(t){return[]}}async lstat(t){try{return new Stats(DeviceFileSystem.normalizeStats(await DeviceFileSystem.promisifyStatus(await this.device.lstat(t))))}catch(t){return null}}async mv(t,e){const{contents:r}=await DeviceFileSystem.promisifyStatus(await this.device.mv(t,e));return r}async writeExternal(t,e,r){const n=this.device;if(n&&n.writeExternal)return DeviceFileSystem.promisifyStatus(await n.writeExternal(t,e,!!r))}static async promisifyStatus(t){switch(t){case"{}":return{};case"[]":return[];default:{const e=tryParseJSON(t);if(e&&e.status)throw new ExtError(e);return e}}}static normalizeStats(t){const e=t.st_mtime||t.mtimeMs,r=t.st_ctime||t.ctimeMs,n=t.st_atime||t.atimeMs;return Object.assign(t,{mtimeMs:1e3*e,ctimeMs:1e3*r,atimeMs:1e3*n}),t}}var DeviceFileSystemClass=DeviceFileSystem,DFS=new DeviceFileSystem(window.Android),PathUtils={uuid4:uuid4,isIDB:isIDB,ext:ext,hasExt:hasExt,dirname:dirname,basename:basename,join:join,relativeTo:relativeTo,childOf:childOf,normalizePath:normalizePath};const FileTypeModes={FILE:33188,DIRECTORY:16384,SYMLINK:40960};class GitFileSystem{constructor(t){this._store=IDB,this._inodes=new LFUCache(9e3,0),this._gitIgnoreCache=new Map,this._fs=t,this.observable=new Observable;const e=Object.create(null);this._scheduleCache=e,this.write=SingleThreadScheduler(this._write,t=>t,e),this.writelink=SingleThreadScheduler(this._writelink,t=>t,e),this.mv=SingleThreadScheduler(this._mv,t=>t,e),this.rm=SingleThreadScheduler(this._rm,t=>t,e),this.rmdir=SingleThreadScheduler(this._rmdir,t=>t,e),this.copy=SingleThreadScheduler(this._copy,t=>t,e),this.gitHashObject=t.gitHashSupported?t.gitHashObject.bind(t):null}clearCache(){this._gitIgnoreCache.clear()}gitIgnoreCache(){return this._gitIgnoreCache}async safeWrite(t,e,r){const n=join(r,t);await this.write(n,e,{atomic:!0}),await this.rm(t,{atomic:!0}),await this.mv(n,t,{atomic:!0})}async recoverLostWrite(t,e,r={}){if(!await GFS.exists(t)){const n=PathUtils.join(e,t);await GFS.exists(n)&&await GFS.mv(n,t,r)}}async writeExternal(t,e,r){const n=this._fs;return n.supported&&await n.writeExternal(t,e,r)}isBinaryContent(t){return Buffer.from(t.slice(0,8e3)).some(t=>0===t)}async inode(t,e){const r=this._inodes;return!e&&r.get(t)||r.set(t,uuid4())}async inodePath(t){const e=this._inodes.find(t);if(e)return e;throw new ExtError({src:`${this.constructor.name}:inodePath`,message:"Could not find inode.",inode:t,code:GlobalErrorCodes.INodeNotFound})}inodePathSync(t){return this._inodes.find(t)}async exists(t){t=normalizePath(t);const{_store:e,_fs:r}=this;return r.supported&&!isIDB(t)?await r.exists(t):!!await e.files.get({path:t})||!!await e.folders.get({path:t})}async lookupFolder(t){const{_store:e}=this,r=await e.folders.get({path:t});if(r)return r;{const e=await this.readlink(t);return e&&e!==t?await this.lookupFolder(e):null}}async lookupFile(t){const e=await this._store.files.get({path:t});return e?e.target&&e.target!==t?await this.lookupFile(e.target):e:null}async _copy(t,e,r={updateStatus:!1,atomic:!1}){const{_fs:n}=this;let i;switch(`${isIDB(t)?"I":"F"}${isIDB(e)?"I":"F"}`){case"IF":case"FI":throw new ExtError({name:"OperationNotSupported",src:`${this.constructor.name}:copy`,message:"Moving between IndexedDB and FileSystem is currently not supported!",path:e,code:GlobalErrorCodes.OperationNotSupported});case"II":{const r=await this.lookupFile(t);if(r){const n=r.path,o=await this.read(n);await this.write(n.replace(t,e),o),i="file";break}{const[r,n]=await Promise.all([this.readdirDeep(t,{files:!0,folders:!1}),this.readdirDeep(t,{files:!1,folders:!0})]);n.unshift(t);for(let r of n)await this.mkdir(r.replace(t,e));for(let n of r)await this.write(n.replace(t,e),await this.read(n));i="folder";break}}case"FF":if(n.copySupported){i=await n.copy(t,e);break}throw new ExtError({name:"OperationNotSupported",src:`${this.constructor.name}:copy`,message:"Copy operation not supported by your system.",path:e,code:GlobalErrorCodes.OperationNotSupported})}const{updateStatus:o,atomic:s}=r;return s||await this.observable.run({action:"copy",type:i,updateStatus:o,oldpath:t,path:e}),i}async _mv(t,e,r={updateStatus:!1,atomic:!1,copyDelete:!1,deleteTarget:!1}){if(t=normalizePath(t),e=normalizePath(e),t===e)return;if(await this.exists(e)){if(!r.deleteTarget)throw new ExtError({name:"DestinationExists",src:`${this.constructor.name}:mv`,message:RES_I18N.ErrorMessages.ExistsFor(RES_I18N.Objects.TargetPath),path:e,code:GlobalErrorCodes.DestinationExists});await this._rm(e,{atomic:!0})}const{_store:n,_inodes:i,_fs:o,_gitIgnoreCache:s}=this;let a;if(s.clear(),r.copyDelete)a=await this._copy(t,e,{atomic:!0}),await this._rm(t,{atomic:!0});else if(o.supported&&!isIDB(t))a=await o.mv(t,e);else{const r=await this.lookupFile(t);if(r)await this.mkdir(dirname(e)),await n.files.update(r.id,{path:e,mtimeMs:Date.now()}),a="file";else{const r=await this.lookupFolder(t);if(!r)throw new ExtError({name:"SourceNotFound",src:`${this.constructor.name}:mv`,message:RES_I18N.ErrorMessages.NotExistsFor(RES_I18N.Objects.SourcePath),oldpath:t,code:GlobalErrorCodes.SourceNotFound});{await this.mkdir(dirname(e));const i=Date.now();await n.files.where("path").startsWith(t+"/").modify(r=>{r.path=e+r.path.slice(t.length),r.mtimeMs=i}),await n.folders.where("path").startsWith(t+"/").modify(r=>{r.path=e+r.path.slice(t.length),r.mtimeMs=i}),await n.folders.update(r.id,{path:e,mtimeMs:i}),a="folder"}}}const{updateStatus:u,atomic:c}=r;return c||("file"===a?i.rename(t,e):"folder"===a&&i.keys.filter(e=>e.startsWith(t+"/")).forEach(r=>i.rename(r,r.replace(t,e))),await this.observable.run({action:"mv",updateStatus:u,oldpath:t,path:e,type:a})),{oldpath:t,path:e,type:a}}async read(t,e={}){return this.readFile(t,e).catch(()=>null)}async readFile(t,e={}){t=normalizePath(t);const{_fs:r,_store:n}=this,i=e.encoding;if(r.supported&&!isIDB(t))return r.readFile(t,i);{const e=await this.lookupFile(t);if(e){const t=await n.data.get(e.fid),r=t&&t.text||"",o=t&&t.encoding||"";return o?"utf8"===i&&"utf8"===o?r:i?Buffer.from(r,o).toString(i):Buffer.from(r,o):"utf8"===i?r:i?Buffer.from(r).toString(i):Buffer.from(r)}throw new ExtError({name:"FileNotFound",src:`${this.constructor.name}:read`,message:RES_I18N.ErrorMessages.NotExistsFor(RES_I18N.Objects.File),path:t,code:GlobalErrorCodes.FileNotFound})}}async mkdir(t,e={atomic:!1}){t=normalizePath(t);const{_fs:r,_store:n}=this,i=t.split("/").map((t,e,r)=>r.slice(0,e+1).join("/"));let o;o=r.supported&&!isIDB(t)?await r.mkdirp(t):await n.folders.where("path").anyOf(i).keys(t=>{const e=i.filter(e=>!t.includes(e));return e.length>0&&this._mkdirs(e)}),o&&!e.atomic&&await this.observable.run({action:"mkdir",path:t,type:"folder"})}async _write(t,e,r){t=normalizePath(t),e=e||"";let{mode:n,target:i,updateStatus:o,atomic:s}=r||{};const{_fs:a,_store:u,_gitIgnoreCache:c}=this;c.has(t)&&c.delete(t),await this.mkdir(dirname(t),{atomic:s});const l=GitFileSystem.isArrayBuffer(e);let f,h;if(a.supported&&!isIDB(t))({mtimeMs:f,size:h,mode:n}=await a.write(t,l?Buffer.from(e).toString("base64"):e,l));else{const r=await this.lookupFile(t),o=l?castAsReadableArrayBuffer(e):e;h=o.byteLength||o.length,f=Date.now();const s=r?r.ctimeMs:f,a=r?r.id:uuid4();await u.files.put({id:a,fid:a,path:t,target:i,mode:n,size:h,ctimeMs:s,mtimeMs:f}),await u.data.put({fid:a,text:o,encoding:l?"binary":"utf8"})}return s||await this.observable.run({action:"write",path:t,type:"file",updateStatus:o}),{mode:n,mtimeMs:f,type:"file",ino:0,size:h}}async _rm(t,e={}){const{tmpDir:r,updateStatus:n,atomic:i}=e;t=normalizePath(t);const{_fs:o,_store:s,_inodes:a,_gitIgnoreCache:u}=this;u.has(t)&&u.delete(t);let c=!1;if(r)return this._mv(t,`${r}${t}~${uuid4()}`,{updateStatus:n});{const e=await this.lstat(t);if(e){if(e.isDirectory())return this._rmdir(t,{updateStatus:n});if(o.supported&&!isIDB(t))c=await o.remove(t);else{const e=await s.files.get({path:t});e&&(await Promise.all([s.files.delete(e.id),s.data.delete(e.fid)]),c=!0)}}else c=!0}if(c){const e="file";if(i)return{oldpath:t,path:null,type:e};a.del(t);const r=dirname(t);return"."===r||"/"===r||await this.fileCount(r)>0?(await this.observable.run({action:"rm",updateStatus:n,oldpath:t,path:null,type:e}),{oldpath:t,path:null,type:e}):this._rmdir(r)}throw new ExtError({name:"RemoveFailed",src:`${this.constructor.name}:rm`,message:`Could not remove ${t}.`,path:t,code:GlobalErrorCodes.RemoveFailed})}async _rmdir(t,e={}){const{tmpDir:r,updateStatus:n,atomic:i,skipRemoveEmpty:o}=e;t=normalizePath(t);const{_inodes:s,_fs:a,_store:u,_gitIgnoreCache:c}=this;c.clear();const l=t+"/";if(s.keys.filter(t=>t.startsWith(l)).forEach(t=>s.del(t)),r)return this._mv(t,r+t,{updateStatus:n});{const e=await this.lstat(t);let r=!1;if(e){if(!e.isDirectory())throw new ExtError({name:"NotADirectory",src:`${this.constructor.name}:rmdir`,message:`${t} is not a directory.`,path:t,stats:e,code:GlobalErrorCodes.NotADirectory});a.supported&&!isIDB(t)?r=await a.remove(t):(await Promise.all([u.folders.where("path").equals(t).delete(),u.files.where("path").startsWith(l).delete(),u.folders.where("path").startsWith(l).delete()]),r=!0)}else r=!0;if(r){const e="folder",r=dirname(t);return o||"."===r||"/"===r||await this.fileCount(r)>0?(i||await this.observable.run({action:"rmdir",updateStatus:n,oldpath:t,path:null,type:e}),{oldpath:t,path:null,type:e}):this._rmdir(r)}throw new ExtError({name:"RemoveFailed",src:`${this.constructor.name}:rmdir`,message:`Could not remove ${t}.`,path:t,code:GlobalErrorCodes.RemoveFailed})}}async fileCount(t){const e=await this.readdirDeep(t,{files:!0});return e?e.length:null}async readdir(t,e){const{skipFiles:r=!1,skipFolders:n=!1}=e||{};t=normalizePath(t);const{_fs:i,_store:o}=this;let s;if(i.supported&&!isIDB(t))return s=await i.readdir(t,r,n),s&&s.sort(GitFileSystemClass.compareStrings),s;const a=await this.lookupFolder(t);if(a){const t=a.path+"/",e=t.length;let i=n?[]:o.folders.where("path").startsWith(t).filter(t=>!t.path.slice(e).includes("/")).keys(),u=r?[]:o.files.where("path").startsWith(t).filter(t=>!t.path.slice(e).includes("/")).keys();return s=(await i).concat(await u).map(t=>t.slice(e)),s.sort(GitFileSystemClass.compareStrings),s}return null}async readdirDeep(t,e){const{files:r=!0,folders:n=!1,relative:i=!1,ignoreName:o=""}=e||{},{_store:s,_fs:a}=this,u=(t=normalizePath(t))+"/",c=u.length;let l;if(a.supported&&!isIDB(t))l=await a.readdirDeep(t,r,n,o);else{const[t,e]=await Promise.all([r?s.files.where("path").startsWith(u).keys():[],n?s.folders.where("path").startsWith(u).keys():[]]);l=e.concat(t)}if(l){if(o){const t=new Set(o.split(":")),e=new RegExp(`/(${o.replace(/:/g,"|").replace(/\./g,"\\.")})/`);l=l.filter(r=>!e.test(r)&&!t.has(basename(r)))}l.sort(GitFileSystemClass.compareStrings),i&&(l=l.map(t=>t.slice(c)))}return l}async lstat(t){t=normalizePath(t);const{_store:e,_fs:r}=this;if(r.supported&&!isIDB(t))return await r.lstat(t);{const r=await e.files.get({path:t});if(r)return r.target?new Stats({size:r.size||0,mode:FileTypeModes.SYMLINK,mtimeMs:r.mtimeMs,ctimeMs:r.ctimeMs}):new Stats({size:r.size||0,mode:FileTypeModes.FILE,mtimeMs:r.mtimeMs,ctimeMs:r.ctimeMs});{const r=await e.folders.get({path:t});return r?new Stats({size:0,mode:FileTypeModes.DIRECTORY,mtimeMs:r.mtimeMs,ctimeMs:r.ctimeMs}):null}}}async size(t){return(await this.lstat(t)||{size:0}).size}async readlink(t){t=normalizePath(t);const{_fs:e,_store:r}=this;if(e.supported&&!isIDB(t))return e.readlink(t);const n=await r.files.get({path:t});return n&&n.target||null}async _writelink(t,e){t=normalizePath(t);const{_fs:r}=this,n=e.toString("utf8");return r.supported&&!isIDB(t)?(await this.mkdir(dirname(t)),r.writelink(t,n)):this._write(t,"",{target:n,mode:FileTypeModes.SYMLINK})}_mkdirs(t){const e=Date.now();return this._store.folders.bulkAdd(t.map(t=>({id:uuid4(),path:t,mtimeMs:e,ctimeMs:e})))}static compareStrings(t,e){return-(t<e)||+(t>e)}static isArrayBuffer(t){return t instanceof ArrayBuffer||t&&t.buffer instanceof ArrayBuffer&&void 0!==t.byteLength}}var GitFileSystemClass=GitFileSystem,GFS=new GitFileSystem(DFS);class Environ{constructor(t,e){this._fs=t,this._ds=e,this.locale="en",this._serverDirectory=null,this._nodeStoragePath=null}async setServerDir(t){this._ds.serverDirectorySupported?(await this._ds.setServerDir(t),this._serverDirectory=t):this._serverDirectory=null}locationSearchString(){try{return window.location.search}catch(t){return null}}queryVariable(t){const e=this.locationSearchString().substring(1).split("&");for(let r=0;r<e.length;r++){let n=e[r].split("=");if(decodeURIComponent(n[0])==t)return decodeURIComponent(n[1])}}get isDebugging(){return this.queryVariable("debug")}get apiUrl(){return this.isDebugging?"http://localhost:8321":"https://api.spck.io/v2"}setNodeJsModuleStoragePath(t){this._nodeStoragePath=t}getNodeJsModuleStoragePath(){return this._nodeStoragePath}resource(t){if(t){if(isIDB(t))return join("/run",t);if(this._ds.serverDirectorySupported){const e=this._serverDirectory;return e&&t.startsWith(e)?this._ds.resourceUrl(relativeTo(t,e)):null}return this._ds.resourceUrl(t)}return t}async getExternalFsDirsAsync(){const t=await this._fs.getExternalFsDirsAsync();return t&&t.length?(t[0].name="External",t[0].id="external",t.slice(1,3).forEach((t,e)=>{t.name=`SD${e+1}`,t.id=`SD${e+1}`}),t):[]}getInternalDir(t){return this._internalDir||(this._internalDir=this._fs.supported?this._fs.storageDir:"idb"),join(this._internalDir,t)}projectConfigPath(t){return join(t,".projects")}gitConfigPath(){return this.getInternalDir(".gitconfig")}settingsConfigPath(){return this.getInternalDir(".settings")}globalTasksConfigPath(){return this.getInternalDir(".metadata/.tasks/.global")}cachedUserDataPath(){return this.getInternalDir(".metadata/.user")}fontsDir(){return this.getInternalDir(".metadata/.fonts")}signatureDir(){return this.getInternalDir(".metadata/.sig")}projectTasksConfigPath(t){return join(`${dirname(t)}/.metadata/.tasks`,basename(t))}tmpDir(t){return join(`${dirname(t)}/.tmp`,basename(t))}metadataPath(t){return join(`${dirname(t)}/.metadata`,basename(t))}trashDir(t){return join(`${dirname(t)}/.trash`,basename(t))}}var ENV=new Environ(DFS,DS);function tryParseJSON(t){try{return JSON.parse(t)||null}catch(t){return null}}function castAsReadableArrayBuffer(t){if(t instanceof ArrayBuffer)return t;if(t instanceof Uint8Array)return 0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(Buffer.isBuffer(t))return t.buffer;throw new Error("Argument type not recognized: "+typeof t)}